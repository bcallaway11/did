[{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Problems with two-way fixed-effects event-study regressions","text":"vignette, want illustrate dangers relying traditional two-way fixed-effects (TWFE) regression models leads lags conduct causal inference treatment effect dynamics. fact, show even treatment effect dynamics homogeneous across different treatment groups/cohorts, TWFE regression models can severely biased. order effectively communicate dangers, consider stylized simulation example covariates play major role. example draws several discussions Andrew Baker. consider three setups. first one units eventually treated, treatment effect dynamics homogeneous across treatment groups. second, group units remain untreated end sample, treatment effect dynamics homogeneous across treatment groups. third one like second, heterogeneous treatment effect dynamics across treatment groups.","code":""},{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"setup-with-all-units-being-eventually-treated-and-homogeneous-treatment-effect-dynamics","dir":"Articles","previous_headings":"","what":"Setup with all units being eventually treated and homogeneous treatment effect dynamics","title":"Problems with two-way fixed-effects event-study regressions","text":"Consider staggered treatment adoption setup 40 ‘states’ (state={1,2,…,40}state = \\{1,2,\\dots,40\\}) randomly assigned 4 treatment groups depending treatment starting year (1986, 1992, 1998, 2004). denote treatment starting period gg (g∈{1986,1992,1998,2004}g \\\\{ 1986, 1992, 1998, 2004\\}). 1000 units (e.g., ‘counties’ ‘firms’) ii sample randomly assigned one 40 states. Let GiG_i indicates group/cohort unit ii belongs , .e., G⊆{1986,1992,1998,2004}G \\subseteq \\{ 1986, 1992, 1998, 2004\\}. data generating process (DGP) outcome YY consider Yi,t=(2010−g)+αi+αt+τi,t+ϵi,tY_{,t} = (2010-g) + \\alpha_i + \\alpha_t + \\tau_{,t} + \\epsilon_{,t} αi\\alpha_i unit fixed effects drawn ∼N(μstate,1)\\sim N(\\mu_{state}, 1) state-specific mean μstate=state/5\\mu_{state} = state/5, αt\\alpha_t time fixed effects (cohort specific parallel time-trends) generated αt=0.1*(t−g)+ϵttimeFE,\\alpha_t = 0.1 * (t - g) + \\epsilon^{time FE}_t,  ϵttimeFE∼N(0,1)\\epsilon^{time FE}_t \\sim N(0, 1), ϵi,t∼N(0,(12)2)\\epsilon_{,t} \\sim N\\left(0, \\left(\\frac{1}{2}\\right)^2\\right) idiosyncratic error term, τi,t\\tau_{,t} unit-specific treatment effects time tt generated τi,t=μ×(t−g+1)×1{t≥g}, \\tau_{,t} = \\mu \\times (t - g + 1)\\times 1\\{t \\ge g \\}, μ\\mu instantaneous treatment effect; set μ=1\\mu=1. DGP, evident ATT time unit treated equal 1 groups, equal 2 one period treatment started groups, etc. Thus, evolution treatment effects homogeneous across treatment groups. priori strong restriction make things “easier” estimate (means required!).","code":""},{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"visualizing-the-dgp","dir":"Articles","previous_headings":"Setup with all units being eventually treated and homogeneous treatment effect dynamics","what":"Visualizing the DGP","title":"Problems with two-way fixed-effects event-study regressions","text":"Let’s start discussion first visualizing DGP looks like.  plot shows 1,000 individual values Yi,tY_{,t}, well average treatment-group (thicker colorful lines), vertical lines show period treatment begins group. treatment effects grows linearly time elapsed since treatment started, can see earliest treated units end highest value Y, difference grows gap treatment years.","code":"# Load libraries and set baseline parameters library(tidyverse) library(lfe) library(fastDummies) library(ggthemes) library(did) theme_set(theme_clean() + theme(plot.background = element_blank())) #---------------------------------------------------------------------------- iseed  = 20201221 nrep <- 100   true_mu <- 1 set.seed(iseed)  #---------------------------------------------------------------------------- ## Generate data - treated cohorts consist of 250 obs each, with the treatment effect still = true_mu on average make_data <- function(nobs = 1000,                        nstates = 40) {      # unit fixed effects (unobservd heterogeneity)   unit <- tibble(     unit = 1:nobs,     # generate state     state = sample(1:nstates, nobs, replace = TRUE),     unit_fe = rnorm(nobs, state/5, 1),     # generate instantaneous treatment effect     #mu = rnorm(nobs, true_mu, 0.2)     mu = true_mu   )      # year fixed effects (first part)   year <- tibble(     year = 1980:2010,     year_fe = rnorm(length(year), 0, 1)   )      # Put the states into treatment groups   treat_taus <- tibble(     # sample the states randomly     state = sample(1:nstates, nstates, replace = FALSE),     # place the randomly sampled states into four treatment groups G_g     cohort_year = sort(rep(c(1986, 1992, 1998, 2004), 10))   )      # make main dataset   # full interaction of unit X year    expand_grid(unit = 1:nobs, year = 1980:2010) %>%      left_join(., unit) %>%      left_join(., year) %>%      left_join(., treat_taus) %>%      # make error term and get treatment indicators and treatment effects     # Also get cohort specific trends (modify time FE)     mutate(error = rnorm(nobs*31, 0, 1),            treat = ifelse(year >= cohort_year, 1, 0),            tau = ifelse(treat == 1, mu, 0),            year_fe = year_fe + 0.1*(year - cohort_year)     ) %>%      # calculate cumulative treatment effects     group_by(unit) %>%      mutate(tau_cum = cumsum(tau)) %>%      ungroup() %>%      # calculate the dep variable     mutate(dep_var = (2010 - cohort_year) + unit_fe + year_fe + tau_cum + error)    } #---------------------------------------------------------------------------- # make data data <- make_data()  # plot plot1 <- data %>%    ggplot(aes(x = year, y = dep_var, group = unit)) +    geom_line(alpha = 1/8, color = \"grey\") +    geom_line(data = data %>%                group_by(cohort_year, year) %>%                summarize(dep_var = mean(dep_var)),             aes(x = year, y = dep_var, group = factor(cohort_year),                 color = factor(cohort_year)),             size = 2) +    labs(x = \"\", y = \"Value\", color = \"Treatment group   \") +    geom_vline(xintercept = 1986, color = '#E41A1C', size = 2) +    geom_vline(xintercept = 1992, color = '#377EB8', size = 2) +    geom_vline(xintercept = 1998, color = '#4DAF4A', size = 2) +    geom_vline(xintercept = 2004, color = '#984EA3', size = 2) +    scale_color_brewer(palette = 'Set1') +    theme(legend.position = 'bottom',         #legend.title = element_blank(),          axis.title = element_text(size = 14),         axis.text = element_text(size = 12))  +   ggtitle(\"One draw of the DGP with homogeneous effects across cohorts \\n and with all groups being eventually treated\")+   theme(plot.title = element_text(hjust = 0.5, size = 12))  plot1  #ggsave(\"plot_dgp1.png\", plot1, width = 10, height = 5, dpi = 100)"},{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"estimating-dynamic-treatment-effects-via-twfe-event-study-regressions","dir":"Articles","previous_headings":"Setup with all units being eventually treated and homogeneous treatment effect dynamics","what":"Estimating dynamic treatment effects via TWFE event-study regressions","title":"Problems with two-way fixed-effects event-study regressions","text":"Given interested treatment effect dynamics, proceed consider classical two-way fixed-effects (TWFE) event study specification Yi,t=αi+αt+γk−KDi,t<−K+∑k=−K−2γkleadDi,tk+∑k=0LγklagDi,tk+γkL+Di,t>L+εi,tY_{,t} = \\alpha_i + \\alpha_t + \\gamma_k^{-K}~ D_{,t}^{<-K} + \\sum_{k=-K}^{-2} \\gamma_k^{lead} D_{,t}^{k} +\\sum_{k=0}^{L} \\gamma_k^{lag} D_{,t}^{k} + \\gamma_k^{L+} D_{,t}^{>L} + \\varepsilon_{,t} Di,tk=1{t−Gi=k}D_{,t}^{k}=1\\{t-G_i=k\\} “event-study” dummy variable takes value one unit ii kk periods away initial treatment time tt zero otherwise, Di,t<−K=1{t−Gi<−K}D_{,t}^{<-K}=1\\{t-G_i<-K\\} Di,t>L=1{t−Gi>L}D_{,t}^{>L}=1\\{t-G_i>L\\} defined analogously. instance, Di,t0D_{,t}^{0} equal one unit ii first treated time tt, Di,t1D_{,t}^{1} equal one one period passed since treatment started (treatment lags), etc. Alternatively Di,t−2D_{,t}^{-2} equal one unit ii treated two periods tt (treatment leads). exercise set KK LL equal 5. today, customary interpret estimates γklags\\gamma_k^{lags} ``good’’ measures average treatment effect exposed treatment kk periods, estimates γkleads\\gamma_k^{leads} measures pre-trends. first exercise assess OK-ish. Towards end, perform Monte Carlo exercise generate data according DGP described estimate parameters TWFE event-study regression . repeat 100 times (holds true 1,000) plot Monte Carlo mean 1.96 times Monte-Carlo standard-deviation relative time indicator dummies, well true treatment effect .  results show TWFE event-study type estimates severely biased true treatment effects. Furthermore, using estimates coefficient treatment leads way find evidence “pre-trends” problematic, illustrated ; see Sun Abraham (2021) formal results! Putting simply, results highlight TWFE linear regression used highlight treatment effect dynamics! Now, may wonder: happens include possible leads lags TWFE event study specification, .e., set K L maximum allowable data, making inclusion Di,t<−KD_{,t}^{<-K} Di,t>LD_{,t}^{>L} unnecessary. follows, exactly , though need omit one extra period apart -1 avoid problems multicollinearity identified Borusyak Jaravel (2018). drop negative time period, perhaps natural thing . order words, set K=23K=23 L=24L=24, drop Di,t<−KD_{,t}^{<-K} Di,t>LD_{,t}^{>L} TWFE specification. result exercise displayed . , can see, still leads biased estimates causal effects interest!","code":"# function to run ES DID # variables we will use keepvars <- c(\"`rel_year_-5`\",  \"`rel_year_-4`\",  \"`rel_year_-3`\",  \"`rel_year_-2`\",               \"rel_year_0\", \"rel_year_1\", \"rel_year_2\", \"rel_year_3\", \"rel_year_4\", \"rel_year_5\")  run_ES_DiD <- function(...) {      # resimulate the data   data <- make_data()      # make dummy columns   data <- data %>%      # make dummies     mutate(rel_year = year - cohort_year) %>%      dummy_cols(select_columns = \"rel_year\") %>%      # generate pre and post dummies     mutate(Pre = ifelse(rel_year < -5, 1, 0),            Post = ifelse(rel_year > 5, 1, 0))      # estimate the model   mod <- lfe::felm(dep_var ~ Pre + `rel_year_-5` + `rel_year_-4` + `rel_year_-3` + `rel_year_-2` +                  `rel_year_0` + `rel_year_1` + `rel_year_2` + `rel_year_3` + `rel_year_4` +                  `rel_year_5` + Post | unit + year | 0 | state, data = data, exactDOF = TRUE)      # grab the obs we need   mod2 <- tibble(     estimate = mod$coefficients,     term1 = rownames(mod$coefficients)     )     es <-    mod2 %>%      filter(term1 %in% keepvars) %>%      mutate(t = c(-5:-2, 0:5)) %>%      select(t, estimate)  es }  data_classical <- map_dfr(1:nrep, run_ES_DiD)  colors <- c(\"True Effect\" = \"red\", \"Estimated Effect\" = \"blue\")  ES_plot_classical <- data_classical %>%    group_by(t) %>%    summarize(avg = mean(estimate),             sd = sd(estimate),             lower.ci = avg - 1.96*sd,             upper.ci = avg + 1.96*sd) %>%    bind_rows(tibble(t = -1, avg = 0, sd = 0, lower.ci = 0, upper.ci = 0)) %>%    mutate(true_tau = ifelse(t >= 0, (t + 1)* true_mu, 0)) %>%    ggplot(aes(x = t, y = avg)) +    #geom_linerange(aes(ymin = lower.ci, ymax = upper.ci), color = 'darkgrey', size = 2) +    geom_ribbon(aes(ymin = lower.ci, ymax = upper.ci), color = \"lightgrey\", alpha = 0.2) +   geom_point(color = 'blue', size = 3) +    geom_line(aes(color = 'Estimated Effect'), size = 1) +    geom_line(aes(x = t, y = true_tau, color = 'True Effect'), linetype = \"dashed\", size = 2) +    geom_hline(yintercept = 0, linetype = \"dashed\") +    scale_x_continuous(breaks = -5:5) +    labs(x = \"Relative Time\", y = \"Estimate\") +    theme(axis.title = element_text(size = 14),         axis.text = element_text(size = 12)) +   ggtitle(\"TWFE event-study regression with binned end-points\")+   scale_color_manual(values = colors) +    theme(plot.title = element_text(hjust = 0.5, size = 12),         legend.position = \"bottom\",          legend.title = element_blank())  ES_plot_classical  #ggsave(\"es_plot_classical.png\", ES_plot_classical, width = 10, height = 5, dpi = 150) # function to run ES DID run_ES_DiD_sat <- function(...) {      # resimulate the data   data <- make_data()      # make dummy columns   data <- data %>%      # make relative year indicator     mutate(rel_year = year - cohort_year)      # get the minimum relative year - we need this to reindex   min_year <- min(data$rel_year)      # reindex the relative years   data <- data %>%      mutate(rel_year = rel_year - min_year) %>%      dummy_cols(select_columns = \"rel_year\")      # make regression formula    indics <- paste(\"rel_year\", (1:max(data$rel_year))[-(-1 - min_year)], sep = \"_\", collapse = \" + \")   keepvars <- paste(\"rel_year\", c(-5:-2, 0:5) - min_year, sep = \"_\")     formula <- as.formula(paste(\"dep_var ~\", indics, \"| unit + year | 0 | state\"))      # run mod   mod <- felm(formula, data = data, exactDOF = TRUE)      # grab the obs we need   mod2 <- tibble(     estimate = mod$coefficients,     term1 = rownames(mod$coefficients)     )     es <-    mod2 %>%      filter(term1 %in% keepvars) %>%      mutate(t = c(-5:-2, 0:5)) %>%      select(t, estimate)  es }  data_sat <- map_dfr(1:nrep, run_ES_DiD_sat)  ES_plot_sat <- data_sat %>%    group_by(t) %>%    summarize(avg = mean(estimate),             sd = sd(estimate),             lower.ci = avg - 1.96*sd,             upper.ci = avg + 1.96*sd) %>%    bind_rows(tibble(t = -1, avg = 0, sd = 0, lower.ci = 0, upper.ci = 0)) %>%    mutate(true_tau = ifelse(t >= 0, (t + 1)* true_mu, 0)) %>%    ggplot(aes(x = t, y = avg)) +    #geom_linerange(aes(ymin = lower.ci, ymax = upper.ci), color = 'darkgrey', size = 2) +    geom_ribbon(aes(ymin = lower.ci, ymax = upper.ci), color = \"lightgrey\", alpha = 0.2) +   geom_point(color = 'blue', size = 3) +     geom_line(aes(color = 'Estimated Effect'), size = 1) +     geom_line(aes(x = t, y = true_tau, color = 'True Effect'), linetype = \"dashed\", size = 2) +    geom_hline(yintercept = 0, linetype = \"dashed\") +    scale_x_continuous(breaks = -5:5) +    labs(x = \"Relative Time\", y = \"Estimate\") +    theme(axis.title = element_text(size = 14),         axis.text = element_text(size = 12)) +   ggtitle(\"TWFE event-study regression with 'all' leads and lags\")+   scale_color_manual(values = colors) +    theme(plot.title = element_text(hjust = 0.5, size = 12),         legend.position = \"bottom\",          legend.title = element_blank())           ES_plot_sat  #ggsave(\"es_plot_sat.png\", ES_plot_sat, width = 10, height = 5, dpi = 150)"},{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"using-the-callaway-and-santanna-2021-framework","dir":"Articles","previous_headings":"Setup with all units being eventually treated and homogeneous treatment effect dynamics","what":"Using the Callaway and Sant’Anna (2021) framework","title":"Problems with two-way fixed-effects event-study regressions","text":"Instead using variants TWFE specification , advocate use procedure put forward Callaway Sant’Anna (2021) implemented package . specific DGP, “never-treated” units, can use “-yet-treated” units valid comparison group cohort. Furthermore, since covariates available (play major role analysis), need worry underlying “est_method”. show results associated using Callaway Sant’Anna (2021) procedure. can see, get reliable precise estimates treatment effect dynamics. good news!","code":"# function to run ES DID run_CS <- function(...) {      # resimulate the data   data <- make_data()      mod <- did::att_gt(yname = \"dep_var\",                       tname = \"year\",                      idname = \"unit\",                      gname = \"cohort_year\",                      control_group = \"notyettreated\",                      bstrap = FALSE,                      data = data,                      print_details = FALSE)   event_std <- did::aggte(mod, type = \"dynamic\")      att.egt <- event_std$att.egt   names(att.egt) <- event_std$egt      # grab the obs we need   broom::tidy(att.egt) %>%      filter(names %in% -5:5) %>%      mutate(t = -5:5, estimate = x) %>%      select(t, estimate) }  data_CS <- map_dfr(1:nrep, run_CS)  ES_plot_CS <- data_CS %>%    group_by(t) %>%    summarize(avg = mean(estimate),             sd = sd(estimate),             lower.ci = avg - 1.96*sd,             upper.ci = avg + 1.96*sd) %>%    mutate(true_tau = ifelse(t >= 0, (t + 1)* true_mu, 0)) %>%    ggplot(aes(x = t, y = avg)) +    #geom_linerange(aes(ymin = lower.ci, ymax = upper.ci), color = 'darkgrey', size = 2) +    geom_ribbon(aes(ymin = lower.ci, ymax = upper.ci), color = \"lightgrey\", alpha = 0.2) +   geom_point(color = 'blue', size = 3) +     geom_line(aes(color = 'Estimated Effect'), size = 1) +     geom_line(aes(x = t, y = true_tau, color = 'True Effect'), linetype = \"dashed\", size = 2) +    geom_hline(yintercept = 0, linetype = \"dashed\") +    scale_x_continuous(breaks = -5:5) +    labs(x = \"Relative Time\", y = \"Estimate\") +    theme(axis.title = element_text(size = 14),         axis.text = element_text(size = 12)) +   ggtitle(\"Event-study-parameters estimated using Callaway and Sant'Anna (2021)\\nComparison group: Not-yet-treated\")+     scale_color_manual(values = colors) +    theme(plot.title = element_text(hjust = 0.5, size = 12),         legend.position = \"bottom\",          legend.title = element_blank())  ES_plot_CS  #ggsave(\"es_plot_CS.png\", ES_plot_CS, width = 10, height = 5, dpi = 150)"},{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"setup-with-a-group-that-remains-untreated-at-the-end-of-the-sample","dir":"Articles","previous_headings":"","what":"Setup with a group that remains untreated at the end of the sample","title":"Problems with two-way fixed-effects event-study regressions","text":"One features DGP units eventually get treated. applications, group units remain untreated end sample. call group units “never-treated” group. assess problems associated TWFE specification highlighted persist group units available, modify little bit DGP repeat exercise .","code":""},{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"dgp-with-a-never-treated-group-and-homogeneous-treatment-effect-dynamics","dir":"Articles","previous_headings":"Setup with a group that remains untreated at the end of the sample","what":"DGP with a “never-treated” group and homogeneous treatment effect dynamics","title":"Problems with two-way fixed-effects event-study regressions","text":"DGP consider similar one already considered. difference now suppress treatment last cohort. Put simply, cohort g=2004g=2004 now “never-treated”, implying , DGP unit-specific treatment effects time ttτi,t\\tau_{,t} generated τi,t=μ×(t−g+1)×1{t≥g}1{g≠2004}, \\tau_{,t} = \\mu \\times (t - g + 1)\\times 1\\{t \\ge g \\}1\\{g\\=2004 \\}, μ\\mu instantaneous treatment effect; set μ=1\\mu=1. Like , ATT time unit treated 1, equal 2 one period treatment started, etc.","code":""},{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"visualizing-the-dgp-1","dir":"Articles","previous_headings":"Setup with a group that remains untreated at the end of the sample","what":"Visualizing the DGP","title":"Problems with two-way fixed-effects event-study regressions","text":"Let’s start discussion first visualizing DGP looks like.","code":"## Generate data - treated cohorts consist of 250 obs each, with the treatment effect still = true_mu on average make_data2 <- function(nobs = 1000,                        nstates = 40) {      # unit fixed effects (unobservd heterogeneity)   unit <- tibble(     unit = 1:nobs,     # generate state     state = sample(1:nstates, nobs, replace = TRUE),     unit_fe = rnorm(nobs, state/5, 1),     # generate instantaneous treatment effect     #mu = rnorm(nobs, true_mu, 0.2)     mu = true_mu   )      # year fixed effects (first part)   year <- tibble(     year = 1980:2010,     year_fe = rnorm(length(year), 0, 1)   )      # Put the states into treatment groups   treat_taus <- tibble(     # sample the states randomly     state = sample(1:nstates, nstates, replace = FALSE),     # place the randomly sampled states into 1\\{t \\ge g \\}G_g     cohort_year = sort(rep(c(1986, 1992, 1998, 2004), 10))   )      # make main dataset   # full interaction of unit X year    expand_grid(unit = 1:nobs, year = 1980:2010) %>%      left_join(., unit) %>%      left_join(., year) %>%      left_join(., treat_taus) %>%      # make error term and get treatment indicators and treatment effects     # Also get cohort specific trends (modify time FE)     mutate(error = rnorm(nobs*31, 0, 1),            treat = ifelse((year >= cohort_year)* (cohort_year != 2004), 1, 0),            tau = ifelse(treat == 1, mu, 0),            year_fe = year_fe + 0.1*(year - cohort_year)     ) %>%      # calculate cumulative treatment effects     group_by(unit) %>%      mutate(tau_cum = cumsum(tau)) %>%      ungroup() %>%      # calculate the dep variable     mutate(dep_var = (2010 - cohort_year) + unit_fe + year_fe + tau_cum + error) %>%     # Relabel 2004 cohort as never-treated     mutate(cohort_year = ifelse(cohort_year == 2004, Inf, cohort_year))    } #---------------------------------------------------------------------------- # make data data <- make_data2()  # plot plot2 <- data %>%    ggplot(aes(x = year, y = dep_var, group = unit)) +    geom_line(alpha = 1/8, color = \"grey\") +    geom_line(data = data %>%                group_by(cohort_year, year) %>%                summarize(dep_var = mean(dep_var)),             aes(x = year, y = dep_var, group = factor(cohort_year),                 color = factor(cohort_year)),             size = 2) +    labs(x = \"\", y = \"Value\",  color = \"Treatment group   \") +    geom_vline(xintercept = 1986, color = '#E41A1C', size = 2) +    geom_vline(xintercept = 1992, color = '#377EB8', size = 2) +    geom_vline(xintercept = 1998, color = '#4DAF4A', size = 2) +    #geom_vline(xintercept = 2004, color = '#984EA3', size = 2) +    scale_color_brewer(palette = 'Set1') +    theme(legend.position = 'bottom',         #legend.title = element_blank(),          axis.title = element_text(size = 14),         axis.text = element_text(size = 12)) +   scale_color_manual(labels = c(\"1986\", \"1992\", \"1998\", \"Never-treated\"),                      values = c(\"#E41A1C\", \"#377EB8\", \"#4DAF4A\", \"#984EA3\"))+   ggtitle(\"One draw of the DGP with homogeneous effects across cohorts \\n and with a never-treated group\")+   theme(plot.title = element_text(hjust = 0.5, size = 12))  plot2   #ggsave(\"plot_dgp_never_treated.png\",plot2, width = 10, height = 5, dpi = 100)"},{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"estimating-dynamic-treatment-effects-via-twfe-event-study-regressions-1","dir":"Articles","previous_headings":"Setup with a group that remains untreated at the end of the sample","what":"Estimating dynamic treatment effects via TWFE event-study regressions","title":"Problems with two-way fixed-effects event-study regressions","text":"Like , start estimating TWFE event-study regression Yi,t=αi+αt+γk−KDi,t<−K+∑k=−K−2γkleadDi,tk+∑k=0LγklagDi,tk+γkL+Di,t>L+εi,tY_{,t} = \\alpha_i + \\alpha_t + \\gamma_k^{-K}~ D_{,t}^{<-K} + \\sum_{k=-K}^{-2} \\gamma_k^{lead} D_{,t}^{k} +\\sum_{k=0}^{L}  \\gamma_k^{lag} D_{,t}^{k} + \\gamma_k^{L+} D_{,t}^{>L} + \\varepsilon_{,t} KK LL set 5. , binning end points. can see results , bias still substantial. Thus, problems TWFE specifications persists even “never-treated” group.  Next, consider case one include almost leads lags (K=17K=17 L=24L=24) omit furthest lead K=18K=18.  result shows, never-treated group, treatment effects homogeneous across cohorts, bin event-times, TWFE event-study regressions recover true underlying dynamic treatment effects.","code":"# function to run ES DID # variables we will use keepvars <- c(\"`rel_year_-5`\",  \"`rel_year_-4`\",  \"`rel_year_-3`\",  \"`rel_year_-2`\",               \"rel_year_0\", \"rel_year_1\", \"rel_year_2\", \"rel_year_3\", \"rel_year_4\", \"rel_year_5\")  run_ES_DiD_never <- function(...) {      # resimulate the data   data <- make_data2()   # make dummy columns   data <- data %>%      # make dummies     mutate(rel_year = year - cohort_year) %>%      mutate(rel_year = ifelse(rel_year == -Inf, NA, rel_year))%>%      dummy_cols(select_columns = \"rel_year\") %>%      mutate(across(starts_with(\"rel_year_\"), ~replace_na(., 0))) %>%      # generate pre and post dummies     mutate(Pre = ifelse((rel_year < -5) * (!is.na(rel_year)), 1, 0),            Post = ifelse((rel_year > 5) * (!is.na(rel_year)), 1, 0)) %>%     mutate(Pre = ifelse(is.na(Pre), 0, Pre),            Post = ifelse(is.na(Post), 0, Post))      # estimate the model   mod <- lfe::felm(dep_var ~ Pre + `rel_year_-5` + `rel_year_-4` + `rel_year_-3` + `rel_year_-2` +                  `rel_year_0` + `rel_year_1` + `rel_year_2` + `rel_year_3` + `rel_year_4` +                  `rel_year_5` + Post | unit + year | 0 | state, data = data, exactDOF = TRUE)     # grab the obs we need   mod2 <- tibble(     estimate = mod$coefficients,     term1 = rownames(mod$coefficients)     )     es <-    mod2 %>%      filter(term1 %in% keepvars) %>%      mutate(t = c(-5:-2, 0:5)) %>%      select(t, estimate)  es }  data_classical_never <- map_dfr(1:nrep, run_ES_DiD_never)  ES_plot_classical_never <- data_classical_never %>%    group_by(t) %>%    summarize(avg = mean(estimate),             sd = sd(estimate),             lower.ci = avg - 1.96*sd,             upper.ci = avg + 1.96*sd) %>%    bind_rows(tibble(t = -1, avg = 0, sd = 0, lower.ci = 0, upper.ci = 0)) %>%    mutate(true_tau = ifelse(t >= 0, (t + 1)* true_mu, 0)) %>%    ggplot(aes(x = t, y = avg)) +    #geom_linerange(aes(ymin = lower.ci, ymax = upper.ci), color = 'darkgrey', size = 2) +    geom_ribbon(aes(ymin = lower.ci, ymax = upper.ci), color = \"lightgrey\", alpha = 0.2) +   geom_point(color = 'blue', size = 3) +     geom_line(aes(color = 'Estimated Effect'), size = 1) +     geom_line(aes(x = t, y = true_tau, color = 'True Effect'), linetype = \"dashed\", size = 2) +    geom_hline(yintercept = 0, linetype = \"dashed\") +    scale_x_continuous(breaks = -5:5) +    labs(x = \"Relative Time\", y = \"Estimate\") +    theme(axis.title = element_text(size = 14),         axis.text = element_text(size = 12))+   ggtitle(\"TWFE event-study regression with binned end-points\")+     scale_color_manual(values = colors) +    theme(plot.title = element_text(hjust = 0.5, size = 12),         legend.position = \"bottom\",          legend.title = element_blank())  ES_plot_classical_never  #ggsave(\"es_plot_classical_never.png\", ES_plot_classical_never, width = 10, height = 5, dpi = 150) # function to run ES DID run_ES_DiD_sat_never <- function(...) {      # resimulate the data   data <- make_data2()      # make dummy columns   data <- data %>%      # make relative year indicator     mutate(rel_year = year - cohort_year)      # get the minimum relative year - we need this to reindex   min_year <- min(data$rel_year * (data$rel_year != -Inf), na.rm = T)      # reindex the relative years   data <- data %>%      mutate(rel_year2 = rel_year) %>%      mutate(rel_year = rel_year - min_year) %>%      dummy_cols(select_columns = \"rel_year\") %>%      select(-(\"rel_year_-Inf\"))           # make regression formula    indics <- paste(\"rel_year\", (1:max(data$rel_year))[-(-1 - min_year)], sep = \"_\", collapse = \" + \")   keepvars <- paste(\"rel_year\", c(-5:-2, 0:5) - min_year, sep = \"_\")     formula <- as.formula(paste(\"dep_var ~\", indics, \"| unit + year | 0 | state\"))      # run mod   mod <- felm(formula, data = data, exactDOF = TRUE)      # grab the obs we need  # grab the obs we need   mod2 <- tibble(     estimate = mod$coefficients,     term1 = rownames(mod$coefficients)     )     es <-    mod2 %>%      filter(term1 %in% keepvars) %>%      mutate(t = c(-5:-2, 0:5)) %>%      select(t, estimate)  es }  data_sat_never <- map_dfr(1:nrep, run_ES_DiD_sat_never)  ES_plot_sat_never <- data_sat_never %>%    group_by(t) %>%    summarize(avg = mean(estimate),             sd = sd(estimate),             lower.ci = avg - 1.96*sd,             upper.ci = avg + 1.96*sd) %>%    bind_rows(tibble(t = -1, avg = 0, sd = 0, lower.ci = 0, upper.ci = 0)) %>%    mutate(true_tau = ifelse(t >= 0, (t + 1)* true_mu, 0)) %>%    ggplot(aes(x = t, y = avg)) +    #geom_linerange(aes(ymin = lower.ci, ymax = upper.ci), color = 'darkgrey', size = 2) +    geom_ribbon(aes(ymin = lower.ci, ymax = upper.ci), color = \"lightgrey\", alpha = 0.2) +   geom_point(color = 'blue', size = 3) +     geom_line(aes(color = 'Estimated Effect'), size = 1) +     geom_line(aes(x = t, y = true_tau, color = 'True Effect'), linetype = \"dashed\", size = 2) +    geom_hline(yintercept = 0, linetype = \"dashed\") +    scale_x_continuous(breaks = -5:5) +    labs(x = \"Relative Time\", y = \"Estimate\") +    theme(axis.title = element_text(size = 14),         axis.text = element_text(size = 12))+   ggtitle(\"TWFE event-study regression with 'all' leads and lags\")+   scale_color_manual(values = colors) +    theme(plot.title = element_text(hjust = 0.5, size = 12),         legend.position = \"bottom\",          legend.title = element_blank())  ES_plot_sat_never  #ggsave(\"es_plot_sat_never.png\", ES_plot_sat_never, width = 10, height = 5, dpi = 150)"},{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"using-the-callaway-and-santanna-2021-framework-1","dir":"Articles","previous_headings":"Setup with a group that remains untreated at the end of the sample","what":"Using the Callaway and Sant’Anna (2021) framework","title":"Problems with two-way fixed-effects event-study regressions","text":"Next, show procedure put forward Callaway Sant’Anna (2021) implemented can also used setup. specific DGP, “never-treated” group, can use use different comparison groups: 1) “never-treated” group, 2) “-yet-treated” group. particular DGP, using two different comparison groups recover true underlying dynamic treatment effect. Let’s see indeed case. First, let’s estimate using “never-treated” units comparison group.  expected, results look good! Now, let’s consider “-yet-treated” units comparison group.  expected, results look good, ","code":"# function to run ES DID run_CS_never <- function(...) {      # resimulate the data   data <- make_data2()   data$cohort_year[data$cohort_year==Inf] <- 0      mod <- did::att_gt(yname = \"dep_var\",                       tname = \"year\",                      idname = \"unit\",                      gname = \"cohort_year\",                      control_group = \"never_treated\",                      bstrap = FALSE,                      data = data,                      print_details = FALSE)   event_std <- did::aggte(mod, type = \"dynamic\")      att.egt <- event_std$att.egt   names(att.egt) <- event_std$egt      # grab the obs we need   broom::tidy(att.egt) %>%      filter(names %in% -5:5) %>%      mutate(t = -5:5, estimate = x) %>%      select(t, estimate) }  data_CS_never <- map_dfr(1:nrep, run_CS_never)  ES_plot_CS_never <- data_CS_never %>%    group_by(t) %>%    summarize(avg = mean(estimate),             sd = sd(estimate),             lower.ci = avg - 1.96*sd,             upper.ci = avg + 1.96*sd) %>%    mutate(true_tau = ifelse(t >= 0, (t + 1)* true_mu, 0)) %>%    ggplot(aes(x = t, y = avg)) +    #geom_linerange(aes(ymin = lower.ci, ymax = upper.ci), color = 'darkgrey', size = 2) +    geom_ribbon(aes(ymin = lower.ci, ymax = upper.ci), color = \"lightgrey\", alpha = 0.2) +   geom_point(color = 'blue', size = 3) +     geom_line(aes(color = 'Estimated Effect'), size = 1) +     geom_line(aes(x = t, y = true_tau, color = 'True Effect'), linetype = \"dashed\", size = 2) +    geom_hline(yintercept = 0, linetype = \"dashed\") +    scale_x_continuous(breaks = -5:5) +    labs(x = \"Relative Time\", y = \"Estimate\") +    theme(axis.title = element_text(size = 14),         axis.text = element_text(size = 12))+   ggtitle(\"Event-study-parameters estimated using Callaway and Sant'Anna (2021)\\nComparison group: Never-treated units\")+   scale_color_manual(values = colors) +    theme(plot.title = element_text(hjust = 0.5, size = 12),         legend.position = \"bottom\",          legend.title = element_blank())  ES_plot_CS_never  #ggsave(\"es_plot_CS_never.png\", ES_plot_CS_never, width = 10, height = 5, dpi = 150) # function to run ES DID run_CS_ny <- function(...) {      # resimulate the data   data <- make_data2()   data$cohort_year[data$cohort_year==Inf] <- 0      mod <- did::att_gt(yname = \"dep_var\",                       tname = \"year\",                      idname = \"unit\",                      gname = \"cohort_year\",                      control_group = \"notyettreated\",                      bstrap = FALSE,                      data = data,                      print_details = FALSE)   event_std <- did::aggte(mod, type = \"dynamic\")      att.egt <- event_std$att.egt   names(att.egt) <- event_std$egt      # grab the obs we need   broom::tidy(att.egt) %>%      filter(names %in% -5:5) %>%      mutate(t = -5:5, estimate = x) %>%      select(t, estimate) }  data_CS_ny <- map_dfr(1:nrep, run_CS_ny)  ES_plot_CS_ny <- data_CS_ny %>%    group_by(t) %>%    summarize(avg = mean(estimate),             sd = sd(estimate),             lower.ci = avg - 1.96*sd,             upper.ci = avg + 1.96*sd) %>%    mutate(true_tau = ifelse(t >= 0, (t + 1)* true_mu, 0)) %>%    ggplot(aes(x = t, y = avg)) +    #geom_linerange(aes(ymin = lower.ci, ymax = upper.ci), color = 'darkgrey', size = 2) +    geom_ribbon(aes(ymin = lower.ci, ymax = upper.ci), color = \"lightgrey\", alpha = 0.2) +   geom_point(color = 'blue', size = 3) +     geom_line(aes(color = 'Estimated Effect'), size = 1) +     geom_line(aes(x = t, y = true_tau, color = 'True Effect'), linetype = \"dashed\", size = 2) +    geom_hline(yintercept = 0, linetype = \"dashed\") +    scale_x_continuous(breaks = -5:5) +    labs(x = \"Relative Time\", y = \"Estimate\") +    theme(axis.title = element_text(size = 14),         axis.text = element_text(size = 12))+   ggtitle(\"Event-study-parameters estimated using Callaway and Sant'Anna (2021)\\nComparison group: Not-yet-treated units\")+   scale_color_manual(values = colors) +    theme(plot.title = element_text(hjust = 0.5, size = 12),         legend.position = \"bottom\",          legend.title = element_blank())  ES_plot_CS_ny  #ggsave(\"es_plot_CS_ny.png\", ES_plot_CS_ny, width = 10, height = 5, dpi = 150)"},{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"setup-with-heterogeneous-treatment-effects","dir":"Articles","previous_headings":"","what":"Setup with Heterogeneous Treatment Effects","title":"Problems with two-way fixed-effects event-study regressions","text":"Now, want consider setup heterogeneous treatment effect dynamics “never-treated” group. DGP modification one considered , now “unit-specific” treatment effect time tt given τi,t=μg×(t−g+1)×1{t≥g}1{g≠2004}, \\tau_{,t} = \\mu_g \\times (t - g + 1)\\times 1\\{t \\ge g \\}1\\{g\\=2004 \\}, set μ1986=3\\mu_{1986} = 3, μ1992=2\\mu_{1992} = 2 μ1998=1\\mu_{1998} = 1. implies group started treatment 1986, average treatment effects evolves elapsed time 3,6,9,…3,6, 9,\\dots. group started treatment 1992 (1998), average treatment effect evolves elapsed time 2,4,6,…2,4, 6,\\dots (1,2,3,…1,2, 3,\\dots). course, treatment effect zero “never-treated” cohort (g=2004g=2004, later relabel g=∞g=\\infty). DGP “early-treated” units benefit treatment “later-treated” units. Given group size (average), true average treatment effect dynamic across treated groups (3+2+1)/3=2(3+2+1)/3 = 2 time unit treated, 2×(3+2+1)/3=42 \\times (3+2+1)/3 = 4 first period treatment started, etc.","code":""},{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"visualizing-the-dgp-2","dir":"Articles","previous_headings":"Setup with Heterogeneous Treatment Effects","what":"Visualizing the DGP","title":"Problems with two-way fixed-effects event-study regressions","text":"Like , let’s start discussion visualizing DGP looks like.","code":"## Generate data - treated cohorts consist of 250 obs each, with the treatment effect still = true_mu on average make_data3 <- function(nobs = 1000,                        nstates = 40) {      # unit fixed effects (unobservd heterogeneity)   unit <- tibble(     unit = 1:nobs,     # generate state     state = sample(1:nstates, nobs, replace = TRUE),     unit_fe = rnorm(nobs, state/5, 1),     # generate instantaneous treatment effect     #mu = rnorm(nobs, true_mu, 0.2)     mu = true_mu   )      # year fixed effects (first part)   year <- tibble(     year = 1980:2010,     year_fe = rnorm(length(year), 0, 1)   )      # Put the states into treatment groups   treat_taus <- tibble(     # sample the states randomly     state = sample(1:nstates, nstates, replace = FALSE),     # place the randomly sampled states into 1\\{t \\ge g \\}G_g     cohort_year = sort(rep(c(1986, 1992, 1998, 2004), 10))   )      # make main dataset   # full interaction of unit X year    expand_grid(unit = 1:nobs, year = 1980:2010) %>%      left_join(., unit) %>%      left_join(., year) %>%      left_join(., treat_taus) %>%      # make error term and get treatment indicators and treatment effects     # Also get cohort specific trends (modify time FE)     mutate(error = rnorm(nobs*31, 0, 1),            treat = ifelse((year >= cohort_year)* (cohort_year != 2004), 1, 0),            mu = ifelse(cohort_year==1992, 2, ifelse(cohort_year==1998, 1, 3)),            tau = ifelse(treat == 1, mu, 0),            year_fe = year_fe + 0.1*(year - cohort_year)     ) %>%      # calculate cumulative treatment effects     group_by(unit) %>%      mutate(tau_cum = cumsum(tau)) %>%      ungroup() %>%      # calculate the dep variable     mutate(dep_var = (2010 - cohort_year) + unit_fe + year_fe + tau_cum + error) %>%     # Relabel 2004 cohort as never-treated     mutate(cohort_year = ifelse(cohort_year == 2004, Inf, cohort_year))    } #---------------------------------------------------------------------------- # make data data <- make_data3()  # plot plot3 <- data %>%    ggplot(aes(x = year, y = dep_var, group = unit)) +    geom_line(alpha = 1/8, color = \"grey\") +    geom_line(data = data %>%                group_by(cohort_year, year) %>%                summarize(dep_var = mean(dep_var)),             aes(x = year, y = dep_var, group = factor(cohort_year),                 color = factor(cohort_year)),             size = 2) +    labs(x = \"\", y = \"Value\",  color = \"Treatment group   \") +    geom_vline(xintercept = 1986, color = '#E41A1C', size = 2) +    geom_vline(xintercept = 1992, color = '#377EB8', size = 2) +    geom_vline(xintercept = 1998, color = '#4DAF4A', size = 2) +    #geom_vline(xintercept = 2004, color = '#984EA3', size = 2) +    scale_color_brewer(palette = 'Set1') +    theme(legend.position = 'bottom',         #legend.title = element_blank(),          axis.title = element_text(size = 14),         axis.text = element_text(size = 12)) +   scale_color_manual(labels = c(\"1986\", \"1992\", \"1998\", \"Never-treated\"),                      values = c(\"#E41A1C\", \"#377EB8\", \"#4DAF4A\", \"#984EA3\")) +   ggtitle(\"One draw of the DGP with heterogeneous treatment effect dynamics across cohorts \\n and with a never-treated group\")+   theme(plot.title = element_text(hjust = 0.5, size = 12))  plot3   #ggsave(\"plot_dgp_never_treated_het.png\", plot3, width = 10, height = 5, dpi = 100)"},{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"estimating-dynamic-treatment-effects-via-twfe-event-study-regressions-2","dir":"Articles","previous_headings":"Setup with Heterogeneous Treatment Effects","what":"Estimating dynamic treatment effects via TWFE event-study regressions","title":"Problems with two-way fixed-effects event-study regressions","text":"Like , start estimating TWFE event-study regression Yi,t=αi+αt+γk−KDi,t<−K+∑k=−K−2γkleadDi,tk+∑k=0LγklagDi,tk+γkL+Di,t>L+εi,tY_{,t} = \\alpha_i + \\alpha_t + \\gamma_k^{-K}~ D_{,t}^{<-K} + \\sum_{k=-K}^{-2} \\gamma_k^{lead} D_{,t}^{k} +\\sum_{k=0}^{L}  \\gamma_k^{lag} D_{,t}^{k} + \\gamma_k^{L+} D_{,t}^{>L} + \\varepsilon_{,t} KK LL set 5. , binning end points. can see results , bias still substantial. Given results shown , surprise.  Next, consider case one include almost leads lags (K=17K=17 L=24L=24) omit furthest lead K=18K=18.  result shows, treatment effects dynamics heterogeneous across groups, TWFE event-study regressions recover true underlying dynamic treatment effects, even “never-treated” group available one bin extreme event-times. , red flag usage TWFE-type regressions setups.","code":"# function to run ES DID # variables we will use keepvars <- c(\"`rel_year_-5`\",  \"`rel_year_-4`\",  \"`rel_year_-3`\",  \"`rel_year_-2`\",               \"rel_year_0\", \"rel_year_1\", \"rel_year_2\", \"rel_year_3\", \"rel_year_4\", \"rel_year_5\")  run_ES_DiD_never_het <- function(...) {      # resimulate the data   data <- make_data3()   # make dummy columns   data <- data %>%      # make dummies     mutate(rel_year = year - cohort_year) %>%      mutate(rel_year = ifelse(rel_year == -Inf, NA, rel_year))%>%      dummy_cols(select_columns = \"rel_year\") %>%      mutate(across(starts_with(\"rel_year_\"), ~replace_na(., 0))) %>%      # generate pre and post dummies     mutate(Pre = ifelse((rel_year < -5) * (!is.na(rel_year)), 1, 0),            Post = ifelse((rel_year > 5) * (!is.na(rel_year)), 1, 0)) %>%     mutate(Pre = ifelse(is.na(Pre), 0, Pre),            Post = ifelse(is.na(Post), 0, Post))      # estimate the model   mod <- lfe::felm(dep_var ~ Pre + `rel_year_-5` + `rel_year_-4` + `rel_year_-3` + `rel_year_-2` +                  `rel_year_0` + `rel_year_1` + `rel_year_2` + `rel_year_3` + `rel_year_4` +                  `rel_year_5` + Post | unit + year | 0 | state, data = data, exactDOF = TRUE)      # grab the obs we need # grab the obs we need   mod2 <- tibble(     estimate = mod$coefficients,     term1 = rownames(mod$coefficients)     )     es <-    mod2 %>%      filter(term1 %in% keepvars) %>%      mutate(t = c(-5:-2, 0:5)) %>%      select(t, estimate)  es }  data_classical_never_het <- map_dfr(1:nrep, run_ES_DiD_never_het)  ES_plot_classical_never_het <- data_classical_never_het %>%    group_by(t) %>%    summarize(avg = mean(estimate),             sd = sd(estimate),             lower.ci = avg - 1.96*sd,             upper.ci = avg + 1.96*sd) %>%    bind_rows(tibble(t = -1, avg = 0, sd = 0, lower.ci = 0, upper.ci = 0)) %>%    mutate(true_tau = ifelse(t >= 0, (t + 1)* 2, 0)) %>%    ggplot(aes(x = t, y = avg)) +    #geom_linerange(aes(ymin = lower.ci, ymax = upper.ci), color = 'darkgrey', size = 2) +    geom_ribbon(aes(ymin = lower.ci, ymax = upper.ci), color = \"lightgrey\", alpha = 0.2) +   geom_point(color = 'blue', size = 3) +     geom_line(aes(color = 'Estimated Effect'), size = 1) +     geom_line(aes(x = t, y = true_tau, color = 'True Effect'), linetype = \"dashed\", size = 2) +    geom_hline(yintercept = 0, linetype = \"dashed\") +    scale_x_continuous(breaks = -5:5) +    labs(x = \"Relative Time\", y = \"Estimate\") +    theme(axis.title = element_text(size = 14),         axis.text = element_text(size = 12))+   ggtitle(\"TWFE event-study regression with binned end-points\")+   scale_color_manual(values = colors) +    theme(plot.title = element_text(hjust = 0.5, size = 12),         legend.position = \"bottom\",          legend.title = element_blank())  ES_plot_classical_never_het  #ggsave(\"es_plot_classical_never_het.png\", ES_plot_classical_never_het, width = 10, height = 5, dpi = 150) # function to run ES DID run_ES_DiD_sat_never_het <- function(...) {      # resimulate the data   data <- make_data3()      # make dummy columns   data <- data %>%      # make relative year indicator     mutate(rel_year = year - cohort_year)      # get the minimum relative year - we need this to reindex   min_year <- min(data$rel_year * (data$rel_year != -Inf), na.rm = T)      # reindex the relative years   data <- data %>%      mutate(rel_year2 = rel_year) %>%      mutate(rel_year = rel_year - min_year) %>%      dummy_cols(select_columns = \"rel_year\") %>%      select(-(\"rel_year_-Inf\"))           # make regression formula    indics <- paste(\"rel_year\", (1:max(data$rel_year))[-(-1 - min_year)], sep = \"_\", collapse = \" + \")   keepvars <- paste(\"rel_year\", c(-5:-2, 0:5) - min_year, sep = \"_\")     formula <- as.formula(paste(\"dep_var ~\", indics, \"| unit + year | 0 | state\"))      # run mod   mod <- felm(formula, data = data, exactDOF = TRUE)      # grab the obs we need # grab the obs we need   mod2 <- tibble(     estimate = mod$coefficients,     term1 = rownames(mod$coefficients)     )     es <-    mod2 %>%      filter(term1 %in% keepvars) %>%      mutate(t = c(-5:-2, 0:5)) %>%      select(t, estimate)  es }  data_sat_never_het <- map_dfr(1:nrep, run_ES_DiD_sat_never_het)  ES_plot_sat_never_het <- data_sat_never_het %>%    group_by(t) %>%    summarize(avg = mean(estimate),             sd = sd(estimate),             lower.ci = avg - 1.96*sd,             upper.ci = avg + 1.96*sd) %>%    bind_rows(tibble(t = -1, avg = 0, sd = 0, lower.ci = 0, upper.ci = 0)) %>%    mutate(true_tau = ifelse(t >= 0, (t + 1)* 2, 0)) %>%    ggplot(aes(x = t, y = avg)) +    #geom_linerange(aes(ymin = lower.ci, ymax = upper.ci), color = 'darkgrey', size = 2) +    geom_ribbon(aes(ymin = lower.ci, ymax = upper.ci), color = \"lightgrey\", alpha = 0.2) +   geom_point(color = 'blue', size = 3) +     geom_line(aes(color = 'Estimated Effect'), size = 1) +     geom_line(aes(x = t, y = true_tau, color = 'True Effect'), linetype = \"dashed\", size = 2) +    geom_hline(yintercept = 0, linetype = \"dashed\") +    scale_x_continuous(breaks = -5:5) +    labs(x = \"Relative Time\", y = \"Estimate\") +    theme(axis.title = element_text(size = 14),         axis.text = element_text(size = 12))+   ggtitle(\"TWFE event-study regression with 'all' leads and lags\")+   scale_color_manual(values = colors) +    theme(plot.title = element_text(hjust = 0.5, size = 12),         legend.position = \"bottom\",          legend.title = element_blank())  ES_plot_sat_never_het  #ggsave(\"es_plot_sat_never_het.png\", ES_plot_sat_never_het, width = 10, height = 5, dpi = 150)"},{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"using-the-callaway-and-santanna-2021-framework-2","dir":"Articles","previous_headings":"Setup with Heterogeneous Treatment Effects","what":"Using the Callaway and Sant’Anna (2021) framework","title":"Problems with two-way fixed-effects event-study regressions","text":"Next, show procedure put forward Callaway Sant’Anna (2021) implemented can also used setup. words, Callaway Sant’Anna (2021) proposal rely restricting treatment effect heterogeneity. First, let’s estimate treatment effect dynamics using “never-treated” units comparison group.  expected, results look good! Now, let’s consider “-yet-treated” units comparison group.  expected, results look good, !","code":"# function to run ES DID run_CS_never_het <- function(...) {      # resimulate the data   data <- make_data3()   data$cohort_year[data$cohort_year==Inf] <- 0      mod <- did::att_gt(yname = \"dep_var\",                       tname = \"year\",                      idname = \"unit\",                      gname = \"cohort_year\",                      control_group = \"never_treated\",                      bstrap = FALSE,                      data = data,                      print_details = FALSE)   event_std <- did::aggte(mod, type = \"dynamic\")      att.egt <- event_std$att.egt   names(att.egt) <- event_std$egt      # grab the obs we need   broom::tidy(att.egt) %>%      filter(names %in% -5:5) %>%      mutate(t = -5:5, estimate = x) %>%      select(t, estimate) }  data_CS_never_het <- map_dfr(1:nrep, run_CS_never_het)  ES_plot_CS_never_het <- data_CS_never_het %>%    group_by(t) %>%    summarize(avg = mean(estimate),             sd = sd(estimate),             lower.ci = avg - 1.96*sd,             upper.ci = avg + 1.96*sd) %>%    mutate(true_tau = ifelse(t >= 0, (t + 1)* 2, 0)) %>%    ggplot(aes(x = t, y = avg)) +    #geom_linerange(aes(ymin = lower.ci, ymax = upper.ci), color = 'darkgrey', size = 2) +    geom_ribbon(aes(ymin = lower.ci, ymax = upper.ci), color = \"lightgrey\", alpha = 0.2) +   geom_point(color = 'blue', size = 3) +     geom_line(aes(color = 'Estimated Effect'), size = 1) +     geom_line(aes(x = t, y = true_tau, color = 'True Effect'), linetype = \"dashed\", size = 2) +    geom_hline(yintercept = 0, linetype = \"dashed\") +    scale_x_continuous(breaks = -5:5) +    labs(x = \"Relative Time\", y = \"Estimate\") +    theme(axis.title = element_text(size = 14),         axis.text = element_text(size = 12))+   ggtitle(\"Event-study-parameters estimated using Callaway and Sant'Anna (2021)\\nComparison group: Never-treated units\")+   scale_color_manual(values = colors) +    theme(plot.title = element_text(hjust = 0.5, size = 12),         legend.position = \"bottom\",          legend.title = element_blank())  ES_plot_CS_never_het  #ggsave(\"es_plot_CS_never_het.png\", ES_plot_CS_never_het, width = 10, height = 5) # function to run ES DID run_CS_ny_het <- function(...) {      # resimulate the data   data <- make_data3()   data$cohort_year[data$cohort_year==Inf] <- 0      mod <- did::att_gt(yname = \"dep_var\",                       tname = \"year\",                      idname = \"unit\",                      gname = \"cohort_year\",                      control_group = \"notyettreated\",                      bstrap = FALSE,                      data = data,                      print_details = FALSE)   event_std <- did::aggte(mod, type = \"dynamic\")      att.egt <- event_std$att.egt   names(att.egt) <- event_std$egt      # grab the obs we need   broom::tidy(att.egt) %>%      filter(names %in% -5:5) %>%      mutate(t = -5:5, estimate = x) %>%      select(t, estimate) }  data_CS_ny_het <- map_dfr(1:nrep, run_CS_ny_het)  ES_plot_CS_ny_het <- data_CS_ny_het %>%    group_by(t) %>%    summarize(avg = mean(estimate),             sd = sd(estimate),             lower.ci = avg - 1.96*sd,             upper.ci = avg + 1.96*sd) %>%    mutate(true_tau = ifelse(t >= 0, (t + 1)* 2, 0)) %>%    ggplot(aes(x = t, y = avg)) +    #geom_linerange(aes(ymin = lower.ci, ymax = upper.ci), color = 'darkgrey', size = 2) +    geom_ribbon(aes(ymin = lower.ci, ymax = upper.ci), color = \"lightgrey\", alpha = 0.2) +   geom_point(color = 'blue', size = 3) +     geom_line(aes(color = 'Estimated Effect'), size = 1) +     geom_line(aes(x = t, y = true_tau, color = 'True Effect'), linetype = \"dashed\", size = 2) +    geom_hline(yintercept = 0, linetype = \"dashed\") +    scale_x_continuous(breaks = -5:5) +    labs(x = \"Relative Time\", y = \"Estimate\") +    theme(axis.title = element_text(size = 14),         axis.text = element_text(size = 12))+   ggtitle(\"Event-study-parameters estimated using Callaway and Sant'Anna (2021)\\nComparison group: Not-yet-treated units\")+   scale_color_manual(values = colors) +    theme(plot.title = element_text(hjust = 0.5, size = 12),         legend.position = \"bottom\",          legend.title = element_blank())  ES_plot_CS_ny_het  #ggsave(\"es_plot_CS_ny_het.png\", ES_plot_CS_ny_het, width = 10, height = 5, dpi = 150)"},{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"conclusion","dir":"Articles","previous_headings":"","what":"Conclusion","title":"Problems with two-way fixed-effects event-study regressions","text":"vignette, shown relying TWFE event-study regressions can lead misleading conclusions treatment effect dynamics. hand, approach put forward Callaway Sant’Anna (2021) implement package suffer drawbacks.","code":""},{"path":"https://bcallaway11.github.io/did/articles/TWFE.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Problems with two-way fixed-effects event-study regressions","text":"Borusyak, Kirill, Xavier Jaravel. “Revisiting Event Study Designs”. Available SSRN 2826228 (2018) Callaway, Brantly, Pedro H. C. Sant’Anna. “Difference--differences multiple time periods.” Journal Econometrics, Vol. 225, . 2, pp. 200-230, 2021. Sun, Liyang, Sarah Abraham. “Estimating dynamic treatment effects event studies heterogeneous treatment effects.” Journal Econometrics, Vol. 225, . 2, pp. 175-199, 2021","code":""},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Getting Started with the did Package","text":"vignette discusses basics using Difference--Differences () designs identify estimate average effect participating treatment particular focus tools package. background article Callaway Sant’Anna (2021), “Difference--Differences Multiple Time Periods”. package allows multiple periods variation treatment timing package allows parallel trends assumption hold conditional covariates Treatment effect estimates coming package suffer drawbacks associated two-way fixed effects regressions event study regressions multiple periods / variation treatment timing package can deliver disaggregated group-time average treatment effects well event-study type estimates (treatment effects parameters corresponding different lengths exposure treatment) overall treatment effect estimates. use notation vignette fully explained Introduction Multiple Time Periods vignette.","code":""},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"examples-with-simulated-data","dir":"Articles","previous_headings":"","what":"Examples with simulated data","title":"Getting Started with the did Package","text":"Let’s start really simple example simulated data. , going 4 time periods. 4000 units treated group randomly (equal probability) assigned first participate treatment (group) time period. 4000 ``never treated’’ units. data generating process untreated potential outcomes Yit(0)=θt+ηi+Xi′βt+vit   Y_{}(0) = \\theta_t + \\eta_i + X_i'\\beta_t + v_{} example simple model untreated potential outcomes compatible conditional parallel trends assumption. particular, consider case ηi\\eta_i can distributed differently across groups. means comparisons outcomes levels treated untreated units deliver average treatment effect parameter. Next, notice ΔYit(0)=(θt−θt−1)+Xi′(βt−βt−1)+Δvit \\Delta Y_{}(0) = (\\theta_t - \\theta_{t-1}) + X_i'(\\beta_t - \\beta_{t-1}) + \\Delta v_{} path outcomes depends covariates. , general, unconditional parallel trends valid setup unless either () mean covariates across groups (e.g., treatment groups independent covariates), (ii) βt=βt−1=⋯=β1\\beta_t = \\beta_{t-1} = \\cdots = \\beta_{1} (case path untreated potential outcomes doesn’t actually depend covariates). order think treatment effects, also use following stylized model treated potential outcomes Yit(g)=Yit(0)+𝟏{t≥g}(e+1)+(uit−vit)   Y_{}(g) = Y_{}(0)  + \\mathbf{1}\\{t \\geq g\\} (e+1) + ( u_{} - v_{}) e:=t−ge := t-g event time (.e., difference current time period time unit becomes treated), last term just allows error terms different treated untreated potential outcomes. immediately follows , particular example, ATT(g,t)=e+1ATT(g,t) = e+1 post-treatment periods t≥gt \\ge g. words, average effect participating treatment units group gg equal length exposure plus one. Note , simplicity, considering case treatment effects homogeneous across groups. Also, setup, units anticipate treatment status, -anticipation assumption also satisfied. simulations, also set ηi∼N(Gi,1)\\eta_i \\sim N(G_i, 1) GiG_i group individual belongs , Xi∼N(μDi,1)X_i \\sim N( \\mu_{D_i}, 1) μDi=1\\mu_{D_i} = 1 never treated units 0 otherwise, vit∼N(0,1)v_{} \\sim N(0,1), uit∼N(0,1)u_{} \\sim N(0,1). Also, random variables drawn independently .","code":""},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"estimating-group-time-average-treatment-effects","dir":"Articles","previous_headings":"Examples with simulated data","what":"Estimating Group-Time Average Treatment Effects","title":"Getting Started with the did Package","text":"Building dataset Estimating Group-Time Average Treatment Effects main function estimate group-time average treatment effects att_gt function. See documentation . basic call att_gt given following summary example_attgt provides estimates group-time average treatment effects column labeled att, corresponding bootstrapped-based standard errors given column se. corresponding groups times given columns group time. -anticipation parallel trends assumptions, group-time average treatment effects identified periods t≥gt \\geq g (.e., post-treatment periods group). table also reports pseudo group-time average treatment effects t<gt < g (.e., pre-treatment periods group gg). can used pre-test parallel trends assumption (long assume -anticipation assumption indeed holds). addition, results Wald pre-test parallel trends assumption reported summary results. much detailed discussion using package pre-testing available . Next, ’ll demonstrate plot group-time average treatment effects. plot , use ggdid function builds ggplot2 package.  resulting figure one contains separate plots group. Notice figure , first plot labeled “Group 2”, second “Group 3”, etc. , figure contains estimates group-time average treatment effects group time period along simultaneous confidence interval. red dots plots pre-treatment pseudo group-time average treatment effects useful pre-testing parallel trends assumption. blue dots post-treatment group-time average treatment effects interpreted average effect participating treatment units particular group particular point time.","code":"# set seed so everything is reproducible set.seed(1814)  # generate dataset with 4 time periods sp <- reset.sim() sp$te <- 0 time.periods <- 4  # add dynamic effects sp$te.e <- 1:time.periods  # generate data set with these parameters # here, we dropped all units who are treated in time period 1 as they do not help us recover ATT(g,t)'s. dta <- build_sim_dataset(sp)  # How many observations remained after dropping the ``always-treated'' units nrow(dta) #> [1] 15916 #This is what the data looks like head(dta) #> # A tibble: 6 × 7 #>       G      X    id cluster period     Y treat #>   <dbl>  <dbl> <int>   <int>  <dbl> <dbl> <dbl> #> 1     3 -0.876     1       5      1  5.56     1 #> 2     3 -0.876     1       5      2  4.35     1 #> 3     3 -0.876     1       5      3  7.13     1 #> 4     3 -0.876     1       5      4  6.24     1 #> 5     2 -0.874     2      36      1 -3.66     1 #> 6     2 -0.874     2      36      2 -1.27     1 # estimate group-time average treatment effects using att_gt method example_attgt <- att_gt(yname = \"Y\",                         tname = \"period\",                         idname = \"id\",                         gname = \"G\",                         xformla = ~X,                         data = dta                         )  # summarize the results summary(example_attgt) #>  #> Call: #> att_gt(yname = \"Y\", tname = \"period\", idname = \"id\", gname = \"G\",  #>     xformla = ~X, data = dta) #>  #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015>  #>  #> Group-Time Average Treatment Effects: #>  Group Time ATT(g,t) Std. Error [95% Simult.  Conf. Band]   #>      2    2   0.9209     0.0638        0.7486      1.0932 * #>      2    3   1.9875     0.0633        1.8164      2.1586 * #>      2    4   2.9552     0.0680        2.7715      3.1389 * #>      3    2  -0.0433     0.0660       -0.2215      0.1349   #>      3    3   1.1080     0.0670        0.9271      1.2890 * #>      3    4   2.0590     0.0652        1.8828      2.2352 * #>      4    2   0.0023     0.0634       -0.1690      0.1736   #>      4    3   0.0615     0.0643       -0.1122      0.2353   #>      4    4   0.9523     0.0691        0.7656      1.1391 * #> --- #> Signif. codes: `*' confidence band does not cover 0 #>  #> P-value for pre-test of parallel trends assumption:  0.60857 #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust # plot the results ggdid(example_attgt)"},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"other-features-of-the-did-package","dir":"Articles","previous_headings":"Examples with simulated data","what":"Other features of the did package","title":"Getting Started with the did Package","text":"discussion covered basic case using package. number simple extensions useful applications.","code":""},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"adjustments-for-multiple-hypothesis-testing","dir":"Articles","previous_headings":"Examples with simulated data > Other features of the did package","what":"Adjustments for Multiple Hypothesis Testing","title":"Getting Started with the did Package","text":"default, package reports simultaneous confidence bands plots group-time average treatment effects multiple time periods – confidence bands robust multiple hypothesis testing [essentially, idea use standard errors make adjustment critical value account multiple testing – example section, critical value 95% uniform confidence band 2.7 instead 1.96]. can turn compute analytical standard errors corresponding figures pointwise confidence intervals setting bstrap=FALSE, cband=FALSE call att_gt…don’t recommend !","code":""},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"aggregating-group-time-average-treatment-effects","dir":"Articles","previous_headings":"Examples with simulated data > Other features of the did package","what":"Aggregating group-time average treatment effects","title":"Getting Started with the did Package","text":"many applications, can large number groups time periods. case, may infeasible interpret plots group-time average treatment effects. package provides number ways aggregate group-time average treatment effects using aggte function.","code":""},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"simple-aggregation","dir":"Articles","previous_headings":"Examples with simulated data > Other features of the did package > Aggregating group-time average treatment effects","what":"Simple Aggregation","title":"Getting Started with the did Package","text":"One idea likely immediately come mind just return weighted average group-time average treatment effects weights proportional group size. available calling aggte function type = simple. sort aggregation immediately avoids negative weights issue two-way fixed effects regressions can suffer , often think better alternatives. particular, simple aggregation tends overweight effect early-treated groups simply observe post-treatment periods. think likely better alternatives applications.","code":"agg.simple <- aggte(example_attgt, type = \"simple\") summary(agg.simple) #>  #> Call: #> aggte(MP = example_attgt, type = \"simple\") #>  #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015>  #>  #>  #>     ATT    Std. Error     [ 95%  Conf. Int.]   #>  1.6583        0.0333     1.5931      1.7236 * #>  #>  #> --- #> Signif. codes: `*' confidence band does not cover 0 #>  #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust"},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"dynamic-effects-and-event-studies","dir":"Articles","previous_headings":"Examples with simulated data > Other features of the did package > Aggregating group-time average treatment effects","what":"Dynamic Effects and Event Studies","title":"Getting Started with the did Package","text":"One common alternative approaches aggregate group-time effects event study plot. Group-time average treatment effects can immediately averaged average treatment effects different lengths exposure treatment using following code:  figure, x-axis length exposure treatment. Length exposure equal 0 provides average effect participating treatment across groups time period first participate treatment (instantaneous treatment effect). Length exposure equal -1 corresponds time period groups first participate treatment, length exposure equal 1 corresponds first time period initial exposure treatment. expect based data generated, looks like parallel trends holds pre-treatment periods effect participating treatment increasing length exposure treatment. Overall ATT averages average treatment effects across lengths exposure treatment.","code":"agg.es <- aggte(example_attgt, type = \"dynamic\") summary(agg.es) #>  #> Call: #> aggte(MP = example_attgt, type = \"dynamic\") #>  #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015>  #>  #>  #> Overall summary of ATT's based on event-study/dynamic aggregation:   #>     ATT    Std. Error     [ 95%  Conf. Int.]   #>  1.9904        0.0375     1.9169      2.0639 * #>  #>  #> Dynamic Effects: #>  Event time Estimate Std. Error [95% Simult.  Conf. Band]   #>          -2   0.0023     0.0705       -0.1777      0.1824   #>          -1   0.0105     0.0409       -0.0939      0.1149   #>           0   0.9929     0.0319        0.9115      1.0742 * #>           1   2.0231     0.0477        1.9013      2.1450 * #>           2   2.9552     0.0622        2.7964      3.1141 * #> --- #> Signif. codes: `*' confidence band does not cover 0 #>  #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust ggdid(agg.es)"},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"group-specific-effects","dir":"Articles","previous_headings":"Examples with simulated data > Other features of the did package > Aggregating group-time average treatment effects","what":"Group-Specific Effects","title":"Getting Started with the did Package","text":"Another idea look average effects specific group. also straightforward aggregate group-time average treatment effects group-specific average treatment effects using following code:  figure, y-axis categorized group. x-axis provides estimates average effect participating treatment units group averaged across time periods group becomes treated. example, average effect participating treatment largest group 2 – effect treatment increases length exposure treatment, group exposed treatment longest. Overall ATT averages group-specific treatment effects across groups. view, parameter leading choice overall summary effect participating treatment. average effect participating treatment experienced across units participate treatment period. sense, similar interpretation ATT textbook case exactly two periods two groups.","code":"agg.gs <- aggte(example_attgt, type = \"group\") summary(agg.gs) #>  #> Call: #> aggte(MP = example_attgt, type = \"group\") #>  #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015>  #>  #>  #> Overall summary of ATT's based on group/cohort aggregation:   #>    ATT    Std. Error     [ 95%  Conf. Int.]   #>  1.488        0.0343     1.4208      1.5553 * #>  #>  #> Group Effects: #>  Group Estimate Std. Error [95% Simult.  Conf. Band]   #>      2   1.9545     0.0520        1.8298      2.0793 * #>      3   1.5835     0.0562        1.4488      1.7183 * #>      4   0.9523     0.0649        0.7968      1.1078 * #> --- #> Signif. codes: `*' confidence band does not cover 0 #>  #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust ggdid(agg.gs) #> `height` was translated to `width`."},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"calendar-time-effects","dir":"Articles","previous_headings":"Examples with simulated data > Other features of the did package > Aggregating group-time average treatment effects","what":"Calendar Time Effects","title":"Getting Started with the did Package","text":"Finally, package allows aggregations across different time periods.  figure, x-axis time period estimates along y-axis average effect participating treatment particular time period groups participated treatment time period.","code":"agg.ct <- aggte(example_attgt, type = \"calendar\") summary(agg.ct) #>  #> Call: #> aggte(MP = example_attgt, type = \"calendar\") #>  #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015>  #>  #>  #> Overall summary of ATT's based on calendar time aggregation:   #>     ATT    Std. Error     [ 95%  Conf. Int.]   #>  1.4808        0.0347     1.4128      1.5488 * #>  #>  #> Time Effects: #>  Time Estimate Std. Error [95% Simult.  Conf. Band]   #>     2   0.9209     0.0632        0.7722      1.0697 * #>     3   1.5491     0.0496        1.4324      1.6659 * #>     4   1.9724     0.0500        1.8547      2.0901 * #> --- #> Signif. codes: `*' confidence band does not cover 0 #>  #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust ggdid(agg.ct)"},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"small-group-sizes","dir":"Articles","previous_headings":"Examples with simulated data > Other features of the did package","what":"Small Group Sizes","title":"Getting Started with the did Package","text":"Small group sizes can sometimes cause estimation problems package. give example, groups fewer observations number covariates model, code error. package reports warning groups fewer 5 observations. addition, statistical inference, particularly group-time average treatment may become tenuous small groups. example, effective sample size estimating change outcomes time individuals particular group equal number observations group asymptotic results unlikely provide good approximations sampling distribution group-time average treatment effects number units group small. cases, one cautious interpreting ATT(g,t)ATT(g,t) results small groups. reasonable alternative approach case just focus aggregated treatment effect parameters (.e., run aggte(..., type = \"group\") aggte(...,type = \"dynamic\")). cases, effective sample size total number units ever treated. long total number ever treated units “large” (case many application), statistical inference results provided package stable.","code":""},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"selecting-alternative-control-groups","dir":"Articles","previous_headings":"Examples with simulated data > Other features of the did package","what":"Selecting Alternative Control Groups","title":"Getting Started with the did Package","text":"default, package uses group units never participate treatment control group. case, group never participates, package drop last period set units become treated last period control group (also throw warning). option control group use “yet treated”. “yet treated” include never treated well units , particular point time, treated yet (though eventually become treated). group least large never treated group though changes across time periods. use “yet treated” control, set option control_group=\"notyettreated\".","code":"example_attgt_altcontrol <- att_gt(yname = \"Y\",                                    tname = \"period\",                                    idname = \"id\",                                    gname = \"G\",                                    xformla = ~X,                                    data = dta,                                    control_group = \"notyettreated\"                                              ) summary(example_attgt_altcontrol)"},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"repeated-cross-sections","dir":"Articles","previous_headings":"Examples with simulated data > Other features of the did package","what":"Repeated cross sections","title":"Getting Started with the did Package","text":"package can also work repeated cross section rather panel data. data repeated cross sections, simply set option panel = FALSE. case, idname also ignored. usage standpoint, everything else identical case panel data.","code":""},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"unbalanced-panel-data","dir":"Articles","previous_headings":"Examples with simulated data > Other features of the did package","what":"Unbalanced Panel Data","title":"Getting Started with the did Package","text":"default, package takes panel data , balanced, coerces balanced panel dropping units observations missing time period. However, user specifies option allow_unbalanced_panel = TRUE, package coerce data balanced. Practically, main cost computation time increase case. also recommend users think carefully unbalanced panel proceeding direction.","code":""},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"alternative-estimation-methods","dir":"Articles","previous_headings":"Examples with simulated data > Other features of the did package","what":"Alternative Estimation Methods","title":"Getting Started with the did Package","text":"package implements 2×22 \\times 2 estimators DRDID package. default, package uses “doubly robust” estimators based first step linear regressions outcome variable logit generalized propensity score. options “ipw” inverse probability weighting “reg” regression. argument est_method also available pass custom function estimating 2 periods 2 groups. See documentation details. Fair Warning: advanced use package done caution.","code":"example_attgt_reg <- att_gt(yname = \"Y\",                             tname = \"period\",                             idname = \"id\",                             gname = \"G\",                             xformla = ~X,                             data = data,                             est_method = \"reg\"                             ) summary(example_attgt_reg)"},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"an-example-with-real-data","dir":"Articles","previous_headings":"","what":"An example with real data","title":"Getting Started with the did Package","text":"Next, use subset data comes Callaway Sant’Anna (2020). dataset contains county-level teen employment rates 2003-2007. data can loaded mpdta balanced panel 2500 observations. dataset looks like Data Requirements particular applications, dataset look like key parts : dataset long format – row corresponds particular unit particular point time. Sometimes panel data wide format – row contains information particular unit time periods. convert wide long R, one can use tidyr::pivot_longer function. example needs id variable. mpdta, variable countyreal. vary time particular units. name variable passed methods package setting, example, idname = \"countyreal\" needs time variable. mpdta, variable year. name variable passed methods package setting, example, tname = \"year\" application, outcome lemp. name variable passed methods package setting, example, yname = \"lemp\" needs group variable. mpdta, variable first.treat. time period individual first becomes treated. individuals never treated, variable set equal 0. name variable passed methods package setting, example, gname = \"first.treat\" package allows incorporating covariates parallel trends assumption holds conditioning covariates. mpdta, lpop log county population. package requires covariates time-invariant. time varying covariates, package sets value covariate equal value covariate “base period” , post-treatment periods base period period immediately observations particular group become treated (anticipation, anticipation effects start ), pre-treatment periods base period period right current period. Covariates passed formula package setting, example, xformla = ~lpop. estimators unconditional parallel trends, xformla argument can left blank can set xformla = ~1 include constant.","code":"data(mpdta) head(mpdta) #>     year countyreal     lpop     lemp first.treat treat #> 866 2003       8001 5.896761 8.461469        2007     1 #> 841 2004       8001 5.896761 8.336870        2007     1 #> 842 2005       8001 5.896761 8.340217        2007     1 #> 819 2006       8001 5.896761 8.378161        2007     1 #> 827 2007       8001 5.896761 8.487352        2007     1 #> 937 2003       8019 2.232377 4.997212        2007     1"},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"the-effect-of-the-minimum-wage-on-youth-employment","dir":"Articles","previous_headings":"An example with real data","what":"The Effect of the Minimum Wage on Youth Employment","title":"Getting Started with the did Package","text":"Next, walk straightforward, realistic way use package carry application. Side Comment: just example use method real-world setup. really evaluate effect minimum wage teen employment, one need careful along number dimensions. Thus, results displayed interpreted illustrative . ’ll consider two cases. first case, condition covariates. second, condition log county population (“real” application, one might want condition covariates).  things notice case appear much evidence parallel trends assumption. One fails reject using Wald test reported summary; likewise uniform confidence bands cover 0 pre-treatment periods. evidence negative effects minimum wage employment. Two group-time average treatment effects negative statistically different 0. results also suggest may helpful aggregate group-time average treatment effects.  continue simultaneous confidence bands dynamic effects. results broadly similar ones group-time average treatment effects: one fails reject parallel trends pre-treatment periods looks like somewhat negative effects minimum wage youth employment. One potential issue dynamic effect estimators composition groups changes different lengths exposure event study plots. example, group states increased minimum wage 2007, can identify instantaneous average effect minimum wage (e=0e=0), whereas states raised minimum wage 2004 (2006), can identify average effect minimum wage event-times e=0,1,2,3e=0,1,2,3 (e=0,1e=0,1). computing event-study plot e=0e=0, aggregate effects three groups, case e=1,2,3e=1,2,3. effects minimum wage systematically different across groups (, much evidence effect groups seems close 0 impact perhaps becoming negative time), can lead confounding dynamics selective treatment timing among different groups. One way combat balance sample () including groups exposed treatment least certain number time periods (ii) look dynamic effects time periods. package, one can specifying balance_e option. , set balance_e = 1 – consider groups states treated 2004 2006 (can compute event-study-type parameters e=0,1e=0,1), drops group treated 2007 (can compute event-study-type parameter e=1e=1 group)), looks instantaneous average effects average effect one period states raised minimum wage.  Finally, can run results including covariate. application results turn nearly identical, provide just code estimating group-time average treatment effects including covariates. steps otherwise .","code":"# estimate group-time average treatment effects without covariates mw.attgt <- att_gt(yname = \"lemp\",                    gname = \"first.treat\",                    idname = \"countyreal\",                    tname = \"year\",                    xformla = ~1,                    data = mpdta                    )  # summarize the results summary(mw.attgt) #>  #> Call: #> att_gt(yname = \"lemp\", tname = \"year\", idname = \"countyreal\",  #>     gname = \"first.treat\", xformla = ~1, data = mpdta) #>  #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015>  #>  #> Group-Time Average Treatment Effects: #>  Group Time ATT(g,t) Std. Error [95% Simult.  Conf. Band]   #>   2004 2004  -0.0105     0.0243       -0.0753      0.0543   #>   2004 2005  -0.0704     0.0331       -0.1586      0.0178   #>   2004 2006  -0.1373     0.0412       -0.2470     -0.0275 * #>   2004 2007  -0.1008     0.0358       -0.1963     -0.0054 * #>   2006 2004   0.0065     0.0230       -0.0547      0.0677   #>   2006 2005  -0.0028     0.0210       -0.0588      0.0533   #>   2006 2006  -0.0046     0.0175       -0.0513      0.0421   #>   2006 2007  -0.0412     0.0196       -0.0936      0.0111   #>   2007 2004   0.0305     0.0147       -0.0087      0.0697   #>   2007 2005  -0.0027     0.0156       -0.0442      0.0387   #>   2007 2006  -0.0311     0.0179       -0.0789      0.0168   #>   2007 2007  -0.0261     0.0175       -0.0726      0.0205   #> --- #> Signif. codes: `*' confidence band does not cover 0 #>  #> P-value for pre-test of parallel trends assumption:  0.16812 #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust  # plot the results # set ylim so that all plots have the same scale along y-axis ggdid(mw.attgt, ylim = c(-.3, .3)) # aggregate the group-time average treatment effects mw.dyn <- aggte(mw.attgt, type = \"dynamic\") summary(mw.dyn) #>  #> Call: #> aggte(MP = mw.attgt, type = \"dynamic\") #>  #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015>  #>  #>  #> Overall summary of ATT's based on event-study/dynamic aggregation:   #>      ATT    Std. Error     [ 95%  Conf. Int.]   #>  -0.0772        0.0203    -0.1171     -0.0374 * #>  #>  #> Dynamic Effects: #>  Event time Estimate Std. Error [95% Simult.  Conf. Band]   #>          -3   0.0305     0.0157       -0.0084      0.0694   #>          -2  -0.0006     0.0136       -0.0343      0.0332   #>          -1  -0.0245     0.0144       -0.0601      0.0112   #>           0  -0.0199     0.0124       -0.0507      0.0108   #>           1  -0.0510     0.0163       -0.0913     -0.0106 * #>           2  -0.1373     0.0402       -0.2369     -0.0376 * #>           3  -0.1008     0.0354       -0.1886     -0.0131 * #> --- #> Signif. codes: `*' confidence band does not cover 0 #>  #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust ggdid(mw.dyn, ylim = c(-.3, .3)) mw.dyn.balance <- aggte(mw.attgt, type = \"dynamic\", balance_e = 1) summary(mw.dyn.balance) #>  #> Call: #> aggte(MP = mw.attgt, type = \"dynamic\", balance_e = 1) #>  #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015>  #>  #>  #> Overall summary of ATT's based on event-study/dynamic aggregation:   #>      ATT    Std. Error     [ 95%  Conf. Int.]   #>  -0.0288        0.0135    -0.0552     -0.0023 * #>  #>  #> Dynamic Effects: #>  Event time Estimate Std. Error [95% Simult.  Conf. Band]   #>          -2   0.0065     0.0237       -0.0515      0.0646   #>          -1  -0.0028     0.0207       -0.0534      0.0479   #>           0  -0.0066     0.0155       -0.0444      0.0313   #>           1  -0.0510     0.0171       -0.0927     -0.0092 * #> --- #> Signif. codes: `*' confidence band does not cover 0 #>  #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust ggdid(mw.dyn.balance, ylim = c(-.3, .3)) mw.attgt.X <- att_gt(yname = \"lemp\",                      gname = \"first.treat\",                      idname = \"countyreal\",                      tname = \"year\",                      xformla = ~lpop,                      data = mpdta                      )"},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"common-issues-with-the-did-package","dir":"Articles","previous_headings":"An example with real data","what":"Common Issues with the did package","title":"Getting Started with the did Package","text":"update section common issues people run using package. Please feel free contact us questions comments. package built handle staggered treatment adoption designs. means individual becomes treated, remain treated subsequent periods.","code":""},{"path":"https://bcallaway11.github.io/did/articles/did-basics.html","id":"bugs","dir":"Articles","previous_headings":"An example with real data","what":"Bugs","title":"Getting Started with the did Package","text":"also welcome (encourage) users report bugs / difficulties using code.","code":""},{"path":"https://bcallaway11.github.io/did/articles/extensions.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Writing Extensions to the did Package","text":"vignette provides example extending ideas package cases. see central idea approach researchers carefully make comparisons want make. can tricky operationalize though. code come close covering possible cases one like identification hold type parallel trends assumption. vignette, demonstrate difference differences individuals anticipate participating treatment potentially adjust behavior participate. Although now allow treatment anticipation package using anticipation argument, still think helpful show simplified version code behind package researchers can potentially borrow/modify one-applications conform exactly expected setup package. see ’s complicated! vignette, ’s math. notation may self-explanatory, see Introduction Multiple Time Periods precise explanations notation.","code":""},{"path":"https://bcallaway11.github.io/did/articles/extensions.html","id":"did-with-anticipation","dir":"Articles","previous_headings":"","what":"DiD with Anticipation","title":"Writing Extensions to the did Package","text":"example give next one individuals anticipate participating treatment adjust behavior (least outcomes change) actually participate treatment. feature applications economics – example, labor applications job training job displacement, individual’s earnings often “dip” just actually participate treatment. One solution impose parallel trends holds, adjust periods holds. One version make assumption Parallel Trends Anticipation groups time periods t≥g−1t \\ge g-1E[Yt(0)−Yg−2(0)|G=g]=E[Yt(0)−Yg−2(0)|C=1]   E[Y_t(0) - Y_{g-2}(0) | G=g] = E[Y_t(0) - Y_{g-2}(0) | C=1] words, path outcomes, absence participating treatment, periods (g−2)(g-2) tt individuals group gg (observed) untreated individuals (observed). case, straightforward show , t≥g−1t \\ge g-1, ATT(g,t)=E[Yt−Yg−2|G=g]−E[Yt−Yg−2|C=1]   ATT(g,t) = E[Y_t - Y_{g-2} | G=g] - E[Y_t - Y_{g-2} | C=1] similar main case covered package (see discussion Introduction Multiple Time Periods vignette), except “base period” (g−2)(g-2) (two periods individuals group gg become treated) rather (g−1)(g-1) (one period individuals group gg become treated) setup used package. worried units anticipate treatment participation two periods treatment actually starts, address setting base period (g−3)(g-3) instead. worth pointing , however, tradeoff. Allowing periods anticipation require parallel trends assumption hold periods order identify group-time average treatment effects. rate, vignette, stick case researcher wants allow anticipation exactly one period units participate treatment.","code":""},{"path":"https://bcallaway11.github.io/did/articles/extensions.html","id":"computing-treatment-effects-under-did-with-anticipation","dir":"Articles","previous_headings":"DiD with Anticipation","what":"Computing Treatment Effects under DiD with Anticipation","title":"Writing Extensions to the did Package","text":"start , want point important part vignette much particular application, rather just demonstrate write code particular case. code instructive extending sorts ideas cases may show applications. ’ll write simplified version code – fast code package, demonstrate relatively straightforward write code modified versions approach. [BTW, code slow either, basically things run thousand observations couple minutes rather couple seconds.] start , ’ve constructed dataset (called dta) anticipation. groups follow parallel trends (absence treatment) except period immediately treatment (due treatment anticipation). periods, outcomes individuals participate treatment “dip” – , decrease 1 pre-treatment period. post-treatment periods, effect participating treatment equal 1. simulated data, features common , example, application evaluating effect job training program. data looks like G defines period individual first becomes treated, X covariate ’ll ignore (parallel trends holds example without condition X), Y outcome. first step, ’ll try estimating effect participating treatment (focus dynamic effects event study plot) just ignoring possibility anticipation.  figure, blue line “truth”. can see anticipation leads two things. First, leads rejecting parallel trends assumptions – can correctly visualize anticipation effects quite helpful understanding going . Second, however, anticipation effects feed treatment effect estimates. , -estimate effect participating treatment due anticipation. Also, note example really simple, easy come cases results much complicated anticipation. Next want write code getting around anticipation. notes: goal write simple version code – ’s possible write faster code given , trade-code running fast amount time spent writing . writing one-project anticipation, ’d . way implemented feature package, hand, faster. code (much) optimized R. tried write code easy understand (close ) portable another programming language without much trouble. Code computes event-study-type estimator, easily compute aggregation look group-time average treatment effects ’s wanted. Now code. ’ll start writing function compute group-time average treatment effects dynamic effects given dataset (’ll rely dataset variables called G, id, period, Y, easy modify). , function simplified version ’s going behind scenes package. Now, function compute group-time average treatment effects dynamic effects. Let’s use data Finally, let’s compute standard errors using nonparametric bootstrap (different much slower multiplier bootstrap use package); ’ll just focus dynamic effects estimator Finally, can translate plot. [One last thing , keep things simple, going plot pointwise confidence intervals, strongly suggest computing simultaneous confidence bands practice.]  , black line estimate blue line “truth”. can immediately see get things right account anticipation. thing notice estimate dynamic effects many different lengths exposure, price pay accounting anticipation.","code":"nrow(dta) #> [1] 35940 head(dta) #>       G          X id period        Y treat #> 1     4 -0.9499532  1      1 4.152386     1 #> 8001  4 -0.9499532  1      2 3.675474     1 #> 16001 4 -0.9499532  1      3 1.502463     1 #> 24001 4 -0.9499532  1      4 2.588400     1 #> 32001 4 -0.9499532  1      5 1.538801     1 #> 2     3 -1.6527306  2      1 2.463654     1 # estimate group-time average treatment effects using att_gt method # (and ignoring pre-treatment \"dip\") attgt.ignoredip <- att_gt(yname = \"Y\",                           tname = \"period\",                           idname = \"id\",                           gname = \"G\",                           xformla = ~1,                           data = dta,                           )  # summarize the results summary(attgt.ignoredip) #>  #> Call: #> att_gt(yname = \"Y\", tname = \"period\", idname = \"id\", gname = \"G\",  #>     xformla = ~1, data = dta) #>  #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015>  #>  #> Group-Time Average Treatment Effects: #>  Group Time ATT(g,t) Std. Error [95% Simult.  Conf. Band]   #>      3    2  -0.9867     0.0921       -1.2437     -0.7297 * #>      3    3   1.9663     0.0650        1.7850      2.1476 * #>      3    4   1.9931     0.0860        1.7531      2.2331 * #>      3    5   2.0575     0.1199        1.7230      2.3919 * #>      4    2   0.0267     0.0548       -0.1261      0.1795   #>      4    3  -0.8470     0.1168       -1.1728     -0.5212 * #>      4    4   1.9373     0.0695        1.7433      2.1313 * #>      4    5   2.0648     0.0974        1.7931      2.3366 * #>      5    2   0.0019     0.0576       -0.1587      0.1625   #>      5    3   0.0115     0.0543       -0.1401      0.1632   #>      5    4  -0.7937     0.1519       -1.2175     -0.3699 * #>      5    5   2.1602     0.0707        1.9628      2.3575 * #> --- #> Signif. codes: `*' confidence band does not cover 0 #>  #> P-value for pre-test of parallel trends assumption:  0 #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust  # make dynamic effects plot p <- ggdid(aggte(attgt.ignoredip, \"dynamic\"))  # add actual treatment effects to the plot library(ggplot2) truth <- cbind.data.frame(e = seq(-3,2), att.e = c(0,0,-1,1,1,1)) p <- p + geom_line(data = truth, aes(x = e, y = att.e), inherit.aes = FALSE, color = \"blue\") p <- p + geom_point(data = truth, aes(x = e, y = att.e), inherit.aes = FALSE, color = \"blue\") p compute.attgt <- function(dta) {   # pick up all groups   groups <- unique(dta$G)    # pick up all time periods   time.periods <- unique(dta$period)    # sort the groups and drop the untreated group   groups <- sort(groups)[-1]    # sort the time periods and drop the first two   # (can't compute treatment effects for these two   # periods with one-period anticipation -- w/o anticipation   # we would just drop one period here)   time.periods <- sort(time.periods)[-c(1,2)]    # drop last time period (because we don't know if   # these units are affected by anticipation or not   # and we are being very careful)   # (if you were worried about more than one anticipation   # period here, would need to drop more time periods   # from the end)   time.periods <- time.periods[-length(time.periods)]    # list to store all group-time average treatment effects   # that we calculate   attgt.list <- list()   counter <- 1    # loop over all groups   for (g in groups) {      # get the correct \"base\" period for this group     # (subtract 2 to avoid anticipation)     main.base.period <- g - 2          # loop over all time periods     for (tp in time.periods) {        #----------------------------------------------------       # if it's a pre-treatment time period (used for the       # pre-test, we need to adjust the base period)        # group not treated yet       if (tp < g) {         # move two periods before         base.period <- tp - 2       } else {         # this is a post-treatment period         base.period <- main.base.period       }       #----------------------------------------------------        #----------------------------------------------------       # now, all we need to do is collect the right subset       # of the data and estimate a 2x2 DiD        # get group g and untreated group       this.data <- subset(dta, G==g | G==0)        # get current period and base period data       this.data <- subset(this.data, period==tp | period==base.period)        # set up to compute 2x2 estimator       Ypost <- subset(this.data, period==tp)$Y       Ypre <- subset(this.data, period==base.period)$Y        # dummy variable being in group g       G <- 1*(subset(this.data, period==tp)$G == g)        # compute 2x2 estimator using DRDID package       # (in this unconditional case, it would be straightforward       # to calculate the 2x2 att just using averages, but we       # like the DRDID package as it will work for more complicated       # cases as well)       attgt <- DRDID::reg_did_panel(Ypost, Ypre, G, covariates=NULL)$ATT        # save results       attgt.list[[counter]] <- list(att=attgt, group=g, time.period=tp)       counter <- counter+1       #----------------------------------------------------      }   }    #-----------------------------------------------------------------------------   # aggregate into dynamic effects      # turn results into a data.frame   attgt.results <- do.call(\"rbind.data.frame\", attgt.list)    # add event time to the results   attgt.results$e <- attgt.results$time.period - attgt.results$group      # calculate relative sizes of each group   # (will be used as weights)   n.group <- sapply(groups, function(gg) nrow(subset(dta, G==gg)))   # merge in group sizes   ngroup.mat <- cbind(groups, n.group)   attgt.results <- merge(attgt.results, ngroup.mat, by.x = \"group\", by.y = \"groups\")    # event times to calculate dynamic effects   eseq <- unique(attgt.results$e)    eseq <- sort(eseq)    # calculate average effects by event time   att.e <- c()   counter <- 1   for (this.e in eseq) {     # get subset of results at this event time     res.e <- subset(attgt.results, e==this.e)      # calculate weights by group size     res.e$weight <- res.e$n.group / sum(res.e$n.group)      # calculate dynamic effect as weighted average     att.e[counter] <- sum(res.e$att * res.e$weight)      # on to the next one     counter <- counter+1   }    # store dynamic effects results   dyn.results <- cbind.data.frame(e = eseq, att.e = att.e)    # return group-time average treatment effects and dynamic effects   return(list(attgt.results=attgt.results[,c(\"group\",\"att\",\"time.period\")],               dyn.results=dyn.results)) } anticipation.results <- compute.attgt(dta) anticipation.results #> $attgt.results #>   group         att time.period #> 1     3  0.97958850           3 #> 2     3  1.00638860           4 #> 3     4 -0.82029907           3 #> 4     4  1.09030729           4 #> 5     5  0.01348315           3 #> 6     5 -0.78216442           4 #>  #> $dyn.results #>    e       att.e #> 1 -2  0.01348315 #> 2 -1 -0.80112469 #> 3  0  1.03522713 #> 4  1  1.00638860 # the number of bootstrap iterations biters <- 100  # list to store bootstrap results boot.res <- list()  # loop for each nonparametric bootstrap iteration for (b in 1:biters) {   # draw a bootstrap sample; here, we'll call an outside function   bdata <- BMisc::blockBootSample(dta, \"id\")    # call our function for estimating dynamic effects on the   # bootstrapped data   boot.res[[b]] <- compute.attgt(bdata)$dyn.results$att.e }  # use the bootstrapped results to compute standard errors boot.res <- t(simplify2array(boot.res)) boot.se <- apply(boot.res, 2, sd)  # add the standard errors to the main results dyn.results <- anticipation.results$dyn.results dyn.results$att.se <- boot.se p <- ggplot(data=dyn.results, aes(x=e, y=att.e)) +   geom_line() +   geom_point() +   geom_errorbar(aes(ymin=(att.e-1.96*att.se), ymax=(att.e+1.96*att.se)), width=0.1) +   theme_bw()  p <- p + geom_line(data=truth, aes(x=e, y=att.e), inherit.aes=FALSE, color=\"blue\") p <- p + geom_point(data=truth, aes(x=e, y=att.e), inherit.aes=FALSE, color=\"blue\") p"},{"path":"https://bcallaway11.github.io/did/articles/extensions.html","id":"conclusion","dir":"Articles","previous_headings":"","what":"Conclusion","title":"Writing Extensions to the did Package","text":"vignette, illustrated one apply principles package case units anticipate participating treatment. relatively straightforward exercise, think showing sort extension potentially useful situations fit exactly cases covered package.","code":""},{"path":"https://bcallaway11.github.io/did/articles/multi-period-did.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Introduction to DiD with Multiple Time Periods","text":"Difference--differences one common approaches identifying estimating causal effect participating treatment outcome. “canonical” version involves two periods two groups. untreated group never participates treatment, treated group becomes treated second period. However, much applied work deals cases two time periods different units can become treated different points time. Regardless number time periods, far leading approach applied work try estimate effect treatment using two-way fixed effects (TWFE) linear regression. works great case two periods, number recent methodological papers suggest may substantial drawbacks using TWFE multiple time periods. vignette briefly discusses emerging literature multiple time periods – issues standard approaches well remedies potential problems. package implements number remedies. vignette use package available . background article vignettes Callaway Sant’Anna (2021), “Difference--Differences Multiple Time Periods”.","code":""},{"path":"https://bcallaway11.github.io/did/articles/multi-period-did.html","id":"background","dir":"Articles","previous_headings":"","what":"Background","title":"Introduction to DiD with Multiple Time Periods","text":"start , ’ll consider background material section. First, ’ll discuss two time periods two groups – “canonical” case . Second, briefly consider issues TWFE linear regressions multiple time periods.","code":""},{"path":"https://bcallaway11.github.io/did/articles/multi-period-did.html","id":"did-with-2-periods-and-2-groups","dir":"Articles","previous_headings":"Background","what":"DiD with 2 Periods and 2 Groups","title":"Introduction to DiD with Multiple Time Periods","text":"baseline case one two periods (let’s call periods tt t−1t-1) two groups (treated group untreated group). Notation / Setup s∈{t,t−1}s \\\\{t,t-1\\}, Yis(0)Y_{}(0) unit ii’s untreated potential outcomes – outcome unit ii experience period ss participate treatment s∈{t,t−1}s \\\\{t,t-1\\}, Yis(1)Y_{}(1) unit ii’s treated potential outcome – outcome unit ii experience period ss participate treatment. Set D=1D=1 units treated group D=0D=0 units untreated group first period, one participates treatment. second period, units treated group become treated. means observed outcomes given Yit−1=Yit−1(0)andYit=DiYit(1)+(1−Di)Yit(0) Y_{-1} = Y_{-1}(0) \\quad \\textrm{} \\quad Y_{} = D_i Y_{}(1) + (1-D_i) Y_{}(0)  words, first period, observe untreated potential outcomes everyone (-anticipation assumption built ). second period, observe treated potential outcomes units actually participate treatment untreated potential outcomes units participate treatment. main parameter interest designs Average Treatment Effect Treated (ATT). given ATT=E[Yt(1)−Yt(0)|D=1] ATT = E[Y_t(1) - Y_t(0) | D=1]  difference treated untreated potential outcomes, average, units treated group. main assumption designs called parallel trends assumption: Parallel Trends Assumption E[Yt(0)−Yt−1(0)|D=1]=E[Yt(0)−Yt−1|D=0]   E[Y_t(0) - Y_{t-1}(0)| D=1] = E[ Y_t(0)-Y_{t-1} | D=0] words, assumption says change (“path”) outcomes time units treated group experienced participated treatment path outcomes units untreated group actually experienced. parallel trends assumption allows level untreated potential outcomes differ across groups consistent , example, fixed effects models untreated potential outcomes mean unobserved fixed effect can different across groups. assumption potentially useful path untreated potential outcomes units treated group (term left equation) known, researcher observe path untreated potential outcomes units untreated group (term right equation). fact, straightforward show , parallel trends assumption, ATTATT identified given ATT=E[Yt−Yt−1|D=1]−E[Yt−Yt−1|D=0]   ATT = E[ Y_t - Y_{t-1}| D=1] - E[ Y_t - Y_{t-1}| D=0] , ATTATT difference mean change outcomes time experienced units treated group adjusted mean change outcomes time experienced units untreated group; latter term, parallel trends assumption, path outcomes units treated group participated treatment.","code":""},{"path":"https://bcallaway11.github.io/did/articles/multi-period-did.html","id":"two-way-fixed-effects-regressions","dir":"Articles","previous_headings":"Background","what":"Two way fixed effects regressions","title":"Introduction to DiD with Multiple Time Periods","text":"Now let’s move general case 𝒯\\mathcal{T} total time periods. Denote particular time periods tt t=1,…,𝒯t=1,\\ldots,\\mathcal{T}. far common approach trying estimate effect binary treatment setup TWFE linear regression. regression like Yit=θt+ηi+αDit+vit Y_{} = \\theta_t + \\eta_i + \\alpha D_{} + v_{}  θt\\theta_t time fixed effect, ηi\\eta_i unit fixed effect, DitD_{} treatment dummy variable, vitv_{} time varying unobservables mean independent everything else, α\\alpha presumably parameter interest. α\\alpha often interpreted average effect participating treatment. Although essentially standard approach applied work, number recent papers point potentially severe drawbacks using TWFE estimation procedure. include: Borusyak Jaravel (2018), Goodman-Bacon (2021), de Chaisemartin D’Haultfoeuille (2020), Sun Abraham (2021). TWFE work? Effects really aren’t heterogeneous. effect participating treatment really α\\alpha units, TWFE work great. said, many applications, treatment effects likely heterogeneous – may vary across different units exhibit dynamics change across different time periods. particular applications, worth thinking , , least view, think heterogeneous effects participating treatment leading case. two time periods. canonical case (2 periods, one group becomes treated second period, never treated). case, parallel trends -anticipation, α\\alpha going numerically equal ATTATT. words, case, even though looks like restricted effect participating treatment across units, TWFE exhibits robustness treatment effect heterogeneity. Unfortunately, robustness treatment effect heterogeneity continue hold periods groups become treated different points time. TWFE robust treatment effect heterogeneity? entire papers written , see, e.g., Borusyak Jaravel (2018), Goodman-Bacon (2021), de Chaisemartin D’Haultfoeuille (2020), Sun Abraham (2021). short version: TWFE regression, units whose treatment status doesn’t change time serve comparison group units whose treatment status change time. multiple time periods variation treatment timing, comparisons : newly treated units relative ``never treated’’ units (good!) newly treated units relative ``-yet treated’’ units (good!) newly treated units relative already treated units (bad!!!) first two comparisons good (least spirit ) take path outcomes experienced units become treated adjust path outcomes experienced units participating treatment. third comparison different though: adjusts path outcomes newly treated units path outcomes already treated units. path untreated potential outcomes, includes treatment effect dynamics. Thus, dynamics appear α\\alpha, making hard give clear causal interpretation. issue can potentially severe consequences. example, possible come examples effect participating treatment positive units time periods, TWFE estimation procedure leads estimating negative effect participating treatment. Even case ``negative weights’’ can ruled , α\\alpha recover weighted average ATT′sATT's, though weights hard interpret.","code":""},{"path":"https://bcallaway11.github.io/did/articles/multi-period-did.html","id":"treatment-effects-in-difference-in-differences-designs-with-multiple-periods","dir":"Articles","previous_headings":"","what":"Treatment Effects in Difference in Differences Designs with Multiple Periods","title":"Introduction to DiD with Multiple Time Periods","text":"light potential problems TWFE regressions designs multiple periods, alternative approaches can used case? Yes, turns complicated! just matter using ``good/desirable’’ comparisons groups instead possible comparisons. fix ideas, let’s provide extended notation clear identifying assumptions going make. Notation Yit(0)Y_{}(0) unit ii’s untreated potential outcome. outcome unit ii experience period tt participate treatment. Yit(g)Y_{}(g) unit ii’s potential outcome time period tt become treated period gg. GiG_i time period unit ii becomes treated (often groups defined time period unit becomes treated; hence, GG notation). CiC_i indicator variable whether unit ii never-treated group. DitD_{} indicator variable whether unit ii treated time tt. YitY_{} unit ii’s observed outcome time period tt. units never-treated group, Yit=Yit(0)Y_{} = Y_{}(0) time periods. units groups, observe Yit=𝟏{Gi>t}Yit(0)+𝟏{Gi≤t}Yit(Gi)Y_{} = \\mathbf{1}\\{ G_i > t\\} Y_{}(0) + \\mathbf{1}\\{G_i \\leq t \\} Y_{}(G_i). notation bit complicated, words, observe untreated potential outcomes units yet participated treatment, observe treated potential outcomes units start participate treatment (can depend became treated). Implicit notation treatment anticipation assumption, can relaxed discussed Callaway Sant’Anna (2021), “Difference--Differences Multiple Time Periods”. XiX_i vector pre-treatment covariates.","code":""},{"path":"https://bcallaway11.github.io/did/articles/multi-period-did.html","id":"main-assumptions","dir":"Articles","previous_headings":"Treatment Effects in Difference in Differences Designs with Multiple Periods","what":"Main Assumptions","title":"Introduction to DiD with Multiple Time Periods","text":"Staggered Treatment Adoption Assumption Recall Dit=1D_{} = 1 unit ii treated time tt Dit=0D_{}=0 otherwise. , t=1,...,𝒯−1t=1,...,\\mathcal{T}-1, Dit=1⟹Dit+1=1D_{} = 1 \\implies D_{+1} = 1. Staggered treatment adoption implies unit participates treatment, remain treated. words, units “forget” treatment experience. leading case many applications economics. example, case policies roll different locations period time. also case many unit-level treatments “scarring” effect. example, context job training, many applications consider participating treatment ever defining treatment. Within context, believe hard analyze non-staggered treatment setups without restricting treatment effect heterogeneity across time, groups, treatment sequences, etc. main reason focus leading case. Parallel Trends Assumption based never-treated units g=2,...,𝒯g=2,...,\\mathcal{T}, t=2,...,𝒯t=2,...,\\mathcal{T} t≥gt \\ge g, E[Yt(0)−Yt−1(0)|G=g]=E[Yt(0)−Yt−1(0)|C=1]   E[ Y_t(0) - Y_{t-1}(0) | G=g] = E[ Y_t(0) - Y_{t-1}(0)| C=1] natural extension parallel trends assumption two periods two groups case. says , absence treatment, average untreated potential outcomes group first treated time gg “never treated” group followed parallel paths post-treatment periods t≥gt \\ge g. Note aforementioned parallel trend assumption rely using ``never treated’’ units comparison group “eventually treated” groups. presumes () (large enough) “never-treated” group available data, (ii) units “similar enough” eventually treated units can indeed used valid comparison group. situations conditions satisfied, one can use alternative parallel trends assumption uses -yet treated units valid comparison groups. Parallel Trends Assumption based -yet treated units g=2,...,𝒯g=2,...,\\mathcal{T}, s,t=2,...,𝒯s,t=2,...,\\mathcal{T} t≥gt \\ge g s≥ts \\ge tE[Yt(0)−Yt−1(0)|G=g]=E[Yt(0)−Yt−1(0)|Ds=0,G≠g]   E[ Y_t(0) - Y_{t-1}(0) | G=g] = E[ Y_t(0) - Y_{t-1}(0)| D_s=0, G\\=g]  plain English, assumption states one can use -yet-treated time ss (s≥ts \\ge t) units valid comparison groups computing average treatment effect group first treated time gg. general, assumption uses data constructing comparison groups. However, noted Marcus Sant’Anna (2021), assumption restrict pre-treatment trends across different groups. words, free-lunch.","code":""},{"path":"https://bcallaway11.github.io/did/articles/multi-period-did.html","id":"group-time-average-treatment-effects","dir":"Articles","previous_headings":"","what":"Group-Time Average Treatment Effects","title":"Introduction to DiD with Multiple Time Periods","text":"assumptions natural extensions identifying assumptions two periods two groups case multiple periods case. Likewise, natural way generalize parameter interest (ATT) two periods two groups case multiple periods case define group-time average treatment effects: ATT(g,t)=E[Yt(g)−Yt(0)|G=g]   ATT(g,t) = E[Y_t(g) - Y_t(0) | G=g] average effect participating treatment units group gg time period tt. Notice two time periods two groups (canonical case), average treatment effect treated given ATT=ATT(g=2,t=2)ATT = ATT(g=2,t=2). give couple examples, suppose researcher access three time periods. , ATT(g=2,t=3)ATT(g=2,t=3) average effect participating treatment group units become treated time period 2, time period 3. Similarly, ATT(g=3,t=3)ATT(g=3,t=3) average effect participating treatment group units become treated time period 3, time period 3. Identification Group-Time Average Treatment Effects either version parallel trends assumptions mentioned , straightforward show group-time average treatment effects identified. instance, one impose parallel trends assumption based “never-treated units”, , t≥gt \\ge gATT(g,t)=E[Yt−Yg−1|G=g]−E[Yt−Yg−1|C=1]. ATT(g,t) = E[ Y_t - Y_{g-1}| G=g] - E[ Y_t - Y_{g-1}| C=1].  Alternatively, one impose parallel trends assumption based “-yet-treated units”, , t≥gt \\ge gATT(g,t)=E[Yt−Yg−1|G=g]−E[Yt−Yg−1|Dt=0,G≠g]. ATT(g,t) = E[ Y_t - Y_{g-1}| G=g] - E[ Y_t - Y_{g-1}| D_t=0, G\\=g]. group-time average treatment effects building blocks understanding effect participating treatment designs multiple time periods.","code":""},{"path":"https://bcallaway11.github.io/did/articles/multi-period-did.html","id":"parallel-trends-conditional-on-covariates","dir":"Articles","previous_headings":"","what":"Parallel Trends Conditional on Covariates","title":"Introduction to DiD with Multiple Time Periods","text":"many cases, parallel trends assumption substantially plausible holds conditioning observed pre-treatment covariates. words, parallel trends assumptions modified Conditional Parallel Trends Assumption based never-treated units g=2,...,𝒯g=2,...,\\mathcal{T}, t=2,...,𝒯t=2,...,\\mathcal{T} t≥gt \\ge g, E[Yt(0)−Yt−1(0)|X,G=g]=E[Yt(0)−Yt−1(0)|X,C=1]   E[ Y_t(0) - Y_{t-1}(0) |X, G=g] = E[ Y_t(0) - Y_{t-1}(0)| X, C=1] Parallel Trends Assumption based -yet treated units g=2,...,𝒯g=2,...,\\mathcal{T}, s,t=2,...,𝒯s,t=2,...,\\mathcal{T} t≥gt \\ge g s≥ts \\ge tE[Yt(0)−Yt−1(0)|X,G=g]=E[Yt(0)−Yt−1(0)|X,Ds=0,G≠g]   E[ Y_t(0) - Y_{t-1}(0) | X, G=g] = E[ Y_t(0) - Y_{t-1}(0)|X, D_s=0, G\\=g] parallel trends assumptions conditional analogues previous ones. Importantly, allow covariate-specific trends outcomes across groups, can particularly important setups distribution covariates varies across groups. example case assumption attractive one researcher interested estimating effect participating job training earnings. case, path earnings (absence participating job training) depends things like education, previous occupation, years experience (almost certainly ), important condition types variables order make parallel trends credible. case, parameter interest still often ATT(g,t)′sATT(g,t)'s (aggregation). still straightforward identify estimate ATTATT case. Basically, one needs estimate change outcomes units untreated group conditional XX, average XX distribution covariates individuals group gg obtain ATT(g,t)ATT(g,t) (see Callaway Sant’Anna (2021) references therein many details). practice, can use different approaches recover parameters. precisely, can estimate ATT(g,t)′sATT(g,t)'s using outcome-regressions, inverse probability weighting, doubly-robust methods. package automates user.","code":""},{"path":"https://bcallaway11.github.io/did/articles/multi-period-did.html","id":"aggregating-group-time-average-treatment-effects","dir":"Articles","previous_headings":"","what":"Aggregating Group-Time Average Treatment Effects","title":"Introduction to DiD with Multiple Time Periods","text":"Group-time average treatment effects natural parameters identify context multiple periods multiple groups. many applications, may lot . benefits costs . main benefit relatively straightforward think heterogeneous effects across groups time using group-time average treatment effects. hand, can hard summarize (e.g., just single number). paper, Callaway Sant’Anna (2021), “Difference--Differences Multiple Time Periods”, propose number ways aggregate group-time average treatment effects. , just consider important ones think applied researchers often interested . First, consider average effect participating treatment, separately group. given θS(g)=1𝒯−g+1∑t=2𝒯𝟏{g≤t}ATT(g,t).   \\theta_S(g) = \\frac{1}{\\mathcal{T} - g + 1} \\sum_{t=2}^{\\mathcal{T}} \\mathbf{1}\\{g \\leq t\\} ATT(g,t). parameter may interest right, since allows one highlight treatment effect heterogeneity respect treatment adoption period. Furthermore, fairly straightforward aggregate θS(g)\\theta_S(g) get easy--interpret overall effect parameter, θSO:=∑g=2𝒯θS(g)P(G=g).   \\theta^O_S := \\sum_{g=2}^{\\mathcal{T}} \\theta_S(g) P(G=g). θSO\\theta^O_S overall effect participating treatment across groups ever participated treatment. view, close multi-period analogue ATTATT two period case. Thus, researcher constrained report single treatment effect summary parameter, recommend reporting θSO\\theta^O_S. setups multiple periods, natural ask “treatment effects vary elapsed treatment time?” , note researchers interested understanding treatment effect dynamics. heart event-study-type analysis widespread applied work. case, natural way aggregate group-time average treatment effect highlight treatment effect dynamics given θD(e):=∑g=2𝒯𝟏{g+e≤𝒯}ATT(g,g+e)P(G=g|G+e≤𝒯).   \\theta_D(e) := \\sum_{g=2}^{\\mathcal{T}} \\mathbf{1} \\{ g + e \\leq \\mathcal{T} \\} ATT(g,g+e) P(G=g | G+e \\leq \\mathcal{T}). average effect participating treatment group units exposed treatment exactly ee time periods. aggregations available package examples real data available Getting Started Package vignette. Callaway Sant’Anna (2021), also discuss additional aggregation schemes. encourage take look!","code":""},{"path":"https://bcallaway11.github.io/did/articles/multi-period-did.html","id":"conclusion","dir":"Articles","previous_headings":"","what":"Conclusion","title":"Introduction to DiD with Multiple Time Periods","text":"vignette covered basic background issues multiple periods. Callaway Sant’Anna (2021) discusses many extensions provided package well. See User Guides details.","code":""},{"path":"https://bcallaway11.github.io/did/articles/multi-period-did.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Introduction to DiD with Multiple Time Periods","text":"Borusyak, Kirill, Xavier Jaravel. “Revisiting Event Study Designs”. Available SSRN 2826228 (2018) Callaway, Brantly, Pedro H. C. Sant’Anna. “Difference--differences multiple time periods.” Journal Econometrics, Vol. 225, . 2, pp. 200-230, 2021. de Chaisemartin, Clement, Xavier d’Haultfoeuille. “Two-way fixed effects estimators heterogeneous treatment effects.” American Economic Review 110.9 (2020): 2964-96. Goodman-Bacon, Andrew. Difference--differences variation treatment timing.” Journal Econometrics, Vol. 225, . 2, pp. 254-277, 2021 Marcus, Michelle, Pedro H. C. Sant’Anna. “Role Parallel Trends Event Study Settings: Application Environmental Economics”. Journal Association Environmental Resource Economists, Vol. 8, . 2, pp. 235-275, 2021 Sun, Liyang, Sarah Abraham. “Estimating dynamic treatment effects event studies heterogeneous treatment effects.” Journal Econometrics, Vol. 225, . 2, pp. 175-199, 2021","code":""},{"path":"https://bcallaway11.github.io/did/articles/pre-testing.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Pre-Testing in a DiD Setup using the did Package","text":"vignette provides discussion conduct pre-tests setups using package One appealing feature many applications multiple periods researcher can pre-test parallel trends assumptions. idea simple: although one can always test whether parallel trends holds, one can check holds periods treated units actually become treated. Importantly, just pre-test; different actual test. Whether parallel trends assumption holds pre-treatment periods actually tell holds current period (need hold!). certainly possible identifying assumptions hold previous periods hold current periods; also possible identifying assumptions violated previous periods hold current periods. said, view pre-test piece evidence credibility design particular application. vignette, demonstrate approach used package pre-testing may work substantially better common “event study regression”.","code":""},{"path":"https://bcallaway11.github.io/did/articles/pre-testing.html","id":"common-approaches-to-pre-testing-in-applications","dir":"Articles","previous_headings":"","what":"Common Approaches to Pre-Testing in Applications","title":"Pre-Testing in a DiD Setup using the did Package","text":"far common approach pre-testing applications run event-study regression. , idea run regression includes leads lags treatment dummy variable Yit=θt+ηi+∑l=−𝒯𝒯−1Ditlμl+vit   Y_{} = \\theta_t + \\eta_i + \\sum_{l=-\\mathcal{T}}^{\\mathcal{T}-1} D_{}^l \\mu_l + v_{} Ditl=1D_{}^l = 1 individual ii exposed treatment ll periods period tt, Ditl=0D_{}^l = 0 otherwise. clear , helpful give examples. Suppose individual ii becomes treated period 3. , Dit0=1D_{}^0 = 1 t=3t=3 equal 0 time periods Dit2=1D_{}^2 = 1 t=5t=5 equal 0 time periods Dit−2=1D_{}^{-2} = 1 t=1t=1 equal 0 time periods. μl\\mu_l interpreted effect treatment different lengths exposure treatment. Typically, μ−1\\mu_{-1} normalized equal 0, follow convention . common interpret estimated μl\\mu_l’s l<0l < 0 way pre-test parallel trends assumption.","code":""},{"path":[]},{"path":"https://bcallaway11.github.io/did/articles/pre-testing.html","id":"best-case-scenario-for-pre-testing","dir":"Articles","previous_headings":"Common Approaches to Pre-Testing in Applications > Pitfalls with Event Study Regressions","what":"Best Case Scenario for Pre-Testing","title":"Pre-Testing in a DiD Setup using the did Package","text":"First, let’s start case event study regression going work well pre-testing parallel trends assumption main thing notice : dynamics common across groups. case event-study regression work. Next, bit code  notice everything looks good . pre-test performs well (caveat standard errors “pointwise” better uniform confidence bands though seem standard practice applications). can compare happens using package:   Overall, everything looks good using either approach. (Just keep things fair, report pointwise confidence intervals group-time average treatment effects, easy get uniform confidence bands setting options bstrap=TRUE, cband=TRUE call att_gt.)","code":"# generate dataset with 4 time periods time.periods <- 4  # generate dynamic effects te.e <- time.periods:1  # generate data set with these parameters # (main thing: it generates a dataset that satisfies # parallel trends in all periods...including pre-treatment) data <- build_sim_dataset()  head(data) #>       G        X id period         Y treat #> 1     2 0.530541  1      1  4.264584     1 #> 8001  2 0.530541  1      2 10.159789     1 #> 16001 2 0.530541  1      3  9.482624     1 #> 24001 2 0.530541  1      4 10.288278     1 #> 2     4 1.123550  2      1  3.252148     1 #> 8002  4 1.123550  2      2  7.038382     1 #----------------------------------------------------------------------------- # modify the dataset a bit so that we can run an event study #-----------------------------------------------------------------------------  # generate leads and lags of the treatment Dtl <- sapply(-(time.periods-1):(time.periods-2), function(l) {     dtl <- 1*( (data$period == data$G + l) & (data$G > 0) )     dtl }) Dtl <- as.data.frame(Dtl) cnames1 <- paste0(\"Dtmin\", (time.periods-1):1) colnames(Dtl) <- c(cnames1, paste0(\"Dt\", 0:(time.periods-2))) data <- cbind.data.frame(data, Dtl) row.names(data) <- NULL  head(data) #>   G        X id period         Y treat Dtmin3 Dtmin2 Dtmin1 Dt0 Dt1 Dt2 #> 1 2 0.530541  1      1  4.264584     1      0      0      1   0   0   0 #> 2 2 0.530541  1      2 10.159789     1      0      0      0   1   0   0 #> 3 2 0.530541  1      3  9.482624     1      0      0      0   0   1   0 #> 4 2 0.530541  1      4 10.288278     1      0      0      0   0   0   1 #> 5 4 1.123550  2      1  3.252148     1      1      0      0   0   0   0 #> 6 4 1.123550  2      2  7.038382     1      0      1      0   0   0   0  #----------------------------------------------------------------------------- # run the event study regression #-----------------------------------------------------------------------------  # load plm package library(plm)  # run event study regression # normalize effect to be 0 in pre-treatment period es <- plm(Y ~ Dtmin3 + Dtmin2 + Dt0 + Dt1 + Dt2,            data = data, model = \"within\", effect = \"twoways\",           index = c(\"id\", \"period\"))  summary(es) #> Twoways effects Within Model #>  #> Call: #> plm(formula = Y ~ Dtmin3 + Dtmin2 + Dt0 + Dt1 + Dt2, data = data,  #>     effect = \"twoways\", model = \"within\", index = c(\"id\", \"period\")) #>  #> Balanced Panel: n = 6988, T = 4, N = 27952 #>  #> Residuals: #>       Min.    1st Qu.     Median    3rd Qu.       Max.  #> -9.8577453 -0.7594999  0.0066022  0.7639995 11.6570179  #>  #> Coefficients: #>        Estimate Std. Error t-value Pr(>|t|)     #> Dtmin3 0.041851   0.070134  0.5967   0.5507     #> Dtmin2 0.023539   0.050044  0.4704   0.6381     #> Dt0    4.012515   0.043824 91.5602   <2e-16 *** #> Dt1    3.005615   0.054473 55.1767   <2e-16 *** #> Dt2    2.098672   0.077281 27.1565   <2e-16 *** #> --- #> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 #>  #> Total Sum of Squares:    82617 #> Residual Sum of Squares: 55795 #> R-Squared:      0.32466 #> Adj. R-Squared: 0.099232 #> F-statistic: 2014.84 on 5 and 20956 DF, p-value: < 2.22e-16  #----------------------------------------------------------------------------- # make an event study plot #-----------------------------------------------------------------------------  # some housekeeping for making the plot # add 0 at event time -1 coefs1 <- coef(es) ses1 <- sqrt(diag(summary(es)$vcov)) idx.pre <- 1:(time.periods-2) idx.post <- (time.periods-1):length(coefs1) coefs <- c(coefs1[idx.pre], 0, coefs1[idx.post]) ses <- c(ses1[idx.pre], 0, ses1[idx.post]) exposure <- -(time.periods-1):(time.periods-2)  cmat <- data.frame(coefs=coefs, ses=ses, exposure=exposure)  library(ggplot2)  ggplot(data = cmat, mapping = aes(y = coefs, x = exposure)) +   geom_line(linetype = \"dashed\") +   geom_point() +    geom_errorbar(aes(ymin = (coefs-1.96*ses), ymax = (coefs+1.96*ses)), width = 0.2) +   ylim(c(-2, 5)) +   theme_bw() # estimate group-group time average treatment effects did_att_gt <- att_gt(yname = \"Y\",                      tname = \"period\",                      idname = \"id\",                      gname = \"G\",                      data = data,                      bstrap = FALSE,                      cband = FALSE) summary(did_att_gt) #>  #> Call: #> att_gt(yname = \"Y\", tname = \"period\", idname = \"id\", gname = \"G\",  #>     data = data, bstrap = FALSE, cband = FALSE) #>  #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015>  #>  #> Group-Time Average Treatment Effects: #>  Group Time ATT(g,t) Std. Error [95% Pointwise  Conf. Band]   #>      2    2   4.0048     0.0859          3.8364      4.1732 * #>      2    3   3.0652     0.1129          2.8438      3.2865 * #>      2    4   2.1123     0.1466          1.8249      2.3997 * #>      3    2  -0.0276     0.0491         -0.1237      0.0685   #>      3    3   3.9993     0.1033          3.7968      4.2018 * #>      3    4   2.9554     0.1315          2.6976      3.2132 * #>      4    2  -0.0420     0.0516         -0.1433      0.0592   #>      4    3   0.0016     0.0491         -0.0946      0.0977   #>      4    4   4.0304     0.1369          3.7620      4.2988 * #> --- #> Signif. codes: `*' confidence band does not cover 0 #>  #> P-value for pre-test of parallel trends assumption:  0.79239 #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust  # plot them ggdid(did_att_gt) # aggregate them into event study plot did_es <- aggte(did_att_gt, type = \"dynamic\")  # plot the event study ggdid(did_es)"},{"path":"https://bcallaway11.github.io/did/articles/pre-testing.html","id":"pitfall-selective-treatment-timing","dir":"Articles","previous_headings":"Common Approaches to Pre-Testing in Applications > Pitfalls with Event Study Regressions","what":"Pitfall: Selective Treatment Timing","title":"Pre-Testing in a DiD Setup using the did Package","text":"Sun Abraham (2021) point major limitation event study regressions: selective treatment timing μl\\mu_l end weighted averages treatment effects across different lengths exposures. Selective treatment timing means individuals different groups experience systematically different effects participating treatment individuals groups. example, selective treatment timing individuals choose treated earlier periods tend experience larger benefits participating treatment. sort selective treatment timing likely present many applications economics / policy evaluation. Contrary event study regressions, pre-tests based group-time average treatment effects (based group-time average treatment effects aggregated event study plot) still valid even presence selective treatment timing. see action, let’s keep example , add selective treatment timing.  contrast last case, clear things gone wrong . Parallel trends holds time periods groups , event study regression incorrectly rejects parallel trends holds – due selective treatment timing. can compare happens using package:   correct performance (aforementioned caveats multiple hypothesis testing).","code":"# generate dataset with 4 time periods time.periods <- 4  # generate dynamic effects te.e <- time.periods:1  # generate selective treatment timing # (*** this is what is different here ***) te.bet.ind <- time.periods:1 / (time.periods/2)  # generate data set with these parameters # (main thing: it generates a dataset that satisfies # parallel trends in all periods...including pre-treatment) data <- build_sim_dataset() # run through same code as in earlier example...omitted # run event study regression # normalize effect to be 0 in pre-treatment period es <- plm(Y ~ Dtmin3 + Dtmin2 + Dt0 + Dt1 + Dt2,            data = data, model = \"within\", effect = \"twoways\",            index = c(\"id\", \"period\"))  summary(es) #> Twoways effects Within Model #>  #> Call: #> plm(formula = Y ~ Dtmin3 + Dtmin2 + Dt0 + Dt1 + Dt2, data = data,  #>     effect = \"twoways\", model = \"within\", index = c(\"id\", \"period\")) #>  #> Balanced Panel: n = 6988, T = 4, N = 27952 #>  #> Residuals: #>       Min.    1st Qu.     Median    3rd Qu.       Max.  #> -10.158205  -0.751216   0.023376   0.805780  11.190180  #>  #> Coefficients: #>        Estimate Std. Error t-value  Pr(>|t|)     #> Dtmin3 0.938180   0.071538 13.1144 < 2.2e-16 *** #> Dtmin2 0.424155   0.051047  8.3092 < 2.2e-16 *** #> Dt0    3.655215   0.044701 81.7695 < 2.2e-16 *** #> Dt1    3.199891   0.055563 57.5898 < 2.2e-16 *** #> Dt2    2.610583   0.078828 33.1173 < 2.2e-16 *** #> --- #> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 #>  #> Total Sum of Squares:    79441 #> Residual Sum of Squares: 58052 #> R-Squared:      0.26925 #> Adj. R-Squared: 0.025329 #> F-statistic: 1544.28 on 5 and 20956 DF, p-value: < 2.22e-16 # run through same code as before...omitted  # new event study plot ggplot(data = cmat, mapping = aes(y = coefs, x = exposure)) +   geom_line(linetype = \"dashed\") +   geom_point() +    geom_errorbar(aes(ymin = (coefs-1.96*ses), ymax = (coefs+1.96*ses)), width = 0.2) +   ylim(c(-2, 5)) +   theme_bw() # estimate group-group time average treatment effects did.att.gt <- att_gt(yname = \"Y\",                      tname = \"period\",                      idnam = \"id\",                      gname = \"G\",                      data = data                      ) summary(did.att.gt) #>  #> Call: #> att_gt(yname = \"Y\", tname = \"period\", idname = \"id\", gname = \"G\",  #>     data = data) #>  #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015>  #>  #> Group-Time Average Treatment Effects: #>  Group Time ATT(g,t) Std. Error [95% Simult.  Conf. Band]   #>      2    2   5.0030     0.0868        4.7636      5.2423 * #>      2    3   4.0634     0.1104        3.7590      4.3677 * #>      2    4   3.1105     0.1424        2.7180      3.5029 * #>      3    2  -0.0276     0.0497       -0.1646      0.1095   #>      3    3   3.9993     0.1069        3.7047      4.2939 * #>      3    4   2.9554     0.1323        2.5909      3.3200 * #>      4    2  -0.0420     0.0511       -0.1828      0.0987   #>      4    3   0.0016     0.0493       -0.1343      0.1374   #>      4    4   2.0335     0.1396        1.6487      2.4182 * #> --- #> Signif. codes: `*' confidence band does not cover 0 #>  #> P-value for pre-test of parallel trends assumption:  0.79239 #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust  # plot them ggdid(did.att.gt) # aggregate them into event study plot did.es <- aggte(did.att.gt, type = \"dynamic\")  # plot the event study ggdid(did.es)"},{"path":"https://bcallaway11.github.io/did/articles/pre-testing.html","id":"conditional-moment-tests","dir":"Articles","previous_headings":"","what":"Conditional Moment Tests","title":"Pre-Testing in a DiD Setup using the did Package","text":"Another main use case package parallel trends assumptions holds conditioning covariates. likely important many applications. example, evaluate effect participating job training program earnings, likely important condition individual’s education. true () distribution education different individuals participate job training relative don’t (likely hold people participate job training tend less education ), (ii) path earnings (absent participating job training) depends individual’s education. See Heckman, Ichimura, Todd (1998) Abadie (2005) discussion. Even one includes covariates estimate group-time average treatment effects, pre-tests based group-time average treatment effects can fail detect violations parallel trends assumption. give example, suppose covariate binary variable individual’s sex. Pre-tests based group-time average treatment effects fail detect violations conditional parallel trends assumption cases violated one direction men direction women. package contains additional pre-test conditional parallel trends assumption conditional_did_pretest function.","code":"# not run (this code can be substantially slower) reset.sim() set.seed(1814) nt <- 1000 nu <- 1000 cdp <- conditional_did_pretest(\"Y\", \"period\", \"id\", \"G\", xformla = ~X, data = data) cdp"},{"path":"https://bcallaway11.github.io/did/articles/pre-testing.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Pre-Testing in a DiD Setup using the did Package","text":"Abadie, Alberto. “Semiparametric difference--differences estimators.” Review Economic Studies 72.1 (2005): 1-19. Callaway, Brantly, Pedro H. C. Sant’Anna. “Difference--differences multiple time periods.” Journal Econometrics, Vol. 225, . 2, pp. 200-230, 2021. Heckman, James J., Hidehiko Ichimura, Petra Todd. “Matching econometric evaluation estimator.” Review Economic Studies 65.2 (1998): 261-294. Sun, Liyang, Sarah Abraham. “Estimating dynamic treatment effects event studies heterogeneous treatment effects.” Journal Econometrics, Vol. 225, . 2, pp. 175-199, 2021","code":""},{"path":"https://bcallaway11.github.io/did/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Brantly Callaway. Author, maintainer. Pedro H. C. Sant'Anna. Author.","code":""},{"path":"https://bcallaway11.github.io/did/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Callaway B, Sant'Anna P (2021). “Difference--differences multiple time periods.” Journal Econometrics. https://doi.org/10.1016/j.jeconom.2020.12.001. Callaway B, Sant'Anna P (2021). “: Difference Differences.” R package version 2.3.0, https://bcallaway11.github.io//.","code":"@Article{,   title = {Difference-in-differences with multiple time periods},   author = {Brantly Callaway and Pedro H.C. Sant'Anna},   year = {2021},   journal = {Journal of Econometrics},   url = {https://doi.org/10.1016/j.jeconom.2020.12.001}, } @Misc{,   title = {did: Difference in Differences},   author = {Brantly Callaway and Pedro H.C. Sant'Anna},   year = {2021},   note = {R package version 2.3.0},   url = {https://bcallaway11.github.io/did/}, }"},{"path":"https://bcallaway11.github.io/did/index.html","id":"difference-in-differences-","dir":"","previous_headings":"","what":"Treatment Effects with Multiple Periods and Groups","title":"Treatment Effects with Multiple Periods and Groups","text":"package contains tools computing average treatment effect parameters Difference--Differences setup allowing two time periods Variation treatment timing (.e., units can become treated different points time) Treatment effect heterogeneity (.e, effect participating treatment can vary across units exhibit potentially complex dynamics, selection treatment, time effects) parallel trends assumption holds conditioning covariates main parameters group-time average treatment effects. average treatment effect particular group (group defined treatment timing) particular time period. parameters natural generalization average treatment effect treated (ATT) identified textbook case two periods two groups case multiple periods. Group-time average treatment effects also natural building blocks aggregated treatment effect parameters overall treatment effects event-study-type estimands.","code":""},{"path":"https://bcallaway11.github.io/did/index.html","id":"getting-started","dir":"","previous_headings":"","what":"Getting Started","title":"Treatment Effects with Multiple Periods and Groups","text":"recent work multiple time periods. package implements framework put forward Callaway, Brantly Pedro H.C. Sant’Anna. “Difference--Differences Multiple Time Periods.” Journal Econometrics, Vol. 225, . 2, pp. 200-230, 2021. arXiv Higher level discussions issues available approach multiple time periods","code":""},{"path":"https://bcallaway11.github.io/did/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Treatment Effects with Multiple Periods and Groups","text":"can install CRAN : get latest version github :","code":"install.packages(\"did\") # install.packages(\"devtools\") devtools::install_github(\"bcallaway11/did\")"},{"path":"https://bcallaway11.github.io/did/index.html","id":"a-short-example","dir":"","previous_headings":"","what":"A short example","title":"Treatment Effects with Multiple Periods and Groups","text":"following simplified example effect states increasing minimum wages county-level teen employment rates comes Callaway Sant’Anna (2021). detailed examples also available subset data available package can loaded dataset contains 500 observations county-level teen employment rates 2003-2007. states first treated 2004, 2006, 2007 (see paper details). important variables dataset lemp log county-level teen employment. outcome variable first.treat period state first increases minimum wage. can 2004, 2006, 2007. variable defines group application year year time variable countyreal id number county provides individual identifier panel data context estimate group-time average treatment effects, use att_gt function att_gt returns class MP object. lot information, importantly estimates group-time average treatment effects standard errors. see , can call summary function provides estimates group-time average treatment effects groups time periods. Group-time average treatment effects identified t >= g (post-treatment time periods group), summary reports even periods t < g – can used pre-test parallel trends assumption. P-value pre-test parallel trends assumption Wald pre-test parallel trends assumption. parallel trends assumption rejected conventional significance levels. often also convenient plot group-time average treatment effects. can done using ggdid command:  red dots plot pre-treatment group-time average treatment effects . provided 95% simultaneous confidence intervals. estimates can interpreted pre-test parallel trends assumption. blue dots post-treatment group-time average treatment effects. parallel trends assumption, can interpreted policy effects – effect minimum wage county-level teen employment due increasing minimum wage. Event Studies Although current example pretty easy directly interpret group-time average treatment effects, many cases convenient aggregate group-time average treatment effects small number parameters. main type aggregation event study plot. make event study plot package, one can use aggte function Just like group-time average treatment effects, can summarized plotted. First, summary column event time group relative first participate treatment. give examples, event time=0 corresponds impact effect, event time=-1 effect period unit becomes treated (checking equal 0 potentially useful pre-test). plot event study, use ggdid  figure similar group-time average treatment effects. Red dots pre-treatment periods, blue dots post-treatment periods. difference x-axis event time. Overall Effect Participating Treatment event study reported overall effect participating treatment. computed averaging average effects computed length exposure. many cases, general purpose overall treatment effect parameter give computing average treatment effect group, averaging across groups. sort procedure provides average treatment effect parameter similar interpretation Average Treatment Effect Treated (ATT) two period two group case. compute overall average treatment effect parameter, use particular interest Overall ATT results. , estimate increasing minimum wage decreased teen employment 3.1% effect marginally statistically significant.","code":"library(did) data(mpdta) out <- att_gt(   yname = \"lemp\",   gname = \"first.treat\",   idname = \"countyreal\",   tname = \"year\",   xformla = ~1,   data = mpdta,   est_method = \"reg\" ) summary(out) #>  #> Call: #> att_gt(yname = \"lemp\", tname = \"year\", idname = \"countyreal\",  #>     gname = \"first.treat\", xformla = ~1, data = mpdta, est_method = \"reg\") #>  #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015>  #>  #> Group-Time Average Treatment Effects: #>  Group Time ATT(g,t) Std. Error [95% Simult.  Conf. Band]   #>   2004 2004  -0.0105     0.0237       -0.0727      0.0517   #>   2004 2005  -0.0704     0.0311       -0.1518      0.0110   #>   2004 2006  -0.1373     0.0393       -0.2401     -0.0344 * #>   2004 2007  -0.1008     0.0355       -0.1938     -0.0078 * #>   2006 2004   0.0065     0.0230       -0.0537      0.0668   #>   2006 2005  -0.0028     0.0203       -0.0558      0.0503   #>   2006 2006  -0.0046     0.0181       -0.0521      0.0429   #>   2006 2007  -0.0412     0.0214       -0.0973      0.0148   #>   2007 2004   0.0305     0.0164       -0.0124      0.0734   #>   2007 2005  -0.0027     0.0170       -0.0474      0.0419   #>   2007 2006  -0.0311     0.0188       -0.0804      0.0183   #>   2007 2007  -0.0261     0.0168       -0.0701      0.0180   #> --- #> Signif. codes: `*' confidence band does not cover 0 #>  #> P-value for pre-test of parallel trends assumption:  0.16812 #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Outcome Regression ggdid(out, ylim = c(-.25, .1)) es <- aggte(out, type = \"dynamic\") summary(es) #>  #> Call: #> aggte(MP = out, type = \"dynamic\") #>  #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015>  #>  #>  #> Overall summary of ATT's based on event-study/dynamic aggregation:   #>      ATT    Std. Error     [ 95%  Conf. Int.]   #>  -0.0772        0.0209    -0.1182     -0.0363 * #>  #>  #> Dynamic Effects: #>  Event time Estimate Std. Error [95% Simult.  Conf. Band]   #>          -3   0.0305     0.0158       -0.0111      0.0721   #>          -2  -0.0006     0.0128       -0.0342      0.0331   #>          -1  -0.0245     0.0145       -0.0627      0.0137   #>           0  -0.0199     0.0110       -0.0489      0.0090   #>           1  -0.0510     0.0177       -0.0974     -0.0046 * #>           2  -0.1373     0.0382       -0.2375     -0.0370 * #>           3  -0.1008     0.0357       -0.1947     -0.0069 * #> --- #> Signif. codes: `*' confidence band does not cover 0 #>  #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Outcome Regression ggdid(es) group_effects <- aggte(out, type = \"group\") summary(group_effects) #>  #> Call: #> aggte(MP = out, type = \"group\") #>  #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015>  #>  #>  #> Overall summary of ATT's based on group/cohort aggregation:   #>     ATT    Std. Error     [ 95%  Conf. Int.]   #>  -0.031        0.0129    -0.0563     -0.0057 * #>  #>  #> Group Effects: #>  Group Estimate Std. Error [95% Simult.  Conf. Band]   #>   2004  -0.0797     0.0279       -0.1460     -0.0135 * #>   2006  -0.0229     0.0165       -0.0621      0.0163   #>   2007  -0.0261     0.0174       -0.0674      0.0153   #> --- #> Signif. codes: `*' confidence band does not cover 0 #>  #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Outcome Regression"},{"path":"https://bcallaway11.github.io/did/index.html","id":"additional-resources","dir":"","previous_headings":"","what":"Additional Resources","title":"Treatment Effects with Multiple Periods and Groups","text":"provided several vignettes may helpful using package Getting Started Package Introduction Multiple Time Periods Pre-Testing Setup using Package Writing Extensions Package","code":""},{"path":"https://bcallaway11.github.io/did/reference/AGGTEobj.html","id":null,"dir":"Reference","previous_headings":"","what":"AGGTEobj — AGGTEobj","title":"AGGTEobj — AGGTEobj","text":"Objects class hold results aggregated group-time average treatment effects object holding aggregated treatment effect parameters.","code":""},{"path":"https://bcallaway11.github.io/did/reference/AGGTEobj.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"AGGTEobj — AGGTEobj","text":"","code":"AGGTEobj(   overall.att = NULL,   overall.se = NULL,   type = \"simple\",   egt = NULL,   att.egt = NULL,   se.egt = NULL,   crit.val.egt = NULL,   inf.function = NULL,   min_e = NULL,   max_e = NULL,   balance_e = NULL,   call = NULL,   DIDparams = NULL )"},{"path":"https://bcallaway11.github.io/did/reference/AGGTEobj.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"AGGTEobj — AGGTEobj","text":"overall.att estimated overall ATT overall.se Standard error overall ATT type type aggregated treatment effect parameter compute. One option \"simple\" (just computes weighted average group-time average treatment effects weights proportional group size).  options \"dynamic\" (computes average effects across different lengths exposure treatment similar \"event study\"; overall effect averages effect treatment across positive lengths exposure); \"group\" (default option computes average treatment effects across different groups; overall effect averages effect across different groups); \"calendar\" (computes average treatment effects across different time periods; overall effect averages effect across time period). egt Holds length exposure (dynamic effects), group (selective treatment timing), time period (calendar time effects) att.egt ATT specific egt se.egt standard error specific egt crit.val.egt critical value computing uniform confidence bands dynamic effects, selective treatment timing, time period effects. inf.function influence function chosen aggregated parameters min_e event studies, smallest event time compute dynamic effects .  default, min_e = -Inf effects lengths exposure computed. max_e event studies, largest event time compute dynamic effects .  default, max_e = Inf effects lengths exposure computed. balance_e set (one computes dynamic effects), balances sample respect event time.  example, balance.e=2, aggte drop groups exposed treatment least three periods. (initial period e=0 well next two periods e=1 e=2).  ensures composition groups change event time changes. call function call aggte DIDparams DIDparams object","code":""},{"path":"https://bcallaway11.github.io/did/reference/AGGTEobj.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"AGGTEobj — AGGTEobj","text":"AGGTEobj","code":""},{"path":"https://bcallaway11.github.io/did/reference/DIDparams.html","id":null,"dir":"Reference","previous_headings":"","what":"DIDparams — DIDparams","title":"DIDparams — DIDparams","text":"Object hold parameters passed across functions","code":""},{"path":"https://bcallaway11.github.io/did/reference/DIDparams.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"DIDparams — DIDparams","text":"","code":"DIDparams(   yname,   tname,   idname = NULL,   gname,   xformla = NULL,   data,   control_group,   anticipation = 0,   weightsname = NULL,   alp = 0.05,   bstrap = TRUE,   biters = 1000,   clustervars = NULL,   cband = TRUE,   print_details = TRUE,   faster_mode = FALSE,   pl = FALSE,   cores = 1,   est_method = \"dr\",   base_period = \"varying\",   panel = TRUE,   true_repeated_cross_sections,   n = NULL,   nG = NULL,   nT = NULL,   tlist = NULL,   glist = NULL,   call = NULL )"},{"path":"https://bcallaway11.github.io/did/reference/DIDparams.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"DIDparams — DIDparams","text":"yname name outcome variable tname name column containing time periods idname individual (cross-sectional unit) id name gname name variable data contains first period particular observation treated. positive number observations treated groups. defines \"group\" unit belongs .  0 units untreated group. xformla formula covariates include model.  form ~ X1 + X2.  Default NULL equivalent xformla=~1.  used create matrix covariates passed 2x2 estimator chosen est_method. time-varying covariates: (1) balanced panel data, 2x2 comparison, covariates taken value covariates earlier time period, underlying computation involve change Y function values covariates.  (2) repeated cross sections data unbalanced panel data, covariates taken time period computations involve Y_post conditional X_post minus Y_pre conditional X_pre.  byproduct , balanced panel data presence time-varying covariates, possible get different numerical results according whether allow_unbalanced_panel=TRUE FALSE. data name data.frame contains data control_group units use control group. default \"nevertreated\" sets control group group units never participate treatment.  group change across groups time periods.  option set group=\"notyettreated\".  case, control group set group units yet participated treatment time period.  includes never treated units, includes additional units eventually participate treatment, participated yet. anticipation number time periods participating treatment units can anticipate participating treatment therefore can affect untreated potential outcomes weightsname name column containing sampling weights. set, observations weight. alp significance level, default 0.05 bstrap Boolean whether compute standard errors using multiplier bootstrap.  standard errors clustered, one must set bstrap=TRUE. Default TRUE (addition, cband also default TRUE indicating uniform confidence bands returned.  bstrap FALSE, analytical standard errors reported. biters number bootstrap iterations use.  default 1000, applicable bstrap=TRUE. clustervars vector variables names cluster .  , can two variables (otherwise throw error) one must idname allows clustering individual level. default, cluster individual level (bstrap=TRUE). cband Boolean whether compute uniform confidence band covers group-time average treatment effects fixed probability 1-alp.  order compute uniform confidence bands, bstrap must also set TRUE.  default TRUE. print_details Whether show details/progress computations. Default FALSE. faster_mode option enables faster version , optimizing computation time large datasets improving data management within package. default set FALSE. difference minimal small datasets, recommended use large datasets. pl Whether use parallel processing cores number cores use parallel processing est_method method compute group-time average treatment effects.  default \"dr\" uses doubly robust approach DRDID package.  built-methods include \"ipw\" inverse probability weighting \"reg\" first step regression estimators.  user can also pass function estimating group time average treatment effects.  function f(Y1,Y0,treat,covariates) Y1 n x 1 vector outcomes post-treatment outcomes, Y0 n x 1 vector pre-treatment outcomes, treat vector indicating whether individual participates treatment, covariates n x k matrix covariates.  function return list includes ATT (estimated average treatment effect), inf.func (n x 1 influence function). function can return things well, two required. est_method used covariates included. base_period Whether use \"varying\" base period \"universal\" base period.  Either choice results post-treatment estimates ATT(g,t)'s.  pre-treatment periods, using varying base period amounts computing pseudo-ATT treatment period comparing change outcomes particular group relative comparison group pre-treatment periods (.e., pre-treatment periods setting computes changes period t-1 period t, repeatedly changes value t) universal base period fixes base period always (g-anticipation-1).  compute pseudo-ATT(g,t)'s pre-treatment periods, rather reports average changes outcomes period t (g-anticipation-1) particular group relative comparison group.  analogous often reported event study regressions. Using varying base period results estimate ATT(g,t) reported period immediately treatment.  Using universal base period normalizes estimate period right treatment (earlier user allows anticipation) equal 0, one extra estimate earlier period. panel Whether data panel dataset. panel dataset provided long format – , row corresponds unit observed particular point time.  default TRUE.  using panel dataset, variable idname must set.  panel=FALSE, data treated repeated cross sections. true_repeated_cross_sections Whether data really repeated cross sections.  (include unbalanced panel code runs repeated cross sections code) n number observations.  equal number units (may different number rows panel dataset). nG number groups nT number time periods tlist vector containing time period glist vector containing group call Function call att_gt","code":""},{"path":"https://bcallaway11.github.io/did/reference/MP.TEST.html","id":null,"dir":"Reference","previous_headings":"","what":"MP.TEST — MP.TEST","title":"MP.TEST — MP.TEST","text":"object holds results computing pre-test conditional parallel trends assumption","code":""},{"path":"https://bcallaway11.github.io/did/reference/MP.TEST.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"MP.TEST — MP.TEST","text":"","code":"MP.TEST(   CvM = NULL,   CvMb = NULL,   CvMcval = NULL,   CvMpval = NULL,   KS = NULL,   KSb = NULL,   KScval = NULL,   KSpval = NULL,   clustervars = NULL,   xformla = NULL )"},{"path":"https://bcallaway11.github.io/did/reference/MP.TEST.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"MP.TEST — MP.TEST","text":"CvM Cramer von Mises test statistic CvMb vector bootstrapped Cramer von Mises test statistics CvMcval CvM critical value CvMpval p-value CvM test KS Kolmogorov-Smirnov test statistic KSb vector bootstrapped KS test statistics KScval KS critical value KSpval p-value KS test clustervars vector variables clustered test xformla formla X variables used test","code":""},{"path":"https://bcallaway11.github.io/did/reference/MP.html","id":null,"dir":"Reference","previous_headings":"","what":"MP — MP","title":"MP — MP","text":"Multi-period objects hold results group-time average treatment effects","code":""},{"path":"https://bcallaway11.github.io/did/reference/MP.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"MP — MP","text":"","code":"MP(   group,   t,   att,   V_analytical,   se,   c,   inffunc,   n = NULL,   W = NULL,   Wpval = NULL,   aggte = NULL,   alp = 0.05,   DIDparams = NULL )"},{"path":"https://bcallaway11.github.io/did/reference/MP.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"MP — MP","text":"group group (defined period first treated) group-time average treatment effect t time period group-time average treatment effect att group-average treatment effect group group time period t V_analytical Analytical estimator asymptotic variance-covariance matrix group-time average treatment effects se standard errors group-time average treatment effects. bootstrap set TRUE, provides bootstrap-based se. c simultaneous critical value one obtaining simultaneous confidence bands. Otherwise reports critical value based pointwise normal approximation. inffunc influence function estimating group-time average treatment effects n number unique cross-sectional units (unique values idname) W Wald statistic pre-testing common trends assumption Wpval p-value Wald statistic pre-testing common trends assumption aggte aggregate treatment effects object alp significance level, default 0.05 DIDparams DIDparams object.  way optionally return parameters call att_gt() conditional_did_pretest().","code":""},{"path":"https://bcallaway11.github.io/did/reference/MP.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"MP — MP","text":"MP object","code":""},{"path":"https://bcallaway11.github.io/did/reference/aggte.html","id":null,"dir":"Reference","previous_headings":"","what":"Aggregate Group-Time Average Treatment Effects — aggte","title":"Aggregate Group-Time Average Treatment Effects — aggte","text":"function take group-time average treatment effects aggregate smaller number parameters.  several possible aggregations including \"simple\", \"dynamic\", \"group\", \"calendar.\"","code":""},{"path":"https://bcallaway11.github.io/did/reference/aggte.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Aggregate Group-Time Average Treatment Effects — aggte","text":"","code":"aggte(   MP,   type = \"group\",   balance_e = NULL,   min_e = -Inf,   max_e = Inf,   na.rm = FALSE,   bstrap = NULL,   biters = NULL,   cband = NULL,   alp = NULL,   clustervars = NULL )"},{"path":"https://bcallaway11.github.io/did/reference/aggte.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Aggregate Group-Time Average Treatment Effects — aggte","text":"MP MP object (.e., results att_gt() method) type type aggregated treatment effect parameter compute. One option \"simple\" (just computes weighted average group-time average treatment effects weights proportional group size).  options \"dynamic\" (computes average effects across different lengths exposure treatment similar \"event study\"; overall effect averages effect treatment across positive lengths exposure); \"group\" (default option computes average treatment effects across different groups; overall effect averages effect across different groups); \"calendar\" (computes average treatment effects across different time periods; overall effect averages effect across time period). balance_e set (one computes dynamic effects), balances sample respect event time.  example, balance.e=2, aggte drop groups exposed treatment least three periods. (initial period e=0 well next two periods e=1 e=2).  ensures composition groups change event time changes. min_e event studies, smallest event time compute dynamic effects .  default, min_e = -Inf effects lengths exposure computed. max_e event studies, largest event time compute dynamic effects .  default, max_e = Inf effects lengths exposure computed. na.rm Logical value remove missing Values analyses. Defaults FALSE. bstrap Boolean whether compute standard errors using multiplier bootstrap.  standard errors clustered, one must set bstrap=TRUE. Default value set MP object.  bstrap FALSE, analytical standard errors reported. biters number bootstrap iterations use.  default value set MP object, applicable bstrap=TRUE. cband Boolean whether compute uniform confidence band covers group-time average treatment effects fixed probability 1-alp.  order compute uniform confidence bands, bstrap must also set TRUE.  default value set MP object alp significance level, default value set MP object. clustervars vector variables cluster .  , can two variables (otherwise throw error) one must idname allows clustering individual level. Default variables set MP object","code":""},{"path":"https://bcallaway11.github.io/did/reference/aggte.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Aggregate Group-Time Average Treatment Effects — aggte","text":"AGGTEobj object holds results aggregation","code":""},{"path":"https://bcallaway11.github.io/did/reference/aggte.html","id":"examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Aggregate Group-Time Average Treatment Effects — aggte","text":"Initial ATT(g,t) estimates att_gt()   can aggregate ATT(g,t) many ways. Overall ATT:   Dynamic ATT (Event-Study):   ATT group:   ATT calendar year:","code":"data(mpdta) set.seed(09152024) out <- att_gt(yname=\"lemp\",                tname=\"year\",                idname=\"countyreal\",                gname=\"first.treat\",                xformla=NULL,                data=mpdta) aggte(out, type = \"simple\") #> #> Call: #> aggte(MP = out, type = \"simple\") #> #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015> #> #> #>    ATT    Std. Error     [ 95%  Conf. Int.] #>  -0.04        0.0119    -0.0633     -0.0166 * #> #> #> --- #> Signif. codes: `*' confidence band does not cover 0 #> #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust aggte(out, type = \"dynamic\") #> #> Call: #> aggte(MP = out, type = \"dynamic\") #> #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015> #> #> #> Overall summary of ATT's based on event-study/dynamic aggregation: #>      ATT    Std. Error     [ 95%  Conf. Int.] #>  -0.0772        0.0208     -0.118     -0.0365 * #> #> #> Dynamic Effects: #>  Event time Estimate Std. Error [95% Simult.  Conf. Band] #>          -3   0.0305     0.0154       -0.0101      0.0711 #>          -2  -0.0006     0.0129       -0.0346      0.0334 #>          -1  -0.0245     0.0145       -0.0628      0.0139 #>           0  -0.0199     0.0119       -0.0513      0.0114 #>           1  -0.0510     0.0160       -0.0934     -0.0085 * #>           2  -0.1373     0.0393       -0.2412     -0.0333 * #>           3  -0.1008     0.0356       -0.1949     -0.0067 * #> --- #> Signif. codes: `*' confidence band does not cover 0 #> #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust aggte(out, type = \"group\") #> #> Call: #> aggte(MP = out, type = \"group\") #> #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015> #> #> #> Overall summary of ATT's based on group/cohort aggregation: #>     ATT    Std. Error     [ 95%  Conf. Int.] #>  -0.031        0.0126    -0.0558     -0.0063 * #> #> #> Group Effects: #>  Group Estimate Std. Error [95% Simult.  Conf. Band] #>   2004  -0.0797     0.0300       -0.1445     -0.0150 * #>   2006  -0.0229     0.0163       -0.0582      0.0123 #>   2007  -0.0261     0.0167       -0.0622      0.0101 #> --- #> Signif. codes: `*' confidence band does not cover 0 #> #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust aggte(out, type = \"calendar\") #> #> Call: #> aggte(MP = out, type = \"calendar\") #> #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015> #> #> #> Overall summary of ATT's based on calendar time aggregation: #>      ATT    Std. Error     [ 95%  Conf. Int.] #>  -0.0417        0.0175    -0.0759     -0.0075 * #> #> #> Time Effects: #>  Time Estimate Std. Error [95% Simult.  Conf. Band] #>  2004  -0.0105     0.0242       -0.0685      0.0475 #>  2005  -0.0704     0.0319       -0.1467      0.0059 #>  2006  -0.0488     0.0206       -0.0980      0.0004 #>  2007  -0.0371     0.0133       -0.0689     -0.0052 * #> --- #> Signif. codes: `*' confidence band does not cover 0 #> #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust"},{"path":"https://bcallaway11.github.io/did/reference/att_gt.html","id":null,"dir":"Reference","previous_headings":"","what":"Group-Time Average Treatment Effects — att_gt","title":"Group-Time Average Treatment Effects — att_gt","text":"att_gt computes average treatment effects setups two periods data allowing treatment occur different points time allowing treatment effect heterogeneity dynamics. See Callaway Sant'Anna (2021) detailed description.","code":""},{"path":"https://bcallaway11.github.io/did/reference/att_gt.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Group-Time Average Treatment Effects — att_gt","text":"","code":"att_gt(   yname,   tname,   idname = NULL,   gname,   xformla = NULL,   data,   panel = TRUE,   allow_unbalanced_panel = FALSE,   control_group = c(\"nevertreated\", \"notyettreated\"),   anticipation = 0,   weightsname = NULL,   alp = 0.05,   bstrap = TRUE,   cband = TRUE,   biters = 1000,   clustervars = NULL,   est_method = \"dr\",   base_period = \"varying\",   faster_mode = TRUE,   print_details = FALSE,   pl = FALSE,   cores = 1 )"},{"path":"https://bcallaway11.github.io/did/reference/att_gt.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Group-Time Average Treatment Effects — att_gt","text":"yname name outcome variable tname name column containing time periods idname individual (cross-sectional unit) id name gname name variable data contains first period particular observation treated. positive number observations treated groups. defines \"group\" unit belongs .  0 units untreated group. xformla formula covariates include model.  form ~ X1 + X2.  Default NULL equivalent xformla=~1.  used create matrix covariates passed 2x2 estimator chosen est_method. time-varying covariates: (1) balanced panel data, 2x2 comparison, covariates taken value covariates earlier time period, underlying computation involve change Y function values covariates.  (2) repeated cross sections data unbalanced panel data, covariates taken time period computations involve Y_post conditional X_post minus Y_pre conditional X_pre.  byproduct , balanced panel data presence time-varying covariates, possible get different numerical results according whether allow_unbalanced_panel=TRUE FALSE. data name data.frame contains data panel Whether data panel dataset. panel dataset provided long format – , row corresponds unit observed particular point time.  default TRUE.  using panel dataset, variable idname must set.  panel=FALSE, data treated repeated cross sections. allow_unbalanced_panel Whether function \"balance\" panel respect time id.  default values FALSE means att_gt() drop units data observed periods. advantage computations faster (sometimes substantially). control_group units use control group. default \"nevertreated\" sets control group group units never participate treatment.  group change across groups time periods.  option set group=\"notyettreated\".  case, control group set group units yet participated treatment time period.  includes never treated units, includes additional units eventually participate treatment, participated yet. anticipation number time periods participating treatment units can anticipate participating treatment therefore can affect untreated potential outcomes weightsname name column containing sampling weights. set, observations weight. alp significance level, default 0.05 bstrap Boolean whether compute standard errors using multiplier bootstrap.  standard errors clustered, one must set bstrap=TRUE. Default TRUE (addition, cband also default TRUE indicating uniform confidence bands returned.  bstrap FALSE, analytical standard errors reported. cband Boolean whether compute uniform confidence band covers group-time average treatment effects fixed probability 1-alp.  order compute uniform confidence bands, bstrap must also set TRUE.  default TRUE. biters number bootstrap iterations use.  default 1000, applicable bstrap=TRUE. clustervars vector variables names cluster .  , can two variables (otherwise throw error) one must idname allows clustering individual level. default, cluster individual level (bstrap=TRUE). est_method method compute group-time average treatment effects.  default \"dr\" uses doubly robust approach DRDID package.  built-methods include \"ipw\" inverse probability weighting \"reg\" first step regression estimators.  user can also pass function estimating group time average treatment effects.  function f(Y1,Y0,treat,covariates) Y1 n x 1 vector outcomes post-treatment outcomes, Y0 n x 1 vector pre-treatment outcomes, treat vector indicating whether individual participates treatment, covariates n x k matrix covariates.  function return list includes ATT (estimated average treatment effect), inf.func (n x 1 influence function). function can return things well, two required. est_method used covariates included. base_period Whether use \"varying\" base period \"universal\" base period.  Either choice results post-treatment estimates ATT(g,t)'s.  pre-treatment periods, using varying base period amounts computing pseudo-ATT treatment period comparing change outcomes particular group relative comparison group pre-treatment periods (.e., pre-treatment periods setting computes changes period t-1 period t, repeatedly changes value t) universal base period fixes base period always (g-anticipation-1).  compute pseudo-ATT(g,t)'s pre-treatment periods, rather reports average changes outcomes period t (g-anticipation-1) particular group relative comparison group.  analogous often reported event study regressions. Using varying base period results estimate ATT(g,t) reported period immediately treatment.  Using universal base period normalizes estimate period right treatment (earlier user allows anticipation) equal 0, one extra estimate earlier period. faster_mode option enables faster version , optimizing computation time large datasets improving data management within package. default set FALSE. difference minimal small datasets, recommended use large datasets. print_details Whether show details/progress computations. Default FALSE. pl Whether use parallel processing cores number cores use parallel processing","code":""},{"path":"https://bcallaway11.github.io/did/reference/att_gt.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Group-Time Average Treatment Effects — att_gt","text":"MP object containing results group-time average treatment effects","code":""},{"path":"https://bcallaway11.github.io/did/reference/att_gt.html","id":"examples-","dir":"Reference","previous_headings":"","what":"Examples:","title":"Group-Time Average Treatment Effects — att_gt","text":"Basic att_gt() call:   Using covariates:   Specify comparison units:","code":"# Example data data(mpdta) set.seed(09152024) out1 <- att_gt(yname=\"lemp\",                tname=\"year\",                idname=\"countyreal\",                gname=\"first.treat\",                xformla=NULL,                data=mpdta) summary(out1) #> #> Call: #> att_gt(yname = \"lemp\", tname = \"year\", idname = \"countyreal\", #>     gname = \"first.treat\", xformla = NULL, data = mpdta) #> #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015> #> #> Group-Time Average Treatment Effects: #>  Group Time ATT(g,t) Std. Error [95% Simult.  Conf. Band] #>   2004 2004  -0.0105     0.0258       -0.0809      0.0599 #>   2004 2005  -0.0704     0.0341       -0.1635      0.0227 #>   2004 2006  -0.1373     0.0384       -0.2423     -0.0322 * #>   2004 2007  -0.1008     0.0354       -0.1976     -0.0040 * #>   2006 2004   0.0065     0.0235       -0.0578      0.0708 #>   2006 2005  -0.0028     0.0192       -0.0554      0.0499 #>   2006 2006  -0.0046     0.0184       -0.0548      0.0456 #>   2006 2007  -0.0412     0.0207       -0.0977      0.0153 #>   2007 2004   0.0305     0.0161       -0.0135      0.0746 #>   2007 2005  -0.0027     0.0157       -0.0456      0.0401 #>   2007 2006  -0.0311     0.0184       -0.0815      0.0193 #>   2007 2007  -0.0261     0.0176       -0.0741      0.0220 #> --- #> Signif. codes: `*' confidence band does not cover 0 #> #> P-value for pre-test of parallel trends assumption:  0.16812 #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust out2 <- att_gt(yname=\"lemp\",                tname=\"year\",                idname=\"countyreal\",                gname=\"first.treat\",                xformla=~lpop,                data=mpdta) summary(out2) #> #> Call: #> att_gt(yname = \"lemp\", tname = \"year\", idname = \"countyreal\", #>     gname = \"first.treat\", xformla = ~lpop, data = mpdta) #> #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015> #> #> Group-Time Average Treatment Effects: #>  Group Time ATT(g,t) Std. Error [95% Simult.  Conf. Band] #>   2004 2004  -0.0145     0.0222       -0.0737      0.0446 #>   2004 2005  -0.0764     0.0303       -0.1570      0.0041 #>   2004 2006  -0.1404     0.0382       -0.2421     -0.0388 * #>   2004 2007  -0.1069     0.0358       -0.2021     -0.0117 * #>   2006 2004  -0.0005     0.0231       -0.0618      0.0609 #>   2006 2005  -0.0062     0.0188       -0.0561      0.0437 #>   2006 2006   0.0010     0.0204       -0.0534      0.0553 #>   2006 2007  -0.0413     0.0210       -0.0971      0.0145 #>   2007 2004   0.0267     0.0140       -0.0104      0.0639 #>   2007 2005  -0.0046     0.0170       -0.0498      0.0407 #>   2007 2006  -0.0284     0.0187       -0.0782      0.0213 #>   2007 2007  -0.0288     0.0161       -0.0715      0.0140 #> --- #> Signif. codes: `*' confidence band does not cover 0 #> #> P-value for pre-test of parallel trends assumption:  0.23267 #> Control Group:  Never Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust out3 <- att_gt(yname=\"lemp\",                tname=\"year\",                idname=\"countyreal\",                gname=\"first.treat\",                xformla=~lpop,                control_group = \"notyettreated\",                data=mpdta) summary(out3) #> #> Call: #> att_gt(yname = \"lemp\", tname = \"year\", idname = \"countyreal\", #>     gname = \"first.treat\", xformla = ~lpop, data = mpdta, control_group = \"notyettreated\") #> #> Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. <https://doi.org/10.1016/j.jeconom.2020.12.001>, <https://arxiv.org/abs/1803.09015> #> #> Group-Time Average Treatment Effects: #>  Group Time ATT(g,t) Std. Error [95% Simult.  Conf. Band] #>   2004 2004  -0.0212     0.0217       -0.0788      0.0365 #>   2004 2005  -0.0816     0.0324       -0.1676      0.0044 #>   2004 2006  -0.1382     0.0368       -0.2361     -0.0403 * #>   2004 2007  -0.1069     0.0344       -0.1984     -0.0154 * #>   2006 2004  -0.0075     0.0233       -0.0693      0.0544 #>   2006 2005  -0.0046     0.0184       -0.0533      0.0442 #>   2006 2006   0.0087     0.0182       -0.0397      0.0570 #>   2006 2007  -0.0413     0.0205       -0.0956      0.0130 #>   2007 2004   0.0269     0.0136       -0.0091      0.0630 #>   2007 2005  -0.0042     0.0153       -0.0448      0.0364 #>   2007 2006  -0.0284     0.0191       -0.0792      0.0223 #>   2007 2007  -0.0288     0.0167       -0.0732      0.0157 #> --- #> Signif. codes: `*' confidence band does not cover 0 #> #> P-value for pre-test of parallel trends assumption:  0.23326 #> Control Group:  Not Yet Treated,  Anticipation Periods:  0 #> Estimation Method:  Doubly Robust"},{"path":"https://bcallaway11.github.io/did/reference/att_gt.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Group-Time Average Treatment Effects — att_gt","text":"Callaway, Brantly Pedro H.C. Sant'Anna.  \\\"Difference--Differences Multiple Time Periods.\\\" Journal Econometrics, Vol. 225, . 2, pp. 200-230, 2021. doi:10.1016/j.jeconom.2020.12.001 , https://arxiv.org/abs/1803.09015","code":""},{"path":"https://bcallaway11.github.io/did/reference/build_sim_dataset.html","id":null,"dir":"Reference","previous_headings":"","what":"build_sim_dataset — build_sim_dataset","title":"build_sim_dataset — build_sim_dataset","text":"function building simulated data","code":""},{"path":"https://bcallaway11.github.io/did/reference/build_sim_dataset.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"build_sim_dataset — build_sim_dataset","text":"","code":"build_sim_dataset(sp_list, panel = TRUE)"},{"path":"https://bcallaway11.github.io/did/reference/build_sim_dataset.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"build_sim_dataset — build_sim_dataset","text":"sp_list list simulation parameters.  See reset.sim generate default values parameters panel whether construct panel data (default) repeated cross sections data","code":""},{"path":"https://bcallaway11.github.io/did/reference/build_sim_dataset.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"build_sim_dataset — build_sim_dataset","text":"data.frame following columns G observations group X value covariate id observation's id cluster observation's cluster (construction within-cluster correlation) period time period current observation Y outcome treat whether unit ever treated","code":""},{"path":"https://bcallaway11.github.io/did/reference/citation.html","id":null,"dir":"Reference","previous_headings":"","what":"citation — citation","title":"citation — citation","text":"print citation relevant paper","code":""},{"path":"https://bcallaway11.github.io/did/reference/citation.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"citation — citation","text":"","code":"citation()"},{"path":"https://bcallaway11.github.io/did/reference/compute.aggte.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute Aggregated Treatment Effect Parameters — compute.aggte","title":"Compute Aggregated Treatment Effect Parameters — compute.aggte","text":"heavy lifting computing aggregated group-time average treatment effects","code":""},{"path":"https://bcallaway11.github.io/did/reference/compute.aggte.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute Aggregated Treatment Effect Parameters — compute.aggte","text":"","code":"compute.aggte(   MP,   type = \"group\",   balance_e = NULL,   min_e = -Inf,   max_e = Inf,   na.rm = FALSE,   bstrap = NULL,   biters = NULL,   cband = NULL,   alp = NULL,   clustervars = NULL,   call = NULL )"},{"path":"https://bcallaway11.github.io/did/reference/compute.aggte.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute Aggregated Treatment Effect Parameters — compute.aggte","text":"MP MP object (.e., results att_gt() method) type type aggregated treatment effect parameter compute. One option \"simple\" (just computes weighted average group-time average treatment effects weights proportional group size).  options \"dynamic\" (computes average effects across different lengths exposure treatment similar \"event study\"; overall effect averages effect treatment across positive lengths exposure); \"group\" (default option computes average treatment effects across different groups; overall effect averages effect across different groups); \"calendar\" (computes average treatment effects across different time periods; overall effect averages effect across time period). balance_e set (one computes dynamic effects), balances sample respect event time.  example, balance.e=2, aggte drop groups exposed treatment least three periods. (initial period e=0 well next two periods e=1 e=2).  ensures composition groups change event time changes. min_e event studies, smallest event time compute dynamic effects .  default, min_e = -Inf effects lengths exposure computed. max_e event studies, largest event time compute dynamic effects .  default, max_e = Inf effects lengths exposure computed. na.rm Logical value remove missing Values analyses. Defaults FALSE. bstrap Boolean whether compute standard errors using multiplier bootstrap.  standard errors clustered, one must set bstrap=TRUE. Default TRUE (addition, cband also default TRUE indicating uniform confidence bands returned.  bstrap FALSE, analytical standard errors reported. biters number bootstrap iterations use.  default 1000, applicable bstrap=TRUE. cband Boolean whether compute uniform confidence band covers group-time average treatment effects fixed probability 1-alp.  order compute uniform confidence bands, bstrap must also set TRUE.  default TRUE. alp significance level, default 0.05 clustervars vector variables names cluster .  , can two variables (otherwise throw error) one must idname allows clustering individual level. default, cluster individual level (bstrap=TRUE). call function call aggte","code":""},{"path":"https://bcallaway11.github.io/did/reference/compute.aggte.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute Aggregated Treatment Effect Parameters — compute.aggte","text":"AGGTEobj object","code":""},{"path":"https://bcallaway11.github.io/did/reference/compute.att_gt.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute Group-Time Average Treatment Effects — compute.att_gt","title":"Compute Group-Time Average Treatment Effects — compute.att_gt","text":"compute.att_gt main work computing multiperiod group-time average treatment effects","code":""},{"path":"https://bcallaway11.github.io/did/reference/compute.att_gt.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute Group-Time Average Treatment Effects — compute.att_gt","text":"","code":"compute.att_gt(dp)"},{"path":"https://bcallaway11.github.io/did/reference/compute.att_gt.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute Group-Time Average Treatment Effects — compute.att_gt","text":"dp DIDparams object","code":""},{"path":"https://bcallaway11.github.io/did/reference/compute.att_gt.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute Group-Time Average Treatment Effects — compute.att_gt","text":"list length equal number groups times number time periods; element list contains object contains group-time average treatment effect well group time period . also exports influence function used externally compute standard errors.","code":""},{"path":"https://bcallaway11.github.io/did/reference/compute.att_gt2.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute Group-Time Average Treatment Effects — compute.att_gt2","title":"Compute Group-Time Average Treatment Effects — compute.att_gt2","text":"compute.att_gt (g,t) cell send estimation, post process estimation","code":""},{"path":"https://bcallaway11.github.io/did/reference/compute.att_gt2.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute Group-Time Average Treatment Effects — compute.att_gt2","text":"","code":"compute.att_gt2(dp2)"},{"path":"https://bcallaway11.github.io/did/reference/compute.att_gt2.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute Group-Time Average Treatment Effects — compute.att_gt2","text":"dp2 DIDparams object v2.0","code":""},{"path":"https://bcallaway11.github.io/did/reference/compute.att_gt2.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute Group-Time Average Treatment Effects — compute.att_gt2","text":"list length equal number groups times number time periods; element list contains object contains group-time average treatment effect well group time period . also exports influence function used externally compute standard errors.","code":""},{"path":"https://bcallaway11.github.io/did/reference/conditional_did_pretest.html","id":null,"dir":"Reference","previous_headings":"","what":"Pre-Test of Conditional Parallel Trends Assumption — conditional_did_pretest","title":"Pre-Test of Conditional Parallel Trends Assumption — conditional_did_pretest","text":"integrated moments test conditional parallel trends assumption holding pre-treatment time periods groups","code":""},{"path":"https://bcallaway11.github.io/did/reference/conditional_did_pretest.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Pre-Test of Conditional Parallel Trends Assumption — conditional_did_pretest","text":"","code":"conditional_did_pretest(   yname,   tname,   idname = NULL,   gname,   xformla = NULL,   data,   panel = TRUE,   allow_unbalanced_panel = FALSE,   control_group = c(\"nevertreated\", \"notyettreated\"),   weightsname = NULL,   alp = 0.05,   bstrap = TRUE,   cband = TRUE,   biters = 1000,   clustervars = NULL,   est_method = \"ipw\",   print_details = FALSE,   pl = FALSE,   cores = 1 )"},{"path":"https://bcallaway11.github.io/did/reference/conditional_did_pretest.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Pre-Test of Conditional Parallel Trends Assumption — conditional_did_pretest","text":"yname name outcome variable tname name column containing time periods idname individual (cross-sectional unit) id name gname name variable data contains first period particular observation treated. positive number observations treated groups. defines \"group\" unit belongs .  0 units untreated group. xformla formula covariates include model.  form ~ X1 + X2.  Default NULL equivalent xformla=~1.  used create matrix covariates passed 2x2 estimator chosen est_method. time-varying covariates: (1) balanced panel data, 2x2 comparison, covariates taken value covariates earlier time period, underlying computation involve change Y function values covariates.  (2) repeated cross sections data unbalanced panel data, covariates taken time period computations involve Y_post conditional X_post minus Y_pre conditional X_pre.  byproduct , balanced panel data presence time-varying covariates, possible get different numerical results according whether allow_unbalanced_panel=TRUE FALSE. data name data.frame contains data panel Whether data panel dataset. panel dataset provided long format – , row corresponds unit observed particular point time.  default TRUE.  using panel dataset, variable idname must set.  panel=FALSE, data treated repeated cross sections. allow_unbalanced_panel Whether function \"balance\" panel respect time id.  default values FALSE means att_gt() drop units data observed periods. advantage computations faster (sometimes substantially). control_group units use control group. default \"nevertreated\" sets control group group units never participate treatment.  group change across groups time periods.  option set group=\"notyettreated\".  case, control group set group units yet participated treatment time period.  includes never treated units, includes additional units eventually participate treatment, participated yet. weightsname name column containing sampling weights. set, observations weight. alp significance level, default 0.05 bstrap Boolean whether compute standard errors using multiplier bootstrap.  standard errors clustered, one must set bstrap=TRUE. Default TRUE (addition, cband also default TRUE indicating uniform confidence bands returned.  bstrap FALSE, analytical standard errors reported. cband Boolean whether compute uniform confidence band covers group-time average treatment effects fixed probability 1-alp.  order compute uniform confidence bands, bstrap must also set TRUE.  default TRUE. biters number bootstrap iterations use.  default 1000, applicable bstrap=TRUE. clustervars vector variables names cluster .  , can two variables (otherwise throw error) one must idname allows clustering individual level. default, cluster individual level (bstrap=TRUE). est_method method compute group-time average treatment effects.  default \"dr\" uses doubly robust approach DRDID package.  built-methods include \"ipw\" inverse probability weighting \"reg\" first step regression estimators.  user can also pass function estimating group time average treatment effects.  function f(Y1,Y0,treat,covariates) Y1 n x 1 vector outcomes post-treatment outcomes, Y0 n x 1 vector pre-treatment outcomes, treat vector indicating whether individual participates treatment, covariates n x k matrix covariates.  function return list includes ATT (estimated average treatment effect), inf.func (n x 1 influence function). function can return things well, two required. est_method used covariates included. print_details Whether show details/progress computations. Default FALSE. pl Whether use parallel processing cores number cores use parallel processing","code":""},{"path":"https://bcallaway11.github.io/did/reference/conditional_did_pretest.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Pre-Test of Conditional Parallel Trends Assumption — conditional_did_pretest","text":"MP.TEST object","code":""},{"path":"https://bcallaway11.github.io/did/reference/conditional_did_pretest.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Pre-Test of Conditional Parallel Trends Assumption — conditional_did_pretest","text":"Callaway, Brantly Sant'Anna, Pedro H. C.  \"Difference--Differences Multiple Time Periods Application Minimum Wage Employment.\" Working Paper https://arxiv.org/abs/1803.09015v2 (2018).","code":""},{"path":"https://bcallaway11.github.io/did/reference/conditional_did_pretest.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Pre-Test of Conditional Parallel Trends Assumption — conditional_did_pretest","text":"","code":"if (FALSE) { # \\dontrun{ data(mpdta) pre.test <- conditional_did_pretest(yname=\"lemp\",                                     tname=\"year\",                                     idname=\"countyreal\",                                     gname=\"first.treat\",                                     xformla=~lpop,                                     data=mpdta) summary(pre.test) } # }"},{"path":"https://bcallaway11.github.io/did/reference/did-package.html","id":null,"dir":"Reference","previous_headings":"","what":"Difference in Differences — did-package","title":"Difference in Differences — did-package","text":"implements Difference Differences multiple periods variation treatment timing.","code":""},{"path":[]},{"path":"https://bcallaway11.github.io/did/reference/did-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Difference in Differences — did-package","text":"Maintainer: Brantly Callaway brantly.callaway@uga.edu Authors: Pedro H. C. Sant'Anna pedro.h.santanna@vanderbilt.edu","code":""},{"path":"https://bcallaway11.github.io/did/reference/getSE.html","id":null,"dir":"Reference","previous_headings":"","what":"Take influence function and return standard errors — getSE","title":"Take influence function and return standard errors — getSE","text":"Function take nx1 influence function return standard error","code":""},{"path":"https://bcallaway11.github.io/did/reference/getSE.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Take influence function and return standard errors — getSE","text":"","code":"getSE(thisinffunc, DIDparams = NULL)"},{"path":"https://bcallaway11.github.io/did/reference/getSE.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Take influence function and return standard errors — getSE","text":"thisinffunc influence function","code":""},{"path":"https://bcallaway11.github.io/did/reference/getSE.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Take influence function and return standard errors — getSE","text":"scalar standard error","code":""},{"path":"https://bcallaway11.github.io/did/reference/get_agg_inf_func.html","id":null,"dir":"Reference","previous_headings":"","what":"Get an influence function for particular aggregate parameters — get_agg_inf_func","title":"Get an influence function for particular aggregate parameters — get_agg_inf_func","text":"Get influence function particular aggregate parameters generic internal function combining influence functions across ATT(g,t)'s return influence function various aggregated treatment effect parameters.","code":""},{"path":"https://bcallaway11.github.io/did/reference/get_agg_inf_func.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get an influence function for particular aggregate parameters — get_agg_inf_func","text":"","code":"get_agg_inf_func(att, inffunc1, whichones, weights.agg, wif = NULL)"},{"path":"https://bcallaway11.github.io/did/reference/get_agg_inf_func.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get an influence function for particular aggregate parameters — get_agg_inf_func","text":"att vector group-time average treatment effects inffunc1 influence function group-time average treatment effects (matrix) whichones elements att used compute aggregated treatment effect parameter weights.agg weights apply element att(whichones); dimension att(whichones) wif extra influence function term coming estimating weights; n x k matrix k dimension whichones","code":""},{"path":"https://bcallaway11.github.io/did/reference/get_agg_inf_func.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get an influence function for particular aggregate parameters — get_agg_inf_func","text":"nx1 influence function","code":""},{"path":"https://bcallaway11.github.io/did/reference/ggdid.AGGTEobj.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot AGGTEobj objects — ggdid.AGGTEobj","title":"Plot AGGTEobj objects — ggdid.AGGTEobj","text":"function plot AGGTEobj objects","code":""},{"path":"https://bcallaway11.github.io/did/reference/ggdid.AGGTEobj.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot AGGTEobj objects — ggdid.AGGTEobj","text":"","code":"# S3 method for class 'AGGTEobj' ggdid(   object,   ylim = NULL,   xlab = NULL,   ylab = NULL,   title = \"\",   xgap = 1,   legend = TRUE,   ref_line = 0,   theming = TRUE,   ... )"},{"path":"https://bcallaway11.github.io/did/reference/ggdid.AGGTEobj.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot AGGTEobj objects — ggdid.AGGTEobj","text":"object either MP object AGGTEobj object. See help(ggdid.MP) help(ggdid.AGGTEobj). ylim optional y limits plot; setting makes y limits across different plots xlab optional x-axis label ylab optional y-axis label title optional plot title xgap optional gap labels x-axis.  example, xgap=3 indicates labels show every third value x-axis.  default 1. legend Whether include legend (indicate color pre- post-treatment estimates).  Default TRUE. ref_line reference line value, usually compare confidence intervals 0. Set NULL omit. theming Set FALSE skip theming can . ... arguments","code":""},{"path":"https://bcallaway11.github.io/did/reference/ggdid.MP.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot MP objects using ggplot2 — ggdid.MP","title":"Plot MP objects using ggplot2 — ggdid.MP","text":"function plot MP objects","code":""},{"path":"https://bcallaway11.github.io/did/reference/ggdid.MP.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot MP objects using ggplot2 — ggdid.MP","text":"","code":"# S3 method for class 'MP' ggdid(   object,   ylim = NULL,   xlab = NULL,   ylab = NULL,   title = \"Group\",   xgap = 1,   ncol = 1,   legend = TRUE,   group = NULL,   ref_line = 0,   theming = TRUE,   grtitle = \"Group\",   ... )"},{"path":"https://bcallaway11.github.io/did/reference/ggdid.MP.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot MP objects using ggplot2 — ggdid.MP","text":"object either MP object AGGTEobj object. See help(ggdid.MP) help(ggdid.AGGTEobj). ylim optional y limits plot; setting makes y limits across different plots xlab optional x-axis label ylab optional y-axis label title optional plot title xgap optional gap labels x-axis.  example, xgap=3 indicates labels show every third value x-axis.  default 1. ncol number columns include resulting plot.  default 1. legend Whether include legend (indicate color pre- post-treatment estimates).  Default TRUE. group Vector groups include plots ATT(g,t). Default NULL, , case, plots groups included (ggdid.MP ). ref_line reference line value, usually compare confidence intervals 0. Set NULL omit. theming Set FALSE skip theming can . grtitle Title append group name (ggdid.MP ). ... arguments","code":""},{"path":"https://bcallaway11.github.io/did/reference/ggdid.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot did objects using ggplot2 — ggdid","title":"Plot did objects using ggplot2 — ggdid","text":"Function plot objects package","code":""},{"path":"https://bcallaway11.github.io/did/reference/ggdid.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot did objects using ggplot2 — ggdid","text":"","code":"ggdid(object, ...)"},{"path":"https://bcallaway11.github.io/did/reference/ggdid.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot did objects using ggplot2 — ggdid","text":"object either MP object AGGTEobj object. See help(ggdid.MP) help(ggdid.AGGTEobj). ... arguments","code":""},{"path":"https://bcallaway11.github.io/did/reference/glance.AGGTEobj.html","id":null,"dir":"Reference","previous_headings":"","what":"glance model characteristics from AGGTEobj objects — glance.AGGTEobj","title":"glance model characteristics from AGGTEobj objects — glance.AGGTEobj","text":"glance model characteristics AGGTEobj objects","code":""},{"path":"https://bcallaway11.github.io/did/reference/glance.AGGTEobj.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"glance model characteristics from AGGTEobj objects — glance.AGGTEobj","text":"","code":"# S3 method for class 'AGGTEobj' glance(x, ...)"},{"path":"https://bcallaway11.github.io/did/reference/glance.AGGTEobj.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"glance model characteristics from AGGTEobj objects — glance.AGGTEobj","text":"x model class AGGTEobj produced aggte() function ... arguments passed methods","code":""},{"path":"https://bcallaway11.github.io/did/reference/glance.MP.html","id":null,"dir":"Reference","previous_headings":"","what":"glance model characteristics from MP objects — glance.MP","title":"glance model characteristics from MP objects — glance.MP","text":"glance model characteristics MP objects","code":""},{"path":"https://bcallaway11.github.io/did/reference/glance.MP.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"glance model characteristics from MP objects — glance.MP","text":"","code":"# S3 method for class 'MP' glance(x, ...)"},{"path":"https://bcallaway11.github.io/did/reference/glance.MP.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"glance model characteristics from MP objects — glance.MP","text":"x model class MP produced att_gt() function ... arguments passed methods","code":""},{"path":"https://bcallaway11.github.io/did/reference/gplot.html","id":null,"dir":"Reference","previous_headings":"","what":"gplot — gplot","title":"gplot — gplot","text":"heavy lifting making plot group-time average treatment effect","code":""},{"path":"https://bcallaway11.github.io/did/reference/gplot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"gplot — gplot","text":"","code":"gplot(   ssresults,   ylim = NULL,   xlab = NULL,   ylab = NULL,   title = \"Group\",   xgap = 1,   legend = TRUE,   ref_line = 0,   theming = TRUE )"},{"path":"https://bcallaway11.github.io/did/reference/gplot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"gplot — gplot","text":"ggplot2 object","code":""},{"path":"https://bcallaway11.github.io/did/reference/indicator.html","id":null,"dir":"Reference","previous_headings":"","what":"indicator — indicator","title":"indicator — indicator","text":"indicator weighting function","code":""},{"path":"https://bcallaway11.github.io/did/reference/indicator.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"indicator — indicator","text":"","code":"indicator(X, u)"},{"path":"https://bcallaway11.github.io/did/reference/indicator.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"indicator — indicator","text":"X matrix X's data u particular value compare X's ","code":""},{"path":"https://bcallaway11.github.io/did/reference/indicator.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"indicator — indicator","text":"numeric vector","code":""},{"path":"https://bcallaway11.github.io/did/reference/indicator.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"indicator — indicator","text":"","code":"data(mpdta) dta <- subset(mpdta, year==2007) X <- model.matrix(~lpop, data=dta) X <- indicator(X, X[1,])"},{"path":"https://bcallaway11.github.io/did/reference/mboot.html","id":null,"dir":"Reference","previous_headings":"","what":"Multiplier Bootstrap — mboot","title":"Multiplier Bootstrap — mboot","text":"function take influence function use multiplier bootstrap compute standard errors critical values uniform confidence bands.","code":""},{"path":"https://bcallaway11.github.io/did/reference/mboot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Multiplier Bootstrap — mboot","text":"","code":"mboot(inf.func, DIDparams, pl = FALSE, cores = 1)"},{"path":"https://bcallaway11.github.io/did/reference/mboot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Multiplier Bootstrap — mboot","text":"inf.func influence function DIDparams DIDparams object pl whether use parallel processing multiplier bootstrap, default=FALSE cores number cores use parallel processing, default=1","code":""},{"path":"https://bcallaway11.github.io/did/reference/mboot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Multiplier Bootstrap — mboot","text":"list elements bres results bootstrap iteration V variance matrix se standard errors crit.val critical value computing uniform confidence bands","code":""},{"path":"https://bcallaway11.github.io/did/reference/mpdta.html","id":null,"dir":"Reference","previous_headings":"","what":"County Teen Employment Dataset — mpdta","title":"County Teen Employment Dataset — mpdta","text":"dataset containing (log ) teen employment 500 counties U.S. 2004 2007.  subset dataset used Callaway Sant'Anna (2021).  See paper additional descriptions.","code":""},{"path":"https://bcallaway11.github.io/did/reference/mpdta.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"County Teen Employment Dataset — mpdta","text":"","code":"mpdta"},{"path":"https://bcallaway11.github.io/did/reference/mpdta.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"County Teen Employment Dataset — mpdta","text":"data frame 2000 rows 5 variables: year year observation countyreal unique identifier particular county lpop log 1000s population county lemp log teen employment county first.treat year state county located raised minimum wage, set equal 0 counties minimum wages equal federal minimum wage entire period. treat whether particular county treated year","code":""},{"path":"https://bcallaway11.github.io/did/reference/mpdta.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"County Teen Employment Dataset — mpdta","text":"Callaway Sant'Anna (2020)","code":""},{"path":"https://bcallaway11.github.io/did/reference/pre_process_did.html","id":null,"dir":"Reference","previous_headings":"","what":"Process did Function Arguments — pre_process_did","title":"Process did Function Arguments — pre_process_did","text":"Function process arguments passed main methods package well conducting tests make sure data proper format / try throw helpful error messages.","code":""},{"path":"https://bcallaway11.github.io/did/reference/pre_process_did.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Process did Function Arguments — pre_process_did","text":"","code":"pre_process_did(   yname,   tname,   idname,   gname,   xformla = NULL,   data,   panel = TRUE,   allow_unbalanced_panel,   control_group = c(\"nevertreated\", \"notyettreated\"),   anticipation = 0,   weightsname = NULL,   alp = 0.05,   bstrap = FALSE,   cband = FALSE,   biters = 1000,   clustervars = NULL,   est_method = \"dr\",   base_period = \"varying\",   print_details = TRUE,   faster_mode = FALSE,   pl = FALSE,   cores = 1,   call = NULL )"},{"path":"https://bcallaway11.github.io/did/reference/pre_process_did.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Process did Function Arguments — pre_process_did","text":"yname name outcome variable tname name column containing time periods idname individual (cross-sectional unit) id name gname name variable data contains first period particular observation treated. positive number observations treated groups. defines \"group\" unit belongs .  0 units untreated group. xformla formula covariates include model.  form ~ X1 + X2.  Default NULL equivalent xformla=~1.  used create matrix covariates passed 2x2 estimator chosen est_method. time-varying covariates: (1) balanced panel data, 2x2 comparison, covariates taken value covariates earlier time period, underlying computation involve change Y function values covariates.  (2) repeated cross sections data unbalanced panel data, covariates taken time period computations involve Y_post conditional X_post minus Y_pre conditional X_pre.  byproduct , balanced panel data presence time-varying covariates, possible get different numerical results according whether allow_unbalanced_panel=TRUE FALSE. data name data.frame contains data panel Whether data panel dataset. panel dataset provided long format – , row corresponds unit observed particular point time.  default TRUE.  using panel dataset, variable idname must set.  panel=FALSE, data treated repeated cross sections. allow_unbalanced_panel Whether function \"balance\" panel respect time id.  default values FALSE means att_gt() drop units data observed periods. advantage computations faster (sometimes substantially). control_group units use control group. default \"nevertreated\" sets control group group units never participate treatment.  group change across groups time periods.  option set group=\"notyettreated\".  case, control group set group units yet participated treatment time period.  includes never treated units, includes additional units eventually participate treatment, participated yet. anticipation number time periods participating treatment units can anticipate participating treatment therefore can affect untreated potential outcomes weightsname name column containing sampling weights. set, observations weight. alp significance level, default 0.05 bstrap Boolean whether compute standard errors using multiplier bootstrap.  standard errors clustered, one must set bstrap=TRUE. Default TRUE (addition, cband also default TRUE indicating uniform confidence bands returned.  bstrap FALSE, analytical standard errors reported. cband Boolean whether compute uniform confidence band covers group-time average treatment effects fixed probability 1-alp.  order compute uniform confidence bands, bstrap must also set TRUE.  default TRUE. biters number bootstrap iterations use.  default 1000, applicable bstrap=TRUE. clustervars vector variables names cluster .  , can two variables (otherwise throw error) one must idname allows clustering individual level. default, cluster individual level (bstrap=TRUE). est_method method compute group-time average treatment effects.  default \"dr\" uses doubly robust approach DRDID package.  built-methods include \"ipw\" inverse probability weighting \"reg\" first step regression estimators.  user can also pass function estimating group time average treatment effects.  function f(Y1,Y0,treat,covariates) Y1 n x 1 vector outcomes post-treatment outcomes, Y0 n x 1 vector pre-treatment outcomes, treat vector indicating whether individual participates treatment, covariates n x k matrix covariates.  function return list includes ATT (estimated average treatment effect), inf.func (n x 1 influence function). function can return things well, two required. est_method used covariates included. base_period Whether use \"varying\" base period \"universal\" base period.  Either choice results post-treatment estimates ATT(g,t)'s.  pre-treatment periods, using varying base period amounts computing pseudo-ATT treatment period comparing change outcomes particular group relative comparison group pre-treatment periods (.e., pre-treatment periods setting computes changes period t-1 period t, repeatedly changes value t) universal base period fixes base period always (g-anticipation-1).  compute pseudo-ATT(g,t)'s pre-treatment periods, rather reports average changes outcomes period t (g-anticipation-1) particular group relative comparison group.  analogous often reported event study regressions. Using varying base period results estimate ATT(g,t) reported period immediately treatment.  Using universal base period normalizes estimate period right treatment (earlier user allows anticipation) equal 0, one extra estimate earlier period. print_details Whether show details/progress computations. Default FALSE. faster_mode option enables faster version , optimizing computation time large datasets improving data management within package. default set FALSE. difference minimal small datasets, recommended use large datasets. pl Whether use parallel processing cores number cores use parallel processing call Function call att_gt","code":""},{"path":"https://bcallaway11.github.io/did/reference/pre_process_did.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Process did Function Arguments — pre_process_did","text":"DIDparams object","code":""},{"path":"https://bcallaway11.github.io/did/reference/pre_process_did2.html","id":null,"dir":"Reference","previous_headings":"","what":"Process did Function Arguments — pre_process_did2","title":"Process did Function Arguments — pre_process_did2","text":"Function process arguments passed main methods package well conducting tests make sure data proper format / try throw helpful error messages.","code":""},{"path":"https://bcallaway11.github.io/did/reference/pre_process_did2.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Process did Function Arguments — pre_process_did2","text":"","code":"pre_process_did2(   yname,   tname,   idname,   gname,   xformla = NULL,   data,   panel = TRUE,   allow_unbalanced_panel,   control_group = c(\"nevertreated\", \"notyettreated\"),   anticipation = 0,   weightsname = NULL,   alp = 0.05,   bstrap = FALSE,   cband = FALSE,   biters = 1000,   clustervars = NULL,   est_method = \"dr\",   base_period = \"varying\",   print_details = TRUE,   faster_mode = FALSE,   pl = FALSE,   cores = 1,   call = NULL )"},{"path":"https://bcallaway11.github.io/did/reference/pre_process_did2.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Process did Function Arguments — pre_process_did2","text":"yname name outcome variable tname name column containing time periods idname individual (cross-sectional unit) id name gname name variable data contains first period particular observation treated. positive number observations treated groups. defines \"group\" unit belongs .  0 units untreated group. xformla formula covariates include model.  form ~ X1 + X2.  Default NULL equivalent xformla=~1.  used create matrix covariates passed 2x2 estimator chosen est_method. time-varying covariates: (1) balanced panel data, 2x2 comparison, covariates taken value covariates earlier time period, underlying computation involve change Y function values covariates.  (2) repeated cross sections data unbalanced panel data, covariates taken time period computations involve Y_post conditional X_post minus Y_pre conditional X_pre.  byproduct , balanced panel data presence time-varying covariates, possible get different numerical results according whether allow_unbalanced_panel=TRUE FALSE. data name data.frame contains data panel Whether data panel dataset. panel dataset provided long format – , row corresponds unit observed particular point time.  default TRUE.  using panel dataset, variable idname must set.  panel=FALSE, data treated repeated cross sections. allow_unbalanced_panel Whether function \"balance\" panel respect time id.  default values FALSE means att_gt() drop units data observed periods. advantage computations faster (sometimes substantially). control_group units use control group. default \"nevertreated\" sets control group group units never participate treatment.  group change across groups time periods.  option set group=\"notyettreated\".  case, control group set group units yet participated treatment time period.  includes never treated units, includes additional units eventually participate treatment, participated yet. anticipation number time periods participating treatment units can anticipate participating treatment therefore can affect untreated potential outcomes weightsname name column containing sampling weights. set, observations weight. alp significance level, default 0.05 bstrap Boolean whether compute standard errors using multiplier bootstrap.  standard errors clustered, one must set bstrap=TRUE. Default TRUE (addition, cband also default TRUE indicating uniform confidence bands returned.  bstrap FALSE, analytical standard errors reported. cband Boolean whether compute uniform confidence band covers group-time average treatment effects fixed probability 1-alp.  order compute uniform confidence bands, bstrap must also set TRUE.  default TRUE. biters number bootstrap iterations use.  default 1000, applicable bstrap=TRUE. clustervars vector variables names cluster .  , can two variables (otherwise throw error) one must idname allows clustering individual level. default, cluster individual level (bstrap=TRUE). est_method method compute group-time average treatment effects.  default \"dr\" uses doubly robust approach DRDID package.  built-methods include \"ipw\" inverse probability weighting \"reg\" first step regression estimators.  user can also pass function estimating group time average treatment effects.  function f(Y1,Y0,treat,covariates) Y1 n x 1 vector outcomes post-treatment outcomes, Y0 n x 1 vector pre-treatment outcomes, treat vector indicating whether individual participates treatment, covariates n x k matrix covariates.  function return list includes ATT (estimated average treatment effect), inf.func (n x 1 influence function). function can return things well, two required. est_method used covariates included. base_period Whether use \"varying\" base period \"universal\" base period.  Either choice results post-treatment estimates ATT(g,t)'s.  pre-treatment periods, using varying base period amounts computing pseudo-ATT treatment period comparing change outcomes particular group relative comparison group pre-treatment periods (.e., pre-treatment periods setting computes changes period t-1 period t, repeatedly changes value t) universal base period fixes base period always (g-anticipation-1).  compute pseudo-ATT(g,t)'s pre-treatment periods, rather reports average changes outcomes period t (g-anticipation-1) particular group relative comparison group.  analogous often reported event study regressions. Using varying base period results estimate ATT(g,t) reported period immediately treatment.  Using universal base period normalizes estimate period right treatment (earlier user allows anticipation) equal 0, one extra estimate earlier period. print_details Whether show details/progress computations. Default FALSE. faster_mode option enables faster version , optimizing computation time large datasets improving data management within package. default set FALSE. difference minimal small datasets, recommended use large datasets. pl Whether use parallel processing cores number cores use parallel processing call Function call att_gt","code":""},{"path":"https://bcallaway11.github.io/did/reference/pre_process_did2.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Process did Function Arguments — pre_process_did2","text":"DIDparams object","code":""},{"path":"https://bcallaway11.github.io/did/reference/print.AGGTEobj.html","id":null,"dir":"Reference","previous_headings":"","what":"print.AGGTEobj — print.AGGTEobj","title":"print.AGGTEobj — print.AGGTEobj","text":"prints value AGGTEobj object","code":""},{"path":"https://bcallaway11.github.io/did/reference/print.AGGTEobj.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"print.AGGTEobj — print.AGGTEobj","text":"","code":"# S3 method for class 'AGGTEobj' print(x, ...)"},{"path":"https://bcallaway11.github.io/did/reference/print.AGGTEobj.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"print.AGGTEobj — print.AGGTEobj","text":"x AGGTEobj object ... extra arguments","code":""},{"path":"https://bcallaway11.github.io/did/reference/print.MP.html","id":null,"dir":"Reference","previous_headings":"","what":"print.MP — print.MP","title":"print.MP — print.MP","text":"prints value MP object","code":""},{"path":"https://bcallaway11.github.io/did/reference/print.MP.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"print.MP — print.MP","text":"","code":"# S3 method for class 'MP' print(x, ...)"},{"path":"https://bcallaway11.github.io/did/reference/print.MP.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"print.MP — print.MP","text":"x MP object ... extra arguments","code":""},{"path":"https://bcallaway11.github.io/did/reference/process_attgt.html","id":null,"dir":"Reference","previous_headings":"","what":"Process Results from compute.att_gt() — process_attgt","title":"Process Results from compute.att_gt() — process_attgt","text":"Process Results compute.att_gt()","code":""},{"path":"https://bcallaway11.github.io/did/reference/process_attgt.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Process Results from compute.att_gt() — process_attgt","text":"","code":"process_attgt(attgt.list)"},{"path":"https://bcallaway11.github.io/did/reference/process_attgt.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Process Results from compute.att_gt() — process_attgt","text":"attgt.list list results compute.att_gt()","code":""},{"path":"https://bcallaway11.github.io/did/reference/process_attgt.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Process Results from compute.att_gt() — process_attgt","text":"list elements: group group set results belongs tt time period set results belongs att group time average treatment effect","code":""},{"path":"https://bcallaway11.github.io/did/reference/reexports.html","id":null,"dir":"Reference","previous_headings":"","what":"tidy results — reexports","title":"tidy results — reexports","text":"objects imported packages. Follow links see documentation. generics glance, tidy","code":""},{"path":"https://bcallaway11.github.io/did/reference/reset.sim.html","id":null,"dir":"Reference","previous_headings":"","what":"reset.sim — reset.sim","title":"reset.sim — reset.sim","text":"function create \"reasonable\" set parameters create simulated panel data obeys parallel trends assumption. particular, provides parameters effect participating treatment equal one post-treatment time periods. calling function, user can change particular values parameters order generate dynamics, heterogeneous effects across groups, etc.","code":""},{"path":"https://bcallaway11.github.io/did/reference/reset.sim.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"reset.sim — reset.sim","text":"","code":"reset.sim(time.periods = 4, n = 5000, ipw = TRUE, reg = TRUE)"},{"path":"https://bcallaway11.github.io/did/reference/reset.sim.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"reset.sim — reset.sim","text":"time.periods number time periods include n total number observations ipw TRUE, sets parameters DGP compatible recovering ATT(g,t)'s using IPW (.e., logit just includes linear term X works).  FALSE, sets parameters incompatible IPW. Either way, parameters can specified user desired. reg TRUE, sets parameters DGP compatible recovering ATT(g,t)'s using regressions untreated untreated potential outcomes.  FALSE, sets parameters incompatible using regressions (.e., regressions include linear term X).  Either way, parameters can specified user desired.","code":""},{"path":"https://bcallaway11.github.io/did/reference/reset.sim.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"reset.sim — reset.sim","text":"list simulation parameters","code":""},{"path":"https://bcallaway11.github.io/did/reference/run_att_gt_estimation.html","id":null,"dir":"Reference","previous_headings":"","what":"Run ATT estimation for a given group-time pair — run_att_gt_estimation","title":"Run ATT estimation for a given group-time pair — run_att_gt_estimation","text":"run_att_gt_estimation main work computing multiperiod group-time average treatment effects","code":""},{"path":"https://bcallaway11.github.io/did/reference/run_att_gt_estimation.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run ATT estimation for a given group-time pair — run_att_gt_estimation","text":"","code":"run_att_gt_estimation(g, t, dp2)"},{"path":"https://bcallaway11.github.io/did/reference/run_att_gt_estimation.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run ATT estimation for a given group-time pair — run_att_gt_estimation","text":"g group interest (treated group time t) t time period dp2 DIDparams object v2.0","code":""},{"path":"https://bcallaway11.github.io/did/reference/run_att_gt_estimation.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run ATT estimation for a given group-time pair — run_att_gt_estimation","text":"list gt cell results performing estimation","code":""},{"path":"https://bcallaway11.github.io/did/reference/sim.html","id":null,"dir":"Reference","previous_headings":"","what":"sim — sim","title":"sim — sim","text":"internal function builds simulated data, computes ATT(g,t)'s aggregations.  useful testing inference procedures function.","code":""},{"path":"https://bcallaway11.github.io/did/reference/sim.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"sim — sim","text":"","code":"sim(   sp_list,   ret = NULL,   bstrap = TRUE,   cband = TRUE,   control_group = \"nevertreated\",   xformla = ~X,   est_method = \"dr\",   clustervars = NULL,   panel = TRUE )"},{"path":"https://bcallaway11.github.io/did/reference/sim.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"sim — sim","text":"sp_list list simulation parameters.  See reset.sim generate default values parameters ret type results return.  options Wpval (returns 1 p-value Wald test pre-treatment ATT(g,t)'s equal less .05), cband  (returns 1 uniform confidence band covers 0 groups times), simple (returns 1 , using simple treatment effect aggregation results rejecting aggregated treatment effect parameter equal 0), dynamic (returns 1 uniform confidence band dynamic treatment effect aggregation covers 0 pre- post-treatment periods).  default value NULL, case function just return results call att_gt. bstrap whether use bootstrap conduct inference (default TRUE) cband whether compute uniform confidence bands call att_gt (default TRUE) control_group Whether use \"nevertreated\" comparison group (default) \"notyettreated\" comparison group xformla Formula covariates att_gt (default ~X) est_method estimation method use att_gt (default \"dr\") clustervars additional variables clustered panel whether simulate panel data (default) otherwise repeated cross sections data","code":""},{"path":"https://bcallaway11.github.io/did/reference/sim.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"sim — sim","text":"ret=NULL, returns results call att_gt, otherwise returns 1 specified test rejects 0 .","code":""},{"path":"https://bcallaway11.github.io/did/reference/splot.html","id":null,"dir":"Reference","previous_headings":"","what":"splot — splot","title":"splot — splot","text":"alternative plotting function case selective treatment timing","code":""},{"path":"https://bcallaway11.github.io/did/reference/splot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"splot — splot","text":"","code":"splot(   ssresults,   ylim = NULL,   xlab = NULL,   ylab = NULL,   title = \"Group\",   legend = TRUE,   ref_line = 0,   theming = TRUE )"},{"path":"https://bcallaway11.github.io/did/reference/splot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"splot — splot","text":"ggplot2 object","code":""},{"path":"https://bcallaway11.github.io/did/reference/summary.AGGTEobj.html","id":null,"dir":"Reference","previous_headings":"","what":"Summary Aggregate Treatment Effect Parameter Objects — summary.AGGTEobj","title":"Summary Aggregate Treatment Effect Parameter Objects — summary.AGGTEobj","text":"function summarize aggregated treatment effect parameters.","code":""},{"path":"https://bcallaway11.github.io/did/reference/summary.AGGTEobj.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summary Aggregate Treatment Effect Parameter Objects — summary.AGGTEobj","text":"","code":"# S3 method for class 'AGGTEobj' summary(object, ...)"},{"path":"https://bcallaway11.github.io/did/reference/summary.AGGTEobj.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summary Aggregate Treatment Effect Parameter Objects — summary.AGGTEobj","text":"object AGGTEobj object ... arguments","code":""},{"path":"https://bcallaway11.github.io/did/reference/summary.MP.TEST.html","id":null,"dir":"Reference","previous_headings":"","what":"summary.MP.TEST — summary.MP.TEST","title":"summary.MP.TEST — summary.MP.TEST","text":"print summary test results","code":""},{"path":"https://bcallaway11.github.io/did/reference/summary.MP.TEST.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"summary.MP.TEST — summary.MP.TEST","text":"","code":"# S3 method for class 'MP.TEST' summary(object, ...)"},{"path":"https://bcallaway11.github.io/did/reference/summary.MP.TEST.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"summary.MP.TEST — summary.MP.TEST","text":"object MP.TEST object ... variables","code":""},{"path":"https://bcallaway11.github.io/did/reference/summary.MP.html","id":null,"dir":"Reference","previous_headings":"","what":"summary.MP — summary.MP","title":"summary.MP — summary.MP","text":"prints summary MP object","code":""},{"path":"https://bcallaway11.github.io/did/reference/summary.MP.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"summary.MP — summary.MP","text":"","code":"# S3 method for class 'MP' summary(object, ...)"},{"path":"https://bcallaway11.github.io/did/reference/summary.MP.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"summary.MP — summary.MP","text":"object MP object ... extra arguments","code":""},{"path":"https://bcallaway11.github.io/did/reference/test.mboot.html","id":null,"dir":"Reference","previous_headings":"","what":"Multiplier Bootstrap for Conditional Moment Test — test.mboot","title":"Multiplier Bootstrap for Conditional Moment Test — test.mboot","text":"slightly modified multiplier bootstrap procedure pre-test conditional parallel trends assumption","code":""},{"path":"https://bcallaway11.github.io/did/reference/test.mboot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Multiplier Bootstrap for Conditional Moment Test — test.mboot","text":"","code":"test.mboot(inf.func, DIDparams, cores = 1)"},{"path":"https://bcallaway11.github.io/did/reference/test.mboot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Multiplier Bootstrap for Conditional Moment Test — test.mboot","text":"inf.func influence function DIDparams DIDparams object cores number cores use bootstrap test statistic parallel.  Default cores=1 corresponds running parallel.","code":""},{"path":"https://bcallaway11.github.io/did/reference/test.mboot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Multiplier Bootstrap for Conditional Moment Test — test.mboot","text":"list bres CvM test statistics bootstrap iteration crit.val critical value CvM test statistic","code":""},{"path":"https://bcallaway11.github.io/did/reference/tidy.AGGTEobj.html","id":null,"dir":"Reference","previous_headings":"","what":"tidy results from AGGTEobj objects — tidy.AGGTEobj","title":"tidy results from AGGTEobj objects — tidy.AGGTEobj","text":"tidy results AGGTEobj objects","code":""},{"path":"https://bcallaway11.github.io/did/reference/tidy.AGGTEobj.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"tidy results from AGGTEobj objects — tidy.AGGTEobj","text":"","code":"# S3 method for class 'AGGTEobj' tidy(x, ...)"},{"path":"https://bcallaway11.github.io/did/reference/tidy.AGGTEobj.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"tidy results from AGGTEobj objects — tidy.AGGTEobj","text":"x model class AGGTEobj produced aggte() function ... Additional arguments tidying method.","code":""},{"path":"https://bcallaway11.github.io/did/reference/tidy.MP.html","id":null,"dir":"Reference","previous_headings":"","what":"tidy results from MP objects — tidy.MP","title":"tidy results from MP objects — tidy.MP","text":"tidy results MP objects","code":""},{"path":"https://bcallaway11.github.io/did/reference/tidy.MP.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"tidy results from MP objects — tidy.MP","text":"","code":"# S3 method for class 'MP' tidy(x, ...)"},{"path":"https://bcallaway11.github.io/did/reference/tidy.MP.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"tidy results from MP objects — tidy.MP","text":"x model class MP produced att_gt() function ... Additional arguments tidying method.","code":""},{"path":"https://bcallaway11.github.io/did/reference/trimmer.html","id":null,"dir":"Reference","previous_headings":"","what":"trimmer — trimmer","title":"trimmer — trimmer","text":"utility function find observations appear violate support conditions.  function called anywhere code, just useful debugging common issues users run .","code":""},{"path":"https://bcallaway11.github.io/did/reference/trimmer.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"trimmer — trimmer","text":"","code":"trimmer(   g,   tname,   idname,   gname,   xformla,   data,   control_group = \"notyettreated\",   threshold = 0.999 )"},{"path":"https://bcallaway11.github.io/did/reference/trimmer.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"trimmer — trimmer","text":"g particular group (pass 2009) tname name column containing time periods idname individual (cross-sectional unit) id name gname name variable data contains first period particular observation treated. positive number observations treated groups. defines \"group\" unit belongs .  0 units untreated group. xformla formula covariates include model.  form ~ X1 + X2.  Default NULL equivalent xformla=~1.  used create matrix covariates passed 2x2 estimator chosen est_method. time-varying covariates: (1) balanced panel data, 2x2 comparison, covariates taken value covariates earlier time period, underlying computation involve change Y function values covariates.  (2) repeated cross sections data unbalanced panel data, covariates taken time period computations involve Y_post conditional X_post minus Y_pre conditional X_pre.  byproduct , balanced panel data presence time-varying covariates, possible get different numerical results according whether allow_unbalanced_panel=TRUE FALSE. data name data.frame contains data control_group units use control group. default \"nevertreated\" sets control group group units never participate treatment.  group change across groups time periods.  option set group=\"notyettreated\".  case, control group set group units yet participated treatment time period.  includes never treated units, includes additional units eventually participate treatment, participated yet. threshold cutoff observations flagged likely violators support condition.","code":""},{"path":"https://bcallaway11.github.io/did/reference/trimmer.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"trimmer — trimmer","text":"list ids observations likely violate support conditions","code":""},{"path":"https://bcallaway11.github.io/did/reference/wif.html","id":null,"dir":"Reference","previous_headings":"","what":"Compute extra term in influence function due to estimating weights — wif","title":"Compute extra term in influence function due to estimating weights — wif","text":"function compute extra term shows influence function aggregated treatment effect parameters due estimating weights","code":""},{"path":"https://bcallaway11.github.io/did/reference/wif.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compute extra term in influence function due to estimating weights — wif","text":"","code":"wif(keepers, pg, weights.ind, G, group)"},{"path":"https://bcallaway11.github.io/did/reference/wif.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compute extra term in influence function due to estimating weights — wif","text":"keepers vector indices group-time average treatment effects used compute particular aggregated parameter pg vector length total number group-time average treatment effects contains probability particular group weights.ind additional sampling weights (nx1) G vector containing group unit belongs (nx1) group vector groups","code":""},{"path":"https://bcallaway11.github.io/did/reference/wif.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compute extra term in influence function due to estimating weights — wif","text":"nxk influence function matrix","code":""},{"path":"https://bcallaway11.github.io/did/news/index.html","id":"did-230","dir":"Changelog","previous_headings":"","what":"did 2.3.0","title":"did 2.3.0","text":"Code improvements made package faster memory efficient Improved automated testing regression testing Check data balanced panel = TRUE allow_unbalanced_panel = TRUE. , disable allow_unbalanced_panel proceed panel data setup. different previous behavior, always proceed panel = FALSE. Significantly reduced number recursive package dependencies, enabling faster installation times smaller build footprint.","code":""},{"path":"https://bcallaway11.github.io/did/news/index.html","id":"did-220","dir":"Changelog","previous_headings":"","what":"did 2.2.0","title":"did 2.2.0","text":"Skipped number changes sufficiently large warrant minor version bump","code":""},{"path":"https://bcallaway11.github.io/did/news/index.html","id":"did-212","dir":"Changelog","previous_headings":"","what":"did 2.1.2","title":"did 2.1.2","text":"CRAN release: 2022-07-20 Added wrapper function HonestDiD package Fix bug setups gname contained tname (tname range) Fix bug including many groups universal base period pre-treatment periods Bug fix anticipation using notyettreated comparison group","code":""},{"path":"https://bcallaway11.github.io/did/news/index.html","id":"did-211","dir":"Changelog","previous_headings":"","what":"did 2.1.1","title":"did 2.1.1","text":"CRAN release: 2022-01-27 Bug fixes related unbalanced panel clustered standard errors Bug fixes conditional_did_pretest Even faster bootstrap code (thanks Kyle Butts) Updated version requirement BMisc package Bug fix unbalanced panel repeated cross sections pre-treatment periods using universal base period","code":""},{"path":"https://bcallaway11.github.io/did/news/index.html","id":"did-210","dir":"Changelog","previous_headings":"","what":"did 2.1.0","title":"did 2.1.0","text":"CRAN release: 2021-12-10 Code substantially faster/memory efficient Support universal base period Major improvements unit testing Completely removed mp.spatt mp.spatt.test functions (original names att_gt) Simulation/testing code now exported Removed slow running checks Multiplier bootstrap code now written C++ Improvements error handling, added additional warning messages, removed unnecessary warning messages Bug fixes NA standard errors occur small groups","code":""},{"path":"https://bcallaway11.github.io/did/news/index.html","id":"did-201","dir":"Changelog","previous_headings":"","what":"did 2.0.1","title":"did 2.0.1","text":"Improved plots Maximum event time event studies Compute critical value simultaneous confidence bands even standard error zero (set NA) Improved codes unbalanced panel data: faster memory efficient Correct estimates P(G=g|Eventually treated) unbalanced panel data. affects aggte objects unbalanced panel data Bug fixes summary aggte objects Allow clustering unbalanced panel data Fixed error calendar-type aggregation within aggte function (point estimates weighted group-size; now ). Additional error handling","code":""},{"path":"https://bcallaway11.github.io/did/news/index.html","id":"did-200","dir":"Changelog","previous_headings":"","what":"did 2.0.0","title":"did 2.0.0","text":"CRAN release: 2020-12-11 Big improvement code base / functionality / testing Deprecated mp.spatt function replaced att_gt function Calling att_gt similar calling mp.spatt; instead formula outcome form y~treat, now just pass name outcome variable Deprecated mp.spatt function replaced conditional_did_pretest function New est_method parameter. Can call function 2x2 DRDID package (default now doubly robust estimation, inverse probability weights regression estimators also supported) well provide custom 2x2 estimators Bug fixes including groups already treated first period Allow user select control group – either never treated yet treated Add functionality uniform confidence bands aggregated treatment effect parameters Introduced dynamic effects pre-treatment periods. allow users report event study plots common include pre-treatment periods common applied work. event study plots package robust selective treatment timing (unlike standard regression event study plots) Support using repeated cross sections data instead panel data much improved Support using sampling weights much improved Big improvement website, vignettes, code documentation Code dealing unbalanced panels Allow event studies computed subsets event times Allow treatment anticipation via anticipation argument","code":""},{"path":"https://bcallaway11.github.io/did/news/index.html","id":"did-123","dir":"Changelog","previous_headings":"","what":"did 1.2.3","title":"did 1.2.3","text":"CRAN release: 2020-02-17 Corrected check problems","code":""},{"path":"https://bcallaway11.github.io/did/news/index.html","id":"did-122","dir":"Changelog","previous_headings":"","what":"did 1.2.2","title":"did 1.2.2","text":"CRAN release: 2019-06-21 Improved ways summarize aggregated treatment effect parameters Fixed bug related needing new version BMisc Fixed bug related plotting pre-treatment periods Improved ways easily plot aggregated treatment effect parameters","code":""},{"path":"https://bcallaway11.github.io/did/news/index.html","id":"did-121","dir":"Changelog","previous_headings":"","what":"did 1.2.1","title":"did 1.2.1","text":"CRAN release: 2019-06-14 Added error handling cases small group sizes, fixed cryptic error messages Fixes handling data format besides data.frame (e.g. tibble) Add warnings small group sizes common source trouble","code":""},{"path":"https://bcallaway11.github.io/did/news/index.html","id":"did-120","dir":"Changelog","previous_headings":"","what":"did 1.2.0","title":"did 1.2.0","text":"CRAN release: 2018-10-16 Updates handling repeated cross sections data, estimation inference","code":""},{"path":"https://bcallaway11.github.io/did/news/index.html","id":"did-112","dir":"Changelog","previous_headings":"","what":"did 1.1.2","title":"did 1.1.2","text":"CRAN release: 2018-09-11 bug fixes testing without covariates, allowed pass NULL addition ~1","code":""},{"path":"https://bcallaway11.github.io/did/news/index.html","id":"did-111","dir":"Changelog","previous_headings":"","what":"did 1.1.1","title":"did 1.1.1","text":"fixed issues BMisc formula.tools added point estimates repeated cross sections data","code":""},{"path":"https://bcallaway11.github.io/did/news/index.html","id":"did-110","dir":"Changelog","previous_headings":"","what":"did 1.1.0","title":"did 1.1.0","text":"CRAN release: 2018-07-11 bug fixes case without covariates","code":""},{"path":"https://bcallaway11.github.io/did/news/index.html","id":"did-100","dir":"Changelog","previous_headings":"","what":"did 1.0.0","title":"did 1.0.0","text":"CRAN release: 2018-04-03 first version package, functions computing group-time average treatment effects, combining smaller number parameters, pre-testing common trends assumption","code":""}]
